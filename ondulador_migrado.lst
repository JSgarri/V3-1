CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 1

ADDR   CODE       LINE  SOURCE

                  00001 
                  00002 ; CC8E Version 1.4, Copyright (c) B Knudsen Data
                  00003 ; C compiler for the PIC18 microcontrollers
                  00004 ; ************  13. May 2015  19:27  *************
                  00005 
                  00006 	processor  PIC18F44K20
                  00007 	radix  DEC
                  00008 
300000 08FF       00009 	__config 0x300001, 0x8
                  00010 	__config 0x300002, 0x1
300002 1601       00011 	__config 0x300003, 0x16
300004 88FF       00012 	__config 0x300005, 0x88
300006 FF81       00013 	__config 0x300006, 0x81
                  00014 
       0FF6       00015 TBLPTR      EQU   0xFF6
       0FF5       00016 TABLAT      EQU   0xFF5
       0FF4       00017 PRODH       EQU   0xFF4
       0FF3       00018 PRODL       EQU   0xFF3
       0FF2       00019 INTCON      EQU   0xFF2
       0FF1       00020 INTCON2     EQU   0xFF1
       0FEE       00021 POSTINC0    EQU   0xFEE
       0FE9       00022 FSR0        EQU   0xFE9
       0FE0       00023 BSR         EQU   0xFE0
       0FD8       00024 STATUS      EQU   0xFD8
       0000       00025 Carry       EQU   0
       0002       00026 Zero_       EQU   2
       0FD5       00027 T0CON       EQU   0xFD5
       0FD3       00028 OSCCON      EQU   0xFD3
       0FD0       00029 RCON        EQU   0xFD0
       0FCB       00030 PR2         EQU   0xFCB
       0FCA       00031 T2CON       EQU   0xFCA
       0FC4       00032 ADRESH      EQU   0xFC4
       0FC3       00033 ADRESL      EQU   0xFC3
       0FC2       00034 ADCON0      EQU   0xFC2
       0FC1       00035 ADCON1      EQU   0xFC1
       0FC0       00036 ADCON2      EQU   0xFC0
       0FBE       00037 CCPR1L      EQU   0xFBE
       0FBD       00038 CCP1CON     EQU   0xFBD
       0FB7       00039 PWM1CON     EQU   0xFB7
       0F9B       00040 OSCTUNE     EQU   0xF9B
       0F95       00041 TRISD       EQU   0xF95
       0F94       00042 TRISC       EQU   0xF94
       0F93       00043 TRISB       EQU   0xF93
       0F92       00044 TRISA       EQU   0xF92
       0F8C       00045 LATD        EQU   0xF8C
       0F8B       00046 LATC        EQU   0xF8B
       0F8A       00047 LATB        EQU   0xF8A
       0F83       00048 PORTD       EQU   0xF83
       0F82       00049 PORTC       EQU   0xF82
       0F81       00050 PORTB       EQU   0xF81
       0F7E       00051 ANSEL       EQU   0xF7E
       0002       00052 TMR0IF      EQU   2
       0007       00053 GIE         EQU   7
       0002       00054 TMR2ON      EQU   2
       0001       00055 GO          EQU   1
       0007       00056 ADFM        EQU   7
       0001       00057 TMR2IF      EQU   1
       0001       00058 TMR2IE      EQU   1
       0000       00059 bUdw        EQU   0
       00B2       00060 ancho_pwm   EQU   0xB2
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 2

ADDR   CODE       LINE  SOURCE

       00B4       00061 Vmax        EQU   0xB4
       00B6       00062 SENO        EQU   0xB6
       00B7       00063 T           EQU   0xB7
       00B8       00064 i           EQU   0xB8
       00B9       00065 estado      EQU   0xB9
       0060       00066 svrSTATUS   EQU   0x60
       0061       00067 svrBSR      EQU   0x61
       0062       00068 svrWREG     EQU   0x62
       0063       00069 sv_PRODL    EQU   0x63
       0064       00070 sv_PRODH    EQU   0x64
       0065       00071 sv_TBLPTR   EQU   0x65
       0068       00072 sv_TABLAT   EQU   0x68
       00AD       00073 PDel0       EQU   0xAD
       00AD       00074 PDel0_2     EQU   0xAD
       00AE       00075 PDel1       EQU   0xAE
       0F7F       00076 PDel0_3     EQU   0xF7F
       0F7F       00077 PDel1_2     EQU   0xF7F
       0F7F       00078 PDel2       EQU   0xF7F
       0F7F       00079 PDel0_4     EQU   0xF7F
       0F7F       00080 PDel1_3     EQU   0xF7F
       0F7F       00081 PDel2_2     EQU   0xF7F
       0F7F       00082 PDel0_5     EQU   0xF7F
       0F7F       00083 PDel1_4     EQU   0xF7F
       0F7F       00084 PDel2_3     EQU   0xF7F
       0097       00085 codigo      EQU   0x97
       00AC       00086 comando     EQU   0xAC
       0098       00087 dato        EQU   0x98
       0099       00088 i_2         EQU   0x99
       0098       00089 dato_2      EQU   0x98
       0099       00090 i_3         EQU   0x99
       0096       00091 i_4         EQU   0x96
       0098       00092 linea       EQU   0x98
       0099       00093 columna     EQU   0x99
       0F7F       00094 linea_2     EQU   0xF7F
       0F7F       00095 i_5         EQU   0xF7F
       0F7F       00096 linea_3     EQU   0xF7F
       0F7F       00097 columna_2   EQU   0xF7F
       0F7F       00098 dato_3      EQU   0xF7F
       0000       00099 bd          EQU   0
       0000       00100 dp          EQU   0
       0000       00101 xi          EQU   0
       0000       00102 ndp         EQU   0
       0F7F       00103 num         EQU   0xF7F
       0F7F       00104 u_milers    EQU   0xF7F
       0F7F       00105 cent        EQU   0xF7F
       0F7F       00106 dec         EQU   0xF7F
       0F7F       00107 unid        EQU   0xF7F
       0F7F       00108 resto1      EQU   0xF7F
       0F7F       00109 i_6         EQU   0xF7F
       0F7F       00110 xx          EQU   0xF7F
       0F7F       00111 dat         EQU   0xF7F
       0F7F       00112 xy          EQU   0xF7F
       0F7F       00113 C3cnt       EQU   0xF7F
       0F7F       00114 C4tmp       EQU   0xF7F
       0F7F       00115 C5rem       EQU   0xF7F
       0F7F       00116 C6cnt       EQU   0xF7F
       0F7F       00117 C7tmp       EQU   0xF7F
       0F7F       00118 C8cnt       EQU   0xF7F
       0F7F       00119 C9tmp       EQU   0xF7F
       0F7F       00120 C10rem      EQU   0xF7F
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 3

ADDR   CODE       LINE  SOURCE

       0F7F       00121 C11cnt      EQU   0xF7F
       0F7F       00122 C12tmp      EQU   0xF7F
       0F7F       00123 C13cnt      EQU   0xF7F
       0F7F       00124 C14tmp      EQU   0xF7F
       0F7F       00125 C15rem      EQU   0xF7F
       0F7F       00126 C16cnt      EQU   0xF7F
       0F7F       00127 C17tmp      EQU   0xF7F
       0098       00128 linea_4     EQU   0x98
       0099       00129 columna_3   EQU   0x99
       009A       00130 dato_4      EQU   0x9A
       009C       00131 num_2       EQU   0x9C
       009E       00132 u_milers_2  EQU   0x9E
       00A0       00133 cent_2      EQU   0xA0
       00A2       00134 d_milers    EQU   0xA2
       00A4       00135 dec_2       EQU   0xA4
       00A5       00136 unid_2      EQU   0xA5
       00A6       00137 resto1_2    EQU   0xA6
       00A7       00138 i_7         EQU   0xA7
       00A8       00139 xx_2        EQU   0xA8
       00AA       00140 dat_2       EQU   0xAA
       00AC       00141 C18cnt      EQU   0xAC
       00AD       00142 C19tmp      EQU   0xAD
       00AF       00143 C20rem      EQU   0xAF
       00AC       00144 C21cnt      EQU   0xAC
       00AD       00145 C22tmp      EQU   0xAD
       00AC       00146 C23cnt      EQU   0xAC
       00AD       00147 C24tmp      EQU   0xAD
       00AF       00148 C25rem      EQU   0xAF
       00AC       00149 C26cnt      EQU   0xAC
       00AD       00150 C27tmp      EQU   0xAD
       00AC       00151 C28cnt      EQU   0xAC
       00AD       00152 C29tmp      EQU   0xAD
       00AF       00153 C30rem      EQU   0xAF
       00AC       00154 C31cnt      EQU   0xAC
       00AD       00155 C32tmp      EQU   0xAD
       00AC       00156 C33cnt      EQU   0xAC
       00AD       00157 C34tmp      EQU   0xAD
       00AE       00158 C35rem      EQU   0xAE
       00AC       00159 C36cnt      EQU   0xAC
       00AD       00160 C37tmp      EQU   0xAD
       0096       00161 i_8         EQU   0x96
       0098       00162 canal       EQU   0x98
       0099       00163 bits        EQU   0x99
       009A       00164 resultado   EQU   0x9A
       006C       00165 p           EQU   0x6C
       006D       00166 h           EQU   0x6D
       006E       00167 x           EQU   0x6E
       007B       00168 ac          EQU   0x7B
       0089       00169 ic          EQU   0x89
       008B       00170 rf          EQU   0x8B
       008D       00171 dif         EQU   0x8D
       008F       00172 difMediaAC  EQU   0x8F
       0091       00173 difMediaIC  EQU   0x91
       0093       00174 vbat        EQU   0x93
       0094       00175 o           EQU   0x94
       0003       00176 vuelta      EQU   3
       0004       00177 flancoVAC   EQU   4
       0005       00178 flancoIAC   EQU   5
       0098       00179 C40cnt      EQU   0x98
       0099       00180 C41tmp      EQU   0x99
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 4

ADDR   CODE       LINE  SOURCE

       009B       00181 C42rem      EQU   0x9B
       0098       00182 C43cnt      EQU   0x98
       0099       00183 C44tmp      EQU   0x99
       009B       00184 C45rem      EQU   0x9B
       0096       00185 bat         EQU   0x96
       0069       00186 ci          EQU   0x69
                  00187 
000000 EF7B F006  00188 	GOTO main
                  00189 
                  00190   ; FILE ondulador_migrado.c
                  00191 			;/*
                  00192 			; * Autor: J_Sanchez
                  00193 			; * 
                  00194 			; * Fecha: 31-03-2015
                  00195 			; * Descripcion:Primera prueba con el 18F44K20 para el proyecto del ondulador v2.0
                  00196 			; *  Configuracion: 
                  00197 			; *		Modelo: 18F44K20
                  00198 			; *		Oscilador: Crystal 64Mhz
                  00199 			; *		Puente en H con PWM mejorado
                  00200 			; */
                  00201 			;
                  00202 			; //**************************************************************************************//
                  00203 			; //******************* C O N F I G  U R A C I O N    I N I C I A L  *********************//
                  00204 			; //**************************************************************************************//
                  00205 			; 
                  00206 			; #pragma chip PIC18F44K20
                  00207 			; #pragma config[1] = 0b.0000.1000//pagina 301 datasheet
                  00208 			; #pragma config[2] = 0b.0000.0001
                  00209 			; #pragma config[3] = 0b.0001.0110
                  00210 			; #pragma config[5] = 0b.1000.1000//Mirar CCP2 MUX bit 0 
                  00211 			; 				//-->1 = CCP2 input/output is multiplexed with RC1
                  00212 			;				//   -->0 = CCP2 input/output is multiplexed with RB3 
                  00213 			; #pragma config[6] = 0b.1000.0001
                  00214 			; // resto configs son para la proteccion del programa 
                  00215 			;
                  00216 			; #pragma sharedAllocation//evita error en las interrupciones
                  00217 			;
                  00218 			; //**************************************************************************************//
                  00219 			; //********************************  V A R I A B L E S  *********************************//
                  00220 			; //**************************************************************************************//
                  00221 			;#define NEGATIVO 0
                  00222 			;#define POSITIVO 1
                  00223 			;
                  00224 			;#define LECTURA_VAC  0
                  00225 			;#define CALCULOS_VAC 1
                  00226 			;#define LECTURA_IAC  2
                  00227 			;#define CALCULOS_IAC 3
                  00228 			;#define LECTURAS_VARIAS 4
                  00229 			;#define ENVIO_LCD    5
                  00230 			;
                  00231 			;#define LEO_VAC		 0
                  00232 			;#define LEO_BAT		 1
                  00233 			;#define LEO_IAC		 2
                  00234 			;
                  00235 			;#define LOGO_SC		 0
                  00236 			;#define BATT_FULL	 1
                  00237 			;#define BATT_75		 2
                  00238 			;#define BATT_50		 3
                  00239 			;#define BATT_25		 4
                  00240 			;#define BATT_10		 5
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 5

ADDR   CODE       LINE  SOURCE

                  00241 			;#define BATT_LW		 6 
                  00242 			;#define BATT_CLEAR	 7
                  00243 			;
                  00244 			;
                  00245 			;#pragma rambank 0
                  00246 			;bit bUdw; // a 1 puja en la taula (incrementa) , a 0 decrementa
                  00247 			;uns16 ancho_pwm;
                  00248 			;uns16 Vmax;
                  00249 			;uns8 SENO;
                  00250 			;char T,i,estado; // Index de la taula
                  00251 			;
                  00252 			;
                  00253 			;static const char sen [26] = 			
                  00254 			;{0,8,16,23,31,39,47,54,61,68,75,81,87,93,98,103,108,112,115,119,121,123,125,126,127,128};
                  00255 			;// PWM maximo 799 para ser 100% 
                  00256 			;
                  00257 			;//=======================================================================
                  00258 			;#include "int18XXX.h"	 // Cap√ßalera de interrupcions.
                  00259 			;
                  00260 			;#pragma origin 0x08	//#pragma origin 0x18	(PIC 16F88x)
       0000       00261 	ORG 0x0008
                  00262 			;
                  00263 			;interrupt highPriorityTimer_0 (void)		// Interrupci√≥n por desbordamiento de Timer 0.			
                  00264 			;{
                  00265 highPriorityTimer_0
                  00266 			;	int_save_registers 
000008 CFD8 F060  00267 	MOVFF STATUS,svrSTATUS
00000C CFE0 F061  00268 	MOVFF BSR,svrBSR
000010 0100       00269 	MOVLB 0
000012 6F62       00270 	MOVWF svrWREG,1
                  00271 			;
                  00272 			;	// save remaining registers on demand (error/warning)
                  00273 			;	//uns16 sv_FSR0 = FSR0;
                  00274 			;	//uns16 sv_FSR1 = FSR1;
                  00275 			;	//uns16 sv_FSR2 = FSR2;
                  00276 			;	//uns8 sv_PCLATH = PCLATH;
                  00277 			;	//uns8 sv_PCLATU = PCLATU;
                  00278 			;	uns8 sv_PRODL = PRODL;
000014 CFF3 F063  00279 	MOVFF PRODL,sv_PRODL
                  00280 			;	uns8 sv_PRODH = PRODH;
000018 CFF4 F064  00281 	MOVFF PRODH,sv_PRODH
                  00282 			;	uns24 sv_TBLPTR = TBLPTR;
00001C CFF6 F065  00283 	MOVFF TBLPTR,sv_TBLPTR
000020 CFF7 F066  00284 	MOVFF TBLPTR+1,sv_TBLPTR+1
000024 CFF8 F067  00285 	MOVFF TBLPTR+2,sv_TBLPTR+2
                  00286 			;	uns8 sv_TABLAT = TABLAT;
000028 CFF5 F068  00287 	MOVFF TABLAT,sv_TABLAT
                  00288 			;
                  00289 			;
                  00290 			;	     				// Guarda W, STATUS y PCLATH.
                  00291 			;	LATC.0=!LATC.0;
00002C 708B       00292 	BTG   LATC,0,0
                  00293 			;	if(TMR2IF) 	//{ LATD.0= !LATD.0; TMR2IF=0; }
00002E A29E       00294 	BTFSS 0xF9E,TMR2IF,0
000030 D051       00295 	BRA   m008
                  00296 			;	{ 
                  00297 			;		T2CON = 0b.0.0011.1.01; TMR2IF =0; //TMR2ON =1; // PostScaler per 4
000032 0E1D       00298 	MOVLW 29
000034 6ECA       00299 	MOVWF T2CON,0
000036 929E       00300 	BCF   0xF9E,TMR2IF,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 6

ADDR   CODE       LINE  SOURCE

                  00301 			;		for (i = 1; i <= 6; i ++)  ancho_pwm = rl (ancho_pwm);
000038 0E01       00302 	MOVLW 1
00003A 6FB8       00303 	MOVWF i,1
00003C 0E07       00304 m001	MOVLW 7
00003E 0100       00305 	MOVLB 0
000040 61B8       00306 	CPFSLT i,1
000042 D004       00307 	BRA   m002
000044 37B2       00308 	RLCF  ancho_pwm,1,1
000046 37B3       00309 	RLCF  ancho_pwm+1,1,1
000048 2BB8       00310 	INCF  i,1,1
00004A D7F8       00311 	BRA   m001
                  00312 			;		CCPR1L    = ancho_pwm.high8;	CCP1CON.5 = ancho_pwm.7;	CCP1CON.4 = ancho_pwm.6;
00004C C0B3 FFBE  00313 m002	MOVFF ancho_pwm+1,CCPR1L
000050 0100       00314 	MOVLB 0
000052 AFB2       00315 	BTFSS ancho_pwm,7,1
000054 9ABD       00316 	BCF   CCP1CON,5,0
000056 BFB2       00317 	BTFSC ancho_pwm,7,1
000058 8ABD       00318 	BSF   CCP1CON,5,0
00005A ADB2       00319 	BTFSS ancho_pwm,6,1
00005C 98BD       00320 	BCF   CCP1CON,4,0
00005E BDB2       00321 	BTFSC ancho_pwm,6,1
000060 88BD       00322 	BSF   CCP1CON,4,0
                  00323 			;				  
                  00324 			;		if(bUdw) 	{ if(T>=25)  bUdw=0;      
000062 A1B1       00325 	BTFSS 0xB1,bUdw,1
000064 D007       00326 	BRA   m004
000066 0E18       00327 	MOVLW 24
000068 65B7       00328 	CPFSGT T,1
00006A D002       00329 	BRA   m003
00006C 91B1       00330 	BCF   0xB1,bUdw,1
                  00331 			;				      else        T++;
00006E D002       00332 	BRA   m004
000070 0100       00333 m003	MOVLB 0
000072 2BB7       00334 	INCF  T,1,1
                  00335 			;					} 
                  00336 			;		if(!bUdw)   T--;                       
000074 0100       00337 m004	MOVLB 0
000076 A1B1       00338 	BTFSS 0xB1,bUdw,1
000078 07B7       00339 	DECF  T,1,1
                  00340 			;		if(T==0) 
00007A 0100       00341 	MOVLB 0
00007C 53B7       00342 	MOVF  T,1,1
00007E A4D8       00343 	BTFSS 0xFD8,Zero_,0
000080 D019       00344 	BRA   m007
                  00345 			;		{  	while(!TMR2IF); TMR2IF =0; // ESPERO QUE ACABI  T=1
000082 A29E       00346 m005	BTFSS 0xF9E,TMR2IF,0
000084 D7FE       00347 	BRA   m005
000086 929E       00348 	BCF   0xF9E,TMR2IF,0
                  00349 			;			T2CON = 0b.0.0001.1.01;  	CCPR1L = 0;		CCP1CON.5 = 0;	CCP1CON.4 = 0;	 
000088 0E0D       00350 	MOVLW 13
00008A 6ECA       00351 	MOVWF T2CON,0
00008C 6ABE       00352 	CLRF  CCPR1L,0
00008E 9ABD       00353 	BCF   CCP1CON,5,0
000090 98BD       00354 	BCF   CCP1CON,4,0
                  00355 			;			// Posrescaler a 2
                  00356 			;			//while(!TMR2IF); // espero que acabi el T=0
                  00357 			;			//	TMR2IF =0; // Postscaler a 2
                  00358 			;			while(!TMR2IF); // espeor que acabi la 1era meitat del T=0, postsclaer =2
000092 A29E       00359 m006	BTFSS 0xF9E,TMR2IF,0
000094 D7FE       00360 	BRA   m006
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 7

ADDR   CODE       LINE  SOURCE

                  00361 			;			TMR2IF =0; 	T2CON = 0b.0.0000.1.01;  	CCPR1L = 0;		CCP1CON.5 = 0;	CCP1CON.4 = 0;
000096 929E       00362 	BCF   0xF9E,TMR2IF,0
000098 0E05       00363 	MOVLW 5
00009A 6ECA       00364 	MOVWF T2CON,0
00009C 6ABE       00365 	CLRF  CCPR1L,0
00009E 9ABD       00366 	BCF   CCP1CON,5,0
0000A0 98BD       00367 	BCF   CCP1CON,4,0
                  00368 			;			LATD.0= !LATD.0;	bUdw=1;  T=1; if(estado==ENVIO_LCD) estado = LECTURA_VAC;  // el deixo sortir
0000A2 708C       00369 	BTG   LATD,0,0
0000A4 0100       00370 	MOVLB 0
0000A6 81B1       00371 	BSF   0xB1,bUdw,1
0000A8 0E01       00372 	MOVLW 1
0000AA 6FB7       00373 	MOVWF T,1
0000AC 0E05       00374 	MOVLW 5
0000AE 63B9       00375 	CPFSEQ estado,1
0000B0 D001       00376 	BRA   m007
0000B2 6BB9       00377 	CLRF  estado,1
                  00378 			;		}			  
                  00379 			;							
                  00380 			;		SENO = sen[T];			
0000B4 0100       00381 m007	MOVLB 0
0000B6 51B7       00382 	MOVF  T,W,1
0000B8 ECAB F009  00383 	CALL  _const1
0000BC 0100       00384 	MOVLB 0
0000BE 6FB6       00385 	MOVWF SENO,1
                  00386 			;		ancho_pwm = (uns16)SENO*Vmax;
0000C0 51B6       00387 	MOVF  SENO,W,1
0000C2 03B4       00388 	MULWF Vmax,1
0000C4 CFF3 F0B2  00389 	MOVFF PRODL,ancho_pwm
0000C8 CFF4 F0B3  00390 	MOVFF PRODH,ancho_pwm+1
0000CC 51B6       00391 	MOVF  SENO,W,1
0000CE 03B5       00392 	MULWF Vmax+1,1
0000D0 50F3       00393 	MOVF  PRODL,W,0
0000D2 27B3       00394 	ADDWF ancho_pwm+1,1,1
                  00395 			;				  			  
                  00396 			;	} 
                  00397 			;			
                  00398 			;	// restore registers that are saved
                  00399 			;	//FSR0 = sv_FSR0;
                  00400 			;	//FSR1 = sv_FSR1;
                  00401 			;	//FSR2 = sv_FSR2;
                  00402 			;	//PCLATH = sv_PCLATH;
                  00403 			;	//PCLATU = sv_PCLATU;
                  00404 			;	PRODL = sv_PRODL;
0000D4 C063 FFF3  00405 m008	MOVFF sv_PRODL,PRODL
                  00406 			;	PRODH = sv_PRODH;
0000D8 C064 FFF4  00407 	MOVFF sv_PRODH,PRODH
                  00408 			;	TBLPTR = sv_TBLPTR;
0000DC C065 FFF6  00409 	MOVFF sv_TBLPTR,TBLPTR
0000E0 C066 FFF7  00410 	MOVFF sv_TBLPTR+1,TBLPTR+1
0000E4 C067 FFF8  00411 	MOVFF sv_TBLPTR+2,TBLPTR+2
                  00412 			;	TABLAT = sv_TABLAT;
0000E8 C068 FFF5  00413 	MOVFF sv_TABLAT,TABLAT
                  00414 			;
                  00415 			;    int_restore_registers 					// Devuelve W, STATUS y PCLATH.
0000EC 0100       00416 	MOVLB 0
0000EE 5162       00417 	MOVF  svrWREG,W,1
0000F0 C061 FFE0  00418 	MOVFF svrBSR,BSR
0000F4 C060 FFD8  00419 	MOVFF svrSTATUS,STATUS
                  00420 			;}
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 8

ADDR   CODE       LINE  SOURCE

0000F8 0010       00421 	RETFIE
                  00422 
                  00423   ; FILE Temporiz_64Mhz.h
                  00424 			;void retardo_20u(void){
                  00425 retardo_20u
                  00426 			;	
                  00427 			;		char PDel0;
                  00428 			;		#asm
                  00429 			;		;-------------------------------------------------------------
                  00430 			;		DEMORA  movlw     .78       ; 1 set numero de repeticion 
0000FA 0E4E       00431 	MOVLW 78
                  00432 			;		        movwf     PDel0     ; 1 |
0000FC 6FAD       00433 	MOVWF PDel0,1
                  00434 			;		PLoop0  clrwdt              ; 1 clear watchdog
0000FE 0004       00435 m009	CLRWDT
                  00436 			;		        decfsz    PDel0, 1  ; 1 + (1) es el tiempo 0  ?
000100 2FAD       00437 	DECFSZ PDel0,1,1
                  00438 			;		        goto      PLoop0    ; 2 no, loop
000102 EF7F F000  00439 	GOTO  m009
                  00440 			;		PDelL1  goto PDelL2         ; 2 ciclos delay
000106 EF85 F000  00441 	GOTO  m010
                  00442 			;		PDelL2  clrwdt              ; 1 ciclo delay
00010A 0004       00443 m010	CLRWDT
                  00444 			;		        return              ; 2+2 Fin.
00010C 0012       00445 	RETURN
                  00446 			;		;-------------------------------------------------------------
                  00447 			;		#endasm
                  00448 			;	
                  00449 			;}
                  00450 			;void retardo_1m(void){
                  00451 retardo_1m
                  00452 			;	char PDel0,PDel1;
                  00453 			;	#asm
                  00454 			;	;-------------------------------------------------------------
                  00455 			;	DEMORA  movlw     .15       ; 1 set numero de repeticion  (B)
00010E 0E0F       00456 	MOVLW 15
                  00457 			;	        movwf     PDel0     ; 1 |
000110 6FAD       00458 	MOVWF PDel0_2,1
                  00459 			;	PLoop1  movlw     .177      ; 1 set numero de repeticion  (A)
000112 0EB1       00460 m011	MOVLW 177
                  00461 			;	        movwf     PDel1     ; 1 |
000114 6FAE       00462 	MOVWF PDel1,1
                  00463 			;	PLoop2  clrwdt              ; 1 clear watchdog
000116 0004       00464 m012	CLRWDT
                  00465 			;	PDelL1  goto PDelL2         ; 2 ciclos delay
000118 EF8E F000  00466 	GOTO  m013
                  00467 			;	PDelL2  
                  00468 			;	        decfsz    PDel1, 1  ; 1 + (1) es el tiempo 0  ? (A)
00011C 2FAE       00469 m013	DECFSZ PDel1,1,1
                  00470 			;	        goto      PLoop2    ; 2 no, loop
00011E EF8B F000  00471 	GOTO  m012
                  00472 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (B)
000122 2FAD       00473 	DECFSZ PDel0_2,1,1
                  00474 			;	        goto      PLoop1    ; 2 no, loop
000124 EF89 F000  00475 	GOTO  m011
                  00476 			;	PDelL3  goto PDelL4         ; 2 ciclos delay
000128 EF96 F000  00477 	GOTO  m014
                  00478 			;	PDelL4  goto PDelL5         ; 2 ciclos delay
00012C EF98 F000  00479 m014	GOTO  m015
                  00480 			;	PDelL5  clrwdt              ; 1 ciclo delay
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 9

ADDR   CODE       LINE  SOURCE

000130 0004       00481 m015	CLRWDT
                  00482 			;	        return              ; 2+2 Fin.
000132 0012       00483 	RETURN
                  00484 			;	;-------------------------------------------------------------
                  00485 			;	#endasm
                  00486 			;}
                  00487 			;void retardo_50m(void){
                  00488 retardo_50m
                  00489 			;	char PDel0,PDel1,PDel2;
                  00490 			;	#asm
                  00491 			;	;-------------------------------------------------------------
                  00492 			;	DEMORA  movlw     .18       ; 1 set numero de repeticion  (C)
000134 0E12       00493 	MOVLW 18
                  00494 			;	        movwf     PDel0     ; 1 |
000136 6E7F       00495 	MOVWF PDel0_3,0
                  00496 			;	PLoop0  movlw     .55       ; 1 set numero de repeticion  (B)
000138 0E37       00497 m016	MOVLW 55
                  00498 			;	        movwf     PDel1     ; 1 |
00013A 6E7F       00499 	MOVWF PDel1_2,0
                  00500 			;	PLoop1  movlw     .201      ; 1 set numero de repeticion  (A)
00013C 0EC9       00501 m017	MOVLW 201
                  00502 			;	        movwf     PDel2     ; 1 |
00013E 6E7F       00503 	MOVWF PDel2,0
                  00504 			;	PLoop2  clrwdt              ; 1 clear watchdog
000140 0004       00505 m018	CLRWDT
                  00506 			;	        decfsz    PDel2, 1  ; 1 + (1) es el tiempo 0  ? (A)
000142 2E7F       00507 	DECFSZ PDel2,1,0
                  00508 			;	        goto      PLoop2    ; 2 no, loop
000144 EFA0 F000  00509 	GOTO  m018
                  00510 			;	        decfsz    PDel1,  1 ; 1 + (1) es el tiempo 0  ? (B)
000148 2E7F       00511 	DECFSZ PDel1_2,1,0
                  00512 			;	        goto      PLoop1    ; 2 no, loop
00014A EF9E F000  00513 	GOTO  m017
                  00514 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (C)
00014E 2E7F       00515 	DECFSZ PDel0_3,1,0
                  00516 			;	        goto      PLoop0    ; 2 no, loop
000150 EF9C F000  00517 	GOTO  m016
                  00518 			;	PDelL1  goto PDelL2         ; 2 ciclos delay
000154 EFAC F000  00519 	GOTO  m019
                  00520 			;	PDelL2  clrwdt              ; 1 ciclo delay
000158 0004       00521 m019	CLRWDT
                  00522 			;	        return              ; 2+2 Fin.
00015A 0012       00523 	RETURN
                  00524 			;	;-------------------------------------------------------------
                  00525 			;	#endasm
                  00526 			;}
                  00527 			;void retardo_100m(void){
                  00528 retardo_100m
                  00529 			;	char PDel0,PDel1,PDel2;
                  00530 			;	#asm
                  00531 			;	;-------------------------------------------------------------
                  00532 			;	DEMORA  movlw     .23       ; 1 set numero de repeticion  (C)
00015C 0E17       00533 	MOVLW 23
                  00534 			;	        movwf     PDel0     ; 1 |
00015E 6E7F       00535 	MOVWF PDel0_4,0
                  00536 			;	PLoop0  movlw     .59       ; 1 set numero de repeticion  (B)
000160 0E3B       00537 m020	MOVLW 59
                  00538 			;	        movwf     PDel1     ; 1 |
000162 6E7F       00539 	MOVWF PDel1_3,0
                  00540 			;	PLoop1  movlw     .235      ; 1 set numero de repeticion  (A)
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 10

ADDR   CODE       LINE  SOURCE

000164 0EEB       00541 m021	MOVLW 235
                  00542 			;	        movwf     PDel2     ; 1 |
000166 6E7F       00543 	MOVWF PDel2_2,0
                  00544 			;	PLoop2  clrwdt              ; 1 clear watchdog
000168 0004       00545 m022	CLRWDT
                  00546 			;	        clrwdt              ; 1 ciclo delay
00016A 0004       00547 	CLRWDT
                  00548 			;	        decfsz    PDel2, 1  ; 1 + (1) es el tiempo 0  ? (A)
00016C 2E7F       00549 	DECFSZ PDel2_2,1,0
                  00550 			;	        goto      PLoop2    ; 2 no, loop
00016E EFB4 F000  00551 	GOTO  m022
                  00552 			;	        decfsz    PDel1,  1 ; 1 + (1) es el tiempo 0  ? (B)
000172 2E7F       00553 	DECFSZ PDel1_3,1,0
                  00554 			;	        goto      PLoop1    ; 2 no, loop
000174 EFB2 F000  00555 	GOTO  m021
                  00556 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (C)
000178 2E7F       00557 	DECFSZ PDel0_4,1,0
                  00558 			;	        goto      PLoop0    ; 2 no, loop
00017A EFB0 F000  00559 	GOTO  m020
                  00560 			;	        return              ; 2+2 Fin.
00017E 0012       00561 	RETURN
                  00562 			;	;-------------------------------------------------------------
                  00563 			;	#endasm
                  00564 			;}
                  00565 			;void retardo_500m(void){
                  00566 retardo_500m
                  00567 			;	char PDel0,PDel1,PDel2;
                  00568 			;	#asm
                  00569 			;	;-------------------------------------------------------------
                  00570 			;	DEMORA  movlw     .54       ; 1 set numero de repeticion  (C)
000180 0E36       00571 	MOVLW 54
                  00572 			;	        movwf     PDel0     ; 1 |
000182 6E7F       00573 	MOVWF PDel0_5,0
                  00574 			;	PLoop0  movlw     .188      ; 1 set numero de repeticion  (B)
000184 0EBC       00575 m023	MOVLW 188
                  00576 			;	        movwf     PDel1     ; 1 |
000186 6E7F       00577 	MOVWF PDel1_4,0
                  00578 			;	PLoop1  movlw     .196      ; 1 set numero de repeticion  (A)
000188 0EC4       00579 m024	MOVLW 196
                  00580 			;	        movwf     PDel2     ; 1 |
00018A 6E7F       00581 	MOVWF PDel2_3,0
                  00582 			;	PLoop2  clrwdt              ; 1 clear watchdog
00018C 0004       00583 m025	CLRWDT
                  00584 			;	        decfsz    PDel2, 1  ; 1 + (1) es el tiempo 0  ? (A)
00018E 2E7F       00585 	DECFSZ PDel2_3,1,0
                  00586 			;	        goto      PLoop2    ; 2 no, loop
000190 EFC6 F000  00587 	GOTO  m025
                  00588 			;	        decfsz    PDel1,  1 ; 1 + (1) es el tiempo 0  ? (B)
000194 2E7F       00589 	DECFSZ PDel1_4,1,0
                  00590 			;	        goto      PLoop1    ; 2 no, loop
000196 EFC4 F000  00591 	GOTO  m024
                  00592 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (C)
00019A 2E7F       00593 	DECFSZ PDel0_5,1,0
                  00594 			;	        goto      PLoop0    ; 2 no, loop
00019C EFC2 F000  00595 	GOTO  m023
                  00596 			;	PDelL1  goto PDelL2         ; 2 ciclos delay
0001A0 EFD2 F000  00597 	GOTO  m026
                  00598 			;	PDelL2  clrwdt              ; 1 ciclo delay
0001A4 0004       00599 m026	CLRWDT
                  00600 			;	        return              ; 2+2 Fin.
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 11

ADDR   CODE       LINE  SOURCE

0001A6 0012       00601 	RETURN
                  00602 			;	;-------------------------------------------------------------
                  00603 			;	#endasm
                  00604 
                  00605   ; FILE LCD_4bit.h
                  00606 			;
                  00607 			;/*
                  00608 			;	ESTA LIBRERIA NO SIRVE PARA LA PLACA DE PROTOTIPOS ES SOLO PARA LA PLACA DEL ONDULADOR!!!!!
                  00609 			;*/
                  00610 			;
                  00611 			;void envia_codigo_inicial (char codigo)
                  00612 			;{
                  00613 envia_codigo_inicial
0001A8 0100       00614 	MOVLB 0
0001AA 6F97       00615 	MOVWF codigo,1
                  00616 			;	PORTB.5=0;nop();
0001AC 9A81       00617 	BCF   PORTB,5,0
0001AE 0000       00618 	NOP  
                  00619 			;	PORTB.3 = codigo.4;
0001B0 A997       00620 	BTFSS codigo,4,1
0001B2 9681       00621 	BCF   PORTB,3,0
0001B4 B997       00622 	BTFSC codigo,4,1
0001B6 8681       00623 	BSF   PORTB,3,0
                  00624 			;	nop();
0001B8 0000       00625 	NOP  
                  00626 			;	PORTB.2 = codigo.5;
0001BA AB97       00627 	BTFSS codigo,5,1
0001BC 9481       00628 	BCF   PORTB,2,0
0001BE BB97       00629 	BTFSC codigo,5,1
0001C0 8481       00630 	BSF   PORTB,2,0
                  00631 			;	nop();
0001C2 0000       00632 	NOP  
                  00633 			;	PORTB.1 = codigo.6;
0001C4 AD97       00634 	BTFSS codigo,6,1
0001C6 9281       00635 	BCF   PORTB,1,0
0001C8 BD97       00636 	BTFSC codigo,6,1
0001CA 8281       00637 	BSF   PORTB,1,0
                  00638 			;	nop();
0001CC 0000       00639 	NOP  
                  00640 			;	PORTB.0 = codigo.7;
0001CE AF97       00641 	BTFSS codigo,7,1
0001D0 9081       00642 	BCF   PORTB,0,0
0001D2 BF97       00643 	BTFSC codigo,7,1
0001D4 8081       00644 	BSF   PORTB,0,0
                  00645 			;	nop();
0001D6 0000       00646 	NOP  
                  00647 			;	PORTB.4 = 1; 
0001D8 8881       00648 	BSF   PORTB,4,0
                  00649 			;	retardo_20u();
0001DA DF8F       00650 	RCALL retardo_20u
                  00651 			;	PORTB.4 = 0; 
0001DC 9881       00652 	BCF   PORTB,4,0
                  00653 			;
                  00654 			;	return;
0001DE 0012       00655 	RETURN
                  00656 			;}
                  00657 			; 
                  00658 			;void enviar_comando (char comando) 
                  00659 			;{
                  00660 enviar_comando
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 12

ADDR   CODE       LINE  SOURCE

0001E0 0100       00661 	MOVLB 0
0001E2 6FAC       00662 	MOVWF comando,1
                  00663 			;	
                  00664 			;	PORTB.3 =  comando.4;nop();
0001E4 A9AC       00665 	BTFSS comando,4,1
0001E6 9681       00666 	BCF   PORTB,3,0
0001E8 B9AC       00667 	BTFSC comando,4,1
0001EA 8681       00668 	BSF   PORTB,3,0
0001EC 0000       00669 	NOP  
                  00670 			;	PORTB.2 =  comando.5;nop();
0001EE ABAC       00671 	BTFSS comando,5,1
0001F0 9481       00672 	BCF   PORTB,2,0
0001F2 BBAC       00673 	BTFSC comando,5,1
0001F4 8481       00674 	BSF   PORTB,2,0
0001F6 0000       00675 	NOP  
                  00676 			;	PORTB.1 =  comando.6;nop();
0001F8 ADAC       00677 	BTFSS comando,6,1
0001FA 9281       00678 	BCF   PORTB,1,0
0001FC BDAC       00679 	BTFSC comando,6,1
0001FE 8281       00680 	BSF   PORTB,1,0
000200 0000       00681 	NOP  
                  00682 			;	PORTB.0 =  comando.7;
000202 AFAC       00683 	BTFSS comando,7,1
000204 9081       00684 	BCF   PORTB,0,0
000206 BFAC       00685 	BTFSC comando,7,1
000208 8081       00686 	BSF   PORTB,0,0
                  00687 			;	retardo_1m ();
00020A DF81       00688 	RCALL retardo_1m
                  00689 			;	PORTB.5 = 0;  									// Modo comando.
00020C 9A81       00690 	BCF   PORTB,5,0
                  00691 			;	retardo_20u (); //
00020E DF75       00692 	RCALL retardo_20u
                  00693 			;	PORTB.4 = 1;  									// Breve pulso.
000210 8881       00694 	BSF   PORTB,4,0
                  00695 			;	retardo_20u ();
000212 DF73       00696 	RCALL retardo_20u
                  00697 			;	PORTB.4 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000214 9881       00698 	BCF   PORTB,4,0
                  00699 			;	retardo_1m ();
000216 DF7B       00700 	RCALL retardo_1m
                  00701 			;	retardo_1m ();
000218 DF7A       00702 	RCALL retardo_1m
                  00703 			;	comando = swap (comando);
00021A 0100       00704 	MOVLB 0
00021C 3BAC       00705 	SWAPF comando,1,1
                  00706 			;	PORTB.3 =  comando.4;nop();
00021E A9AC       00707 	BTFSS comando,4,1
000220 9681       00708 	BCF   PORTB,3,0
000222 B9AC       00709 	BTFSC comando,4,1
000224 8681       00710 	BSF   PORTB,3,0
000226 0000       00711 	NOP  
                  00712 			;	PORTB.2 =  comando.5;nop();
000228 ABAC       00713 	BTFSS comando,5,1
00022A 9481       00714 	BCF   PORTB,2,0
00022C BBAC       00715 	BTFSC comando,5,1
00022E 8481       00716 	BSF   PORTB,2,0
000230 0000       00717 	NOP  
                  00718 			;	PORTB.1 =  comando.6;nop();
000232 ADAC       00719 	BTFSS comando,6,1
000234 9281       00720 	BCF   PORTB,1,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 13

ADDR   CODE       LINE  SOURCE

000236 BDAC       00721 	BTFSC comando,6,1
000238 8281       00722 	BSF   PORTB,1,0
00023A 0000       00723 	NOP  
                  00724 			;	PORTB.0 =  comando.7;nop();
00023C AFAC       00725 	BTFSS comando,7,1
00023E 9081       00726 	BCF   PORTB,0,0
000240 BFAC       00727 	BTFSC comando,7,1
000242 8081       00728 	BSF   PORTB,0,0
000244 0000       00729 	NOP  
                  00730 			;	retardo_1m ();
000246 DF63       00731 	RCALL retardo_1m
                  00732 			;	PORTB.5 = 0;  									// Modo comando.
000248 9A81       00733 	BCF   PORTB,5,0
                  00734 			;	retardo_20u ();
00024A DF57       00735 	RCALL retardo_20u
                  00736 			;	PORTB.4 = 1;  									// Breve pulso.
00024C 8881       00737 	BSF   PORTB,4,0
                  00738 			;	retardo_20u ();
00024E DF55       00739 	RCALL retardo_20u
                  00740 			;	PORTB.4 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000250 9881       00741 	BCF   PORTB,4,0
                  00742 			;	retardo_1m ();
000252 DF5D       00743 	RCALL retardo_1m
                  00744 			;	retardo_1m ();
000254 D75C       00745 	BRA   retardo_1m
                  00746 			;	//leds_OFF (10);
                  00747 			;	
                  00748 			;	
                  00749 			;	return;
                  00750 			;}    
                  00751 			;
                  00752 			;void enviar_literal (char dato) 
                  00753 			;{
                  00754 enviar_literal
000256 0100       00755 	MOVLB 0
000258 6F98       00756 	MOVWF dato,1
                  00757 			;    char i;
                  00758 			;
                  00759 			;	
                  00760 			;	PORTB.3 = dato.4;
00025A A998       00761 	BTFSS dato,4,1
00025C 9681       00762 	BCF   PORTB,3,0
00025E B998       00763 	BTFSC dato,4,1
000260 8681       00764 	BSF   PORTB,3,0
                  00765 			;	nop();
000262 0000       00766 	NOP  
                  00767 			;	PORTB.2 = dato.5;
000264 AB98       00768 	BTFSS dato,5,1
000266 9481       00769 	BCF   PORTB,2,0
000268 BB98       00770 	BTFSC dato,5,1
00026A 8481       00771 	BSF   PORTB,2,0
                  00772 			;	nop();
00026C 0000       00773 	NOP  
                  00774 			;	PORTB.1 = dato.6;
00026E AD98       00775 	BTFSS dato,6,1
000270 9281       00776 	BCF   PORTB,1,0
000272 BD98       00777 	BTFSC dato,6,1
000274 8281       00778 	BSF   PORTB,1,0
                  00779 			;	nop();
000276 0000       00780 	NOP  
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 14

ADDR   CODE       LINE  SOURCE

                  00781 			;	PORTB.0 = dato.7;
000278 AF98       00782 	BTFSS dato,7,1
00027A 9081       00783 	BCF   PORTB,0,0
00027C BF98       00784 	BTFSC dato,7,1
00027E 8081       00785 	BSF   PORTB,0,0
                  00786 			;	nop();
000280 0000       00787 	NOP  
                  00788 			;	PORTB.5 = 1;  									// Modo dato.
000282 8A81       00789 	BSF   PORTB,5,0
                  00790 			;	retardo_20u ();
000284 DF3A       00791 	RCALL retardo_20u
                  00792 			;	PORTB.4 = 1;  									// Breve pulso.
000286 8881       00793 	BSF   PORTB,4,0
                  00794 			;	retardo_20u ();
000288 DF38       00795 	RCALL retardo_20u
                  00796 			;	PORTB.4 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
00028A 9881       00797 	BCF   PORTB,4,0
                  00798 			;	for (i = 1; i <= 6; i++) retardo_20u ();
00028C 0E01       00799 	MOVLW 1
00028E 0100       00800 	MOVLB 0
000290 6F99       00801 	MOVWF i_2,1
000292 0E07       00802 m027	MOVLW 7
000294 0100       00803 	MOVLB 0
000296 6199       00804 	CPFSLT i_2,1
000298 D004       00805 	BRA   m028
00029A DF2F       00806 	RCALL retardo_20u
00029C 0100       00807 	MOVLB 0
00029E 2B99       00808 	INCF  i_2,1,1
0002A0 D7F8       00809 	BRA   m027
                  00810 			;	dato = swap (dato);
0002A2 0100       00811 m028	MOVLB 0
0002A4 3B98       00812 	SWAPF dato,1,1
                  00813 			;	PORTB.3 = dato.4;nop();
0002A6 A998       00814 	BTFSS dato,4,1
0002A8 9681       00815 	BCF   PORTB,3,0
0002AA B998       00816 	BTFSC dato,4,1
0002AC 8681       00817 	BSF   PORTB,3,0
0002AE 0000       00818 	NOP  
                  00819 			;	PORTB.2 = dato.5;nop();
0002B0 AB98       00820 	BTFSS dato,5,1
0002B2 9481       00821 	BCF   PORTB,2,0
0002B4 BB98       00822 	BTFSC dato,5,1
0002B6 8481       00823 	BSF   PORTB,2,0
0002B8 0000       00824 	NOP  
                  00825 			;	PORTB.1 = dato.6;nop();
0002BA AD98       00826 	BTFSS dato,6,1
0002BC 9281       00827 	BCF   PORTB,1,0
0002BE BD98       00828 	BTFSC dato,6,1
0002C0 8281       00829 	BSF   PORTB,1,0
0002C2 0000       00830 	NOP  
                  00831 			;	PORTB.0 = dato.7;nop();
0002C4 AF98       00832 	BTFSS dato,7,1
0002C6 9081       00833 	BCF   PORTB,0,0
0002C8 BF98       00834 	BTFSC dato,7,1
0002CA 8081       00835 	BSF   PORTB,0,0
0002CC 0000       00836 	NOP  
                  00837 			;	retardo_1m ();
0002CE DF1F       00838 	RCALL retardo_1m
                  00839 			;	PORTB.5 = 1;  									// Modo dato.
0002D0 8A81       00840 	BSF   PORTB,5,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 15

ADDR   CODE       LINE  SOURCE

                  00841 			;	retardo_1m ();
0002D2 DF1D       00842 	RCALL retardo_1m
                  00843 			;	PORTB.4 = 1;  									// Breve pulso.
0002D4 8881       00844 	BSF   PORTB,4,0
                  00845 			;	retardo_20u ();
0002D6 DF11       00846 	RCALL retardo_20u
                  00847 			;	PORTB.4 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
0002D8 9881       00848 	BCF   PORTB,4,0
                  00849 			;	for (i = 1; i<= 6; i++) retardo_20u ();
0002DA 0E01       00850 	MOVLW 1
0002DC 0100       00851 	MOVLB 0
0002DE 6F99       00852 	MOVWF i_2,1
0002E0 0E07       00853 m029	MOVLW 7
0002E2 0100       00854 	MOVLB 0
0002E4 6199       00855 	CPFSLT i_2,1
0002E6 D004       00856 	BRA   m030
0002E8 DF08       00857 	RCALL retardo_20u
0002EA 0100       00858 	MOVLB 0
0002EC 2B99       00859 	INCF  i_2,1,1
0002EE D7F8       00860 	BRA   m029
                  00861 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.	
0002F0 0E0C       00862 m030	MOVLW 12
0002F2 D776       00863 	BRA   enviar_comando
                  00864 			;	return;
                  00865 			;}   
                  00866 			;
                  00867 			;void enviar_cifra (char dato) 
                  00868 			;{
                  00869 enviar_cifra
0002F4 0100       00870 	MOVLB 0
0002F6 6F98       00871 	MOVWF dato_2,1
                  00872 			;    char i;
                  00873 			;	dato = dato + 0x30; 							// Convierto el n˙mero en su equivalente ASCII literal. 
0002F8 0E30       00874 	MOVLW 48
0002FA 2798       00875 	ADDWF dato_2,1,1
                  00876 			;	PORTB.3 = dato.4;
0002FC A998       00877 	BTFSS dato_2,4,1
0002FE 9681       00878 	BCF   PORTB,3,0
000300 B998       00879 	BTFSC dato_2,4,1
000302 8681       00880 	BSF   PORTB,3,0
                  00881 			;	nop();
000304 0000       00882 	NOP  
                  00883 			;	PORTB.2 = dato.5;
000306 AB98       00884 	BTFSS dato_2,5,1
000308 9481       00885 	BCF   PORTB,2,0
00030A BB98       00886 	BTFSC dato_2,5,1
00030C 8481       00887 	BSF   PORTB,2,0
                  00888 			;	nop();
00030E 0000       00889 	NOP  
                  00890 			;	PORTB.1 = dato.6;
000310 AD98       00891 	BTFSS dato_2,6,1
000312 9281       00892 	BCF   PORTB,1,0
000314 BD98       00893 	BTFSC dato_2,6,1
000316 8281       00894 	BSF   PORTB,1,0
                  00895 			;	nop();
000318 0000       00896 	NOP  
                  00897 			;	PORTB.0 = dato.7;
00031A AF98       00898 	BTFSS dato_2,7,1
00031C 9081       00899 	BCF   PORTB,0,0
00031E BF98       00900 	BTFSC dato_2,7,1
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 16

ADDR   CODE       LINE  SOURCE

000320 8081       00901 	BSF   PORTB,0,0
                  00902 			;	nop();
000322 0000       00903 	NOP  
                  00904 			;	PORTB.5 = 1;  									// Modo dato.
000324 8A81       00905 	BSF   PORTB,5,0
                  00906 			;	retardo_20u ();
000326 DEE9       00907 	RCALL retardo_20u
                  00908 			;	PORTB.4 = 1;  									// Breve pulso.
000328 8881       00909 	BSF   PORTB,4,0
                  00910 			;	retardo_20u ();
00032A DEE7       00911 	RCALL retardo_20u
                  00912 			;	PORTB.4 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
00032C 9881       00913 	BCF   PORTB,4,0
                  00914 			;	for (i = 1; i <= 6; i++) retardo_20u ();
00032E 0E01       00915 	MOVLW 1
000330 0100       00916 	MOVLB 0
000332 6F99       00917 	MOVWF i_3,1
000334 0E07       00918 m031	MOVLW 7
000336 0100       00919 	MOVLB 0
000338 6199       00920 	CPFSLT i_3,1
00033A D004       00921 	BRA   m032
00033C DEDE       00922 	RCALL retardo_20u
00033E 0100       00923 	MOVLB 0
000340 2B99       00924 	INCF  i_3,1,1
000342 D7F8       00925 	BRA   m031
                  00926 			;	dato = swap (dato);
000344 0100       00927 m032	MOVLB 0
000346 3B98       00928 	SWAPF dato_2,1,1
                  00929 			;	PORTB.3 = dato.4;
000348 A998       00930 	BTFSS dato_2,4,1
00034A 9681       00931 	BCF   PORTB,3,0
00034C B998       00932 	BTFSC dato_2,4,1
00034E 8681       00933 	BSF   PORTB,3,0
                  00934 			;	nop();
000350 0000       00935 	NOP  
                  00936 			;	PORTB.2 = dato.5;
000352 AB98       00937 	BTFSS dato_2,5,1
000354 9481       00938 	BCF   PORTB,2,0
000356 BB98       00939 	BTFSC dato_2,5,1
000358 8481       00940 	BSF   PORTB,2,0
                  00941 			;	nop();
00035A 0000       00942 	NOP  
                  00943 			;	PORTB.1 = dato.6;
00035C AD98       00944 	BTFSS dato_2,6,1
00035E 9281       00945 	BCF   PORTB,1,0
000360 BD98       00946 	BTFSC dato_2,6,1
000362 8281       00947 	BSF   PORTB,1,0
                  00948 			;	nop();
000364 0000       00949 	NOP  
                  00950 			;	PORTB.0 = dato.7;
000366 AF98       00951 	BTFSS dato_2,7,1
000368 9081       00952 	BCF   PORTB,0,0
00036A BF98       00953 	BTFSC dato_2,7,1
00036C 8081       00954 	BSF   PORTB,0,0
                  00955 			;	retardo_1m ();
00036E DECF       00956 	RCALL retardo_1m
                  00957 			;	PORTB.5 = 1;  									// Modo dato.
000370 8A81       00958 	BSF   PORTB,5,0
                  00959 			;	retardo_1m ();
000372 DECD       00960 	RCALL retardo_1m
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 17

ADDR   CODE       LINE  SOURCE

                  00961 			;	PORTB.4 = 1;  									// Breve pulso.
000374 8881       00962 	BSF   PORTB,4,0
                  00963 			;	retardo_20u ();
000376 DEC1       00964 	RCALL retardo_20u
                  00965 			;	PORTB.4 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000378 9881       00966 	BCF   PORTB,4,0
                  00967 			;	for (i = 1; i<= 6; i++) retardo_20u ();
00037A 0E01       00968 	MOVLW 1
00037C 0100       00969 	MOVLB 0
00037E 6F99       00970 	MOVWF i_3,1
000380 0E07       00971 m033	MOVLW 7
000382 0100       00972 	MOVLB 0
000384 6199       00973 	CPFSLT i_3,1
000386 D004       00974 	BRA   m034
000388 DEB8       00975 	RCALL retardo_20u
00038A 0100       00976 	MOVLB 0
00038C 2B99       00977 	INCF  i_3,1,1
00038E D7F8       00978 	BRA   m033
                  00979 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.
000390 0E0C       00980 m034	MOVLW 12
000392 D726       00981 	BRA   enviar_comando
                  00982 			;	return;
                  00983 			;} 
                  00984 			;
                  00985 			;void inicializar_lcd (void) 
                  00986 			;{
                  00987 inicializar_lcd
                  00988 			;	char i;
                  00989 			;	clrwdt () ;	
000394 0004       00990 	CLRWDT
                  00991 			;	for (i = 1; i < 21; i++) retardo_1m ();    
000396 0E01       00992 	MOVLW 1
000398 0100       00993 	MOVLB 0
00039A 6F96       00994 	MOVWF i_4,1
00039C 0E15       00995 m035	MOVLW 21
00039E 0100       00996 	MOVLB 0
0003A0 6196       00997 	CPFSLT i_4,1
0003A2 D004       00998 	BRA   m036
0003A4 DEB4       00999 	RCALL retardo_1m
0003A6 0100       01000 	MOVLB 0
0003A8 2B96       01001 	INCF  i_4,1,1
0003AA D7F8       01002 	BRA   m035
                  01003 			;	envia_codigo_inicial (0b.00.11.0000);
0003AC 0E30       01004 m036	MOVLW 48
0003AE DEFC       01005 	RCALL envia_codigo_inicial
                  01006 			;	for (i = 1; i < 6; i++) retardo_1m ();
0003B0 0E01       01007 	MOVLW 1
0003B2 0100       01008 	MOVLB 0
0003B4 6F96       01009 	MOVWF i_4,1
0003B6 0E06       01010 m037	MOVLW 6
0003B8 0100       01011 	MOVLB 0
0003BA 6196       01012 	CPFSLT i_4,1
0003BC D004       01013 	BRA   m038
0003BE DEA7       01014 	RCALL retardo_1m
0003C0 0100       01015 	MOVLB 0
0003C2 2B96       01016 	INCF  i_4,1,1
0003C4 D7F8       01017 	BRA   m037
                  01018 			;    envia_codigo_inicial (0b.00.11.0000);	
0003C6 0E30       01019 m038	MOVLW 48
0003C8 DEEF       01020 	RCALL envia_codigo_inicial
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 18

ADDR   CODE       LINE  SOURCE

                  01021 			;	for (i = 1; i< 11; i++) retardo_20u ();
0003CA 0E01       01022 	MOVLW 1
0003CC 0100       01023 	MOVLB 0
0003CE 6F96       01024 	MOVWF i_4,1
0003D0 0E0B       01025 m039	MOVLW 11
0003D2 0100       01026 	MOVLB 0
0003D4 6196       01027 	CPFSLT i_4,1
0003D6 D004       01028 	BRA   m040
0003D8 DE90       01029 	RCALL retardo_20u
0003DA 0100       01030 	MOVLB 0
0003DC 2B96       01031 	INCF  i_4,1,1
0003DE D7F8       01032 	BRA   m039
                  01033 			;    envia_codigo_inicial (0b.00.11.0000);
0003E0 0E30       01034 m040	MOVLW 48
0003E2 DEE2       01035 	RCALL envia_codigo_inicial
                  01036 			;	for (i = 1; i < 11; i++) retardo_20u ();
0003E4 0E01       01037 	MOVLW 1
0003E6 0100       01038 	MOVLB 0
0003E8 6F96       01039 	MOVWF i_4,1
0003EA 0E0B       01040 m041	MOVLW 11
0003EC 0100       01041 	MOVLB 0
0003EE 6196       01042 	CPFSLT i_4,1
0003F0 D004       01043 	BRA   m042
0003F2 DE83       01044 	RCALL retardo_20u
0003F4 0100       01045 	MOVLB 0
0003F6 2B96       01046 	INCF  i_4,1,1
0003F8 D7F8       01047 	BRA   m041
                  01048 			;	envia_codigo_inicial (0b.00.10.0000);			// A 4 bits.
0003FA 0E20       01049 m042	MOVLW 32
0003FC DED5       01050 	RCALL envia_codigo_inicial
                  01051 			;	enviar_comando (0b.0010.1000);					// A 4 bits, doble lÌnea, caracteres 5x7.
0003FE 0E28       01052 	MOVLW 40
000400 DEEF       01053 	RCALL enviar_comando
                  01054 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.
000402 0E0C       01055 	MOVLW 12
000404 DEED       01056 	RCALL enviar_comando
                  01057 			;	enviar_comando (0b.0000.0010);  				// Cursor en home, inicio de primera linea.
000406 0E02       01058 	MOVLW 2
000408 D6EB       01059 	BRA   enviar_comando
                  01060 			;	return;
                  01061 			;}
                  01062 			;
                  01063 			;void escribir_posicion (char linea, char columna)
                  01064 			;{
                  01065 escribir_posicion
00040A 0100       01066 	MOVLB 0
00040C 6F99       01067 	MOVWF columna,1
                  01068 			;	
                  01069 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
00040E 5198       01070 	MOVF  linea,W,1
000410 0A01       01071 	XORLW 1
000412 B4D8       01072 	BTFSC 0xFD8,Zero_,0
000414 D00A       01073 	BRA   m043
000416 0A03       01074 	XORLW 3
000418 B4D8       01075 	BTFSC 0xFD8,Zero_,0
00041A D00C       01076 	BRA   m044
00041C 0A01       01077 	XORLW 1
00041E B4D8       01078 	BTFSC 0xFD8,Zero_,0
000420 D00E       01079 	BRA   m045
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 19

ADDR   CODE       LINE  SOURCE

000422 0A07       01080 	XORLW 7
000424 B4D8       01081 	BTFSC 0xFD8,Zero_,0
000426 D010       01082 	BRA   m046
000428 D016       01083 	BRA   m047
                  01084 			;		{
                  01085 			;			case 1:
                  01086 			;				enviar_comando (127 + columna); 	// Inicio primera linea.
00042A 0E7F       01087 m043	MOVLW 127
00042C 0100       01088 	MOVLB 0
00042E 2599       01089 	ADDWF columna,W,1
000430 DED7       01090 	RCALL enviar_comando
                  01091 			;			break;
000432 D011       01092 	BRA   m047
                  01093 			;						
                  01094 			;			case 2:
                  01095 			;				enviar_comando (191 + columna); 	// Inicio segunda lÌnea.
000434 0EBF       01096 m044	MOVLW 191
000436 0100       01097 	MOVLB 0
000438 2599       01098 	ADDWF columna,W,1
00043A DED2       01099 	RCALL enviar_comando
                  01100 			;			break;			
00043C D00C       01101 	BRA   m047
                  01102 			;
                  01103 			;			case 3:
                  01104 			;				enviar_comando (147 + columna);		// Inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
00043E 0E93       01105 m045	MOVLW 147
000440 0100       01106 	MOVLB 0
000442 2599       01107 	ADDWF columna,W,1
000444 DECD       01108 	RCALL enviar_comando
                  01109 			;			break;				
000446 D007       01110 	BRA   m047
                  01111 			;			
                  01112 			;			case 4:
                  01113 			;				enviar_comando (211 + columna); 	// Inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
000448 0ED3       01114 m046	MOVLW 211
00044A 0100       01115 	MOVLB 0
00044C 2599       01116 	ADDWF columna,W,1
00044E DEC8       01117 	RCALL enviar_comando
                  01118 			;			break;
000450 D002       01119 	BRA   m047
                  01120 			;			enviar_comando (0b.0000.1100);			// Pantalla encendida, sin cursor.
000452 0E0C       01121 	MOVLW 12
000454 D6C5       01122 	BRA   enviar_comando
                  01123 			;		}
                  01124 			;	
                  01125 			;	
                  01126 			;}
000456 0012       01127 m047	RETURN
                  01128 			;
                  01129 			;void borrar_linea (char linea)
                  01130 			;{
                  01131 borrar_linea
000458 6E7F       01132 	MOVWF linea_2,0
                  01133 			;	char i;
                  01134 			;		
                  01135 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
00045A 507F       01136 	MOVF  linea_2,W,0
00045C 0A01       01137 	XORLW 1
00045E B4D8       01138 	BTFSC 0xFD8,Zero_,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 20

ADDR   CODE       LINE  SOURCE

000460 D00A       01139 	BRA   m048
000462 0A03       01140 	XORLW 3
000464 B4D8       01141 	BTFSC 0xFD8,Zero_,0
000466 D00A       01142 	BRA   m049
000468 0A01       01143 	XORLW 1
00046A B4D8       01144 	BTFSC 0xFD8,Zero_,0
00046C D00A       01145 	BRA   m050
00046E 0A07       01146 	XORLW 7
000470 B4D8       01147 	BTFSC 0xFD8,Zero_,0
000472 D00A       01148 	BRA   m051
000474 D00B       01149 	BRA   m052
                  01150 			;		{
                  01151 			;			case 1:
                  01152 			;				enviar_comando (128); 				// Inicio primera linea.
000476 0E80       01153 m048	MOVLW 128
000478 DEB3       01154 	RCALL enviar_comando
                  01155 			;			break;
00047A D008       01156 	BRA   m052
                  01157 			;						
                  01158 			;			case 2:
                  01159 			;				enviar_comando (192); 				// Inicio segunda lÌnea.
00047C 0EC0       01160 m049	MOVLW 192
00047E DEB0       01161 	RCALL enviar_comando
                  01162 			;			break;			
000480 D005       01163 	BRA   m052
                  01164 			;
                  01165 			;			case 3:
                  01166 			;				enviar_comando (148); 				// Inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
000482 0E94       01167 m050	MOVLW 148
000484 DEAD       01168 	RCALL enviar_comando
                  01169 			;			break;				
000486 D002       01170 	BRA   m052
                  01171 			;			
                  01172 			;			case 4:
                  01173 			;				enviar_comando (212); 				// Inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
000488 0ED4       01174 m051	MOVLW 212
00048A DEAA       01175 	RCALL enviar_comando
                  01176 			;			break;
                  01177 			;		}
                  01178 			;	for (i = 1; i < 21; i++) enviar_literal (' '); 	// Envio 20 car·cteres en blanco y posiciono en la siguiente lÌnea.
00048C 0E01       01179 m052	MOVLW 1
00048E 6E7F       01180 	MOVWF i_5,0
000490 0E15       01181 m053	MOVLW 21
000492 607F       01182 	CPFSLT i_5,0
000494 D004       01183 	BRA   m054
000496 0E20       01184 	MOVLW 32
000498 DEDE       01185 	RCALL enviar_literal
00049A 2A7F       01186 	INCF  i_5,1,0
00049C D7F9       01187 	BRA   m053
                  01188 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.	
00049E 0E0C       01189 m054	MOVLW 12
0004A0 D69F       01190 	BRA   enviar_comando
                  01191 			;}
                  01192 			;
                  01193 			;void borrar_lcd (void)
                  01194 			;{
                  01195 borrar_lcd
                  01196 			;	enviar_comando (0b.0000.0001);  				// Borrado del display y cursor en la posiciÛn inicial.	
0004A2 0E01       01197 	MOVLW 1
0004A4 D69D       01198 	BRA   enviar_comando
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 21

ADDR   CODE       LINE  SOURCE

                  01199 			;}
                  01200 			;
                  01201 			;void Enviar_lcd (char linea, char columna, uns16 dato, bit bd, bit dp, bit xi,bit ndp)
                  01202 			;            //fila , col , uns16 , bd -> si 0 posa espai si "0" a l'esquerra ,, dp -> si "0"--> posa punt decimal
                  01203 			;{
                  01204 Enviar_lcd
                  01205 			;// Aquesta funcio, posiciona Fila i Columna d'un LCD 4x20 i envia una xifra uns16 descomposant-la i posant 
                  01206 			;//  decimal o no, segons sigui dp, si "0"--> posa punt decimal , si dp "1" -> no posa dp
                  01207 			;//  si bd = "0" -> posa espai, si bd = "1"  --> No  posa espai i posa el 0.
                  01208 			;// si xi = 0 -> 3 xifres,, si xi = 1  -> 4 xifres
                  01209 			;// Atencio, amb dp S'UTILIZA un ESPAI MES
                  01210 			;// amb 4 xifres, tambe es representen 3, pero es gasta un espai de mes.
                  01211 			;// ESPI utilitzat...3 per 3 xifres,, 4 per 3xifres + dp   O 4xifres s/dp ,, 5 per 4 xifres + dp
                  01212 			;// ndp ..si "0"...1decimal... si "1"   2 decimals
                  01213 			;	uns16 num, u_milers, cent;
                  01214 			;	char dec, unid, resto1;
                  01215 			;	char i, xx, yy, dat,xy;
                  01216 			;	
                  01217 			;	//CON_LCD ();
                  01218 			;	//posiciono
                  01219 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
0004A6 507F       01220 	MOVF  linea_3,W,0
0004A8 0A01       01221 	XORLW 1
0004AA B4D8       01222 	BTFSC 0xFD8,Zero_,0
0004AC D00A       01223 	BRA   m055
0004AE 0A03       01224 	XORLW 3
0004B0 B4D8       01225 	BTFSC 0xFD8,Zero_,0
0004B2 D00B       01226 	BRA   m056
0004B4 0A01       01227 	XORLW 1
0004B6 B4D8       01228 	BTFSC 0xFD8,Zero_,0
0004B8 D00C       01229 	BRA   m057
0004BA 0A07       01230 	XORLW 7
0004BC B4D8       01231 	BTFSC 0xFD8,Zero_,0
0004BE D00D       01232 	BRA   m058
0004C0 D012       01233 	BRA   m059
                  01234 			;		{
                  01235 			;			case 1:	enviar_comando (127 + columna); 	// inicio primera linea.
0004C2 0E7F       01236 m055	MOVLW 127
0004C4 247F       01237 	ADDWF columna_2,W,0
0004C6 DE8C       01238 	RCALL enviar_comando
                  01239 			;			break;	
0004C8 D00E       01240 	BRA   m059
                  01241 			;			case 2:	enviar_comando (191 + columna); 	// inicio segunda lÌnea.
0004CA 0EBF       01242 m056	MOVLW 191
0004CC 247F       01243 	ADDWF columna_2,W,0
0004CE DE88       01244 	RCALL enviar_comando
                  01245 			;			break;			
0004D0 D00A       01246 	BRA   m059
                  01247 			;			case 3:	enviar_comando (147 + columna); 	// inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
0004D2 0E93       01248 m057	MOVLW 147
0004D4 247F       01249 	ADDWF columna_2,W,0
0004D6 DE84       01250 	RCALL enviar_comando
                  01251 			;			break;				
0004D8 D006       01252 	BRA   m059
                  01253 			;			case 4:	enviar_comando (211 + columna); 	// inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
0004DA 0ED3       01254 m058	MOVLW 211
0004DC 247F       01255 	ADDWF columna_2,W,0
0004DE DE80       01256 	RCALL enviar_comando
                  01257 			;			break;	
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 22

ADDR   CODE       LINE  SOURCE

0004E0 D002       01258 	BRA   m059
                  01259 			;			enviar_comando (0b.0000.1100);			// pantalla encendida, sin cursor
0004E2 0E0C       01260 	MOVLW 12
0004E4 DE7D       01261 	RCALL enviar_comando
                  01262 			;		}				
                  01263 			;		if (!xi)
0004E6 B07F       01264 m059	BTFSC 0xF7F,xi,0
0004E8 D011       01265 	BRA   m060
                  01266 			;		{
                  01267 			;			xy = 2;
0004EA 0E02       01268 	MOVLW 2
0004EC 6E7F       01269 	MOVWF xy,0
                  01270 			;			u_milers = 0;
0004EE 6A7F       01271 	CLRF  u_milers,0
0004F0 6A7F       01272 	CLRF  u_milers+1,0
                  01273 			;			if (dato > 999) { enviar_literal ('>');enviar_literal ('E');enviar_literal ('r'); goto so; }
0004F2 0EE8       01274 	MOVLW 232
0004F4 5C7F       01275 	SUBWF dato_3,W,0
0004F6 0E03       01276 	MOVLW 3
0004F8 587F       01277 	SUBWFB dato_3+1,W,0
0004FA A0D8       01278 	BTFSS 0xFD8,Carry,0
0004FC D04D       01279 	BRA   m066
0004FE 0E3E       01280 	MOVLW 62
000500 DEAA       01281 	RCALL enviar_literal
000502 0E45       01282 	MOVLW 69
000504 DEA8       01283 	RCALL enviar_literal
000506 0E72       01284 	MOVLW 114
000508 DEA6       01285 	RCALL enviar_literal
00050A D13B       01286 	BRA   m096
                  01287 			;		    else goto sa;
                  01288 			;		}
                  01289 			;		else
                  01290 			;		{
                  01291 			;			xy = 1;
00050C 0E01       01292 m060	MOVLW 1
00050E 6E7F       01293 	MOVWF xy,0
                  01294 			;			if (dato > 9999) { enviar_literal ('>');enviar_literal ('E');enviar_literal ('r'); goto so; }
000510 0E10       01295 	MOVLW 16
000512 5C7F       01296 	SUBWF dato_3,W,0
000514 0E27       01297 	MOVLW 39
000516 587F       01298 	SUBWFB dato_3+1,W,0
000518 A0D8       01299 	BTFSS 0xFD8,Carry,0
00051A D007       01300 	BRA   m061
00051C 0E3E       01301 	MOVLW 62
00051E DE9B       01302 	RCALL enviar_literal
000520 0E45       01303 	MOVLW 69
000522 DE99       01304 	RCALL enviar_literal
000524 0E72       01305 	MOVLW 114
000526 DE97       01306 	RCALL enviar_literal
000528 D12C       01307 	BRA   m096
                  01308 			;		}
                  01309 			;			// Separo per 4 xifres
                  01310 			;			num = dato; // per 4 xifres
00052A CF7F FF7F  01311 m061	MOVFF dato_3,num
00052E CF7F FF7F  01312 	MOVFF dato_3+1,num+1
                  01313 			;			u_milers = num / 1000;
000532 507F       01314 	MOVF  num,W,0
000534 6E7F       01315 	MOVWF C4tmp,0
000536 507F       01316 	MOVF  num+1,W,0
000538 6E7F       01317 	MOVWF C4tmp+1,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 23

ADDR   CODE       LINE  SOURCE

00053A 6A7F       01318 	CLRF  C5rem,0
00053C 6A7F       01319 	CLRF  C5rem+1,0
00053E 0E10       01320 	MOVLW 16
000540 6E7F       01321 	MOVWF C3cnt,0
000542 367F       01322 m062	RLCF  C4tmp,1,0
000544 367F       01323 	RLCF  C4tmp+1,1,0
000546 367F       01324 	RLCF  C5rem,1,0
000548 367F       01325 	RLCF  C5rem+1,1,0
00054A 0EE8       01326 	MOVLW 232
00054C 5C7F       01327 	SUBWF C5rem,W,0
00054E 0E03       01328 	MOVLW 3
000550 587F       01329 	SUBWFB C5rem+1,W,0
000552 A0D8       01330 	BTFSS 0xFD8,Carry,0
000554 D005       01331 	BRA   m063
000556 0EE8       01332 	MOVLW 232
000558 5E7F       01333 	SUBWF C5rem,1,0
00055A 0E03       01334 	MOVLW 3
00055C 5A7F       01335 	SUBWFB C5rem+1,1,0
00055E 80D8       01336 	BSF   0xFD8,Carry,0
000560 367F       01337 m063	RLCF  u_milers,1,0
000562 367F       01338 	RLCF  u_milers+1,1,0
000564 2E7F       01339 	DECFSZ C3cnt,1,0
000566 D7ED       01340 	BRA   m062
                  01341 			;			dato = num % 1000;
000568 507F       01342 	MOVF  num,W,0
00056A 6E7F       01343 	MOVWF C7tmp,0
00056C 507F       01344 	MOVF  num+1,W,0
00056E 6E7F       01345 	MOVWF C7tmp+1,0
000570 6A7F       01346 	CLRF  dato_3,0
000572 6A7F       01347 	CLRF  dato_3+1,0
000574 0E10       01348 	MOVLW 16
000576 6E7F       01349 	MOVWF C6cnt,0
000578 367F       01350 m064	RLCF  C7tmp,1,0
00057A 367F       01351 	RLCF  C7tmp+1,1,0
00057C 367F       01352 	RLCF  dato_3,1,0
00057E 367F       01353 	RLCF  dato_3+1,1,0
000580 0EE8       01354 	MOVLW 232
000582 5C7F       01355 	SUBWF dato_3,W,0
000584 0E03       01356 	MOVLW 3
000586 587F       01357 	SUBWFB dato_3+1,W,0
000588 A0D8       01358 	BTFSS 0xFD8,Carry,0
00058A D004       01359 	BRA   m065
00058C 0EE8       01360 	MOVLW 232
00058E 5E7F       01361 	SUBWF dato_3,1,0
000590 0E03       01362 	MOVLW 3
000592 5A7F       01363 	SUBWFB dato_3+1,1,0
000594 2E7F       01364 m065	DECFSZ C6cnt,1,0
000596 D7F0       01365 	BRA   m064
                  01366 			;			// Separo per 3 xifres
                  01367 			;sa:			cent   = dato   / 100;   	
000598 507F       01368 m066	MOVF  dato_3,W,0
00059A 6E7F       01369 	MOVWF C9tmp,0
00059C 507F       01370 	MOVF  dato_3+1,W,0
00059E 6E7F       01371 	MOVWF C9tmp+1,0
0005A0 6A7F       01372 	CLRF  C10rem,0
0005A2 0E10       01373 	MOVLW 16
0005A4 6E7F       01374 	MOVWF C8cnt,0
0005A6 367F       01375 m067	RLCF  C9tmp,1,0
0005A8 367F       01376 	RLCF  C9tmp+1,1,0
0005AA 367F       01377 	RLCF  C10rem,1,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 24

ADDR   CODE       LINE  SOURCE

0005AC B0D8       01378 	BTFSC 0xFD8,Carry,0
0005AE D004       01379 	BRA   m068
0005B0 0E64       01380 	MOVLW 100
0005B2 5C7F       01381 	SUBWF C10rem,W,0
0005B4 A0D8       01382 	BTFSS 0xFD8,Carry,0
0005B6 D003       01383 	BRA   m069
0005B8 0E64       01384 m068	MOVLW 100
0005BA 5E7F       01385 	SUBWF C10rem,1,0
0005BC 80D8       01386 	BSF   0xFD8,Carry,0
0005BE 367F       01387 m069	RLCF  cent,1,0
0005C0 367F       01388 	RLCF  cent+1,1,0
0005C2 2E7F       01389 	DECFSZ C8cnt,1,0
0005C4 D7F0       01390 	BRA   m067
                  01391 			;			resto1 = dato   % 100;
0005C6 507F       01392 	MOVF  dato_3,W,0
0005C8 6E7F       01393 	MOVWF C12tmp,0
0005CA 507F       01394 	MOVF  dato_3+1,W,0
0005CC 6E7F       01395 	MOVWF C12tmp+1,0
0005CE 6A7F       01396 	CLRF  resto1,0
0005D0 0E10       01397 	MOVLW 16
0005D2 6E7F       01398 	MOVWF C11cnt,0
0005D4 367F       01399 m070	RLCF  C12tmp,1,0
0005D6 367F       01400 	RLCF  C12tmp+1,1,0
0005D8 367F       01401 	RLCF  resto1,1,0
0005DA B0D8       01402 	BTFSC 0xFD8,Carry,0
0005DC D004       01403 	BRA   m071
0005DE 0E64       01404 	MOVLW 100
0005E0 5C7F       01405 	SUBWF resto1,W,0
0005E2 A0D8       01406 	BTFSS 0xFD8,Carry,0
0005E4 D002       01407 	BRA   m072
0005E6 0E64       01408 m071	MOVLW 100
0005E8 5E7F       01409 	SUBWF resto1,1,0
0005EA 2E7F       01410 m072	DECFSZ C11cnt,1,0
0005EC D7F3       01411 	BRA   m070
                  01412 			;			dec    = resto1 /  10;  
0005EE 507F       01413 	MOVF  resto1,W,0
0005F0 6E7F       01414 	MOVWF C14tmp,0
0005F2 6A7F       01415 	CLRF  C15rem,0
0005F4 0E08       01416 	MOVLW 8
0005F6 6E7F       01417 	MOVWF C13cnt,0
0005F8 367F       01418 m073	RLCF  C14tmp,1,0
0005FA 367F       01419 	RLCF  C15rem,1,0
0005FC 0E0A       01420 	MOVLW 10
0005FE 5C7F       01421 	SUBWF C15rem,W,0
000600 A0D8       01422 	BTFSS 0xFD8,Carry,0
000602 D003       01423 	BRA   m074
000604 0E0A       01424 	MOVLW 10
000606 5E7F       01425 	SUBWF C15rem,1,0
000608 80D8       01426 	BSF   0xFD8,Carry,0
00060A 367F       01427 m074	RLCF  dec,1,0
00060C 2E7F       01428 	DECFSZ C13cnt,1,0
00060E D7F4       01429 	BRA   m073
                  01430 			;			unid   = resto1 %  10; 		
000610 507F       01431 	MOVF  resto1,W,0
000612 6E7F       01432 	MOVWF C17tmp,0
000614 6A7F       01433 	CLRF  unid,0
000616 0E08       01434 	MOVLW 8
000618 6E7F       01435 	MOVWF C16cnt,0
00061A 367F       01436 m075	RLCF  C17tmp,1,0
00061C 367F       01437 	RLCF  unid,1,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 25

ADDR   CODE       LINE  SOURCE

00061E 0E0A       01438 	MOVLW 10
000620 5C7F       01439 	SUBWF unid,W,0
000622 A0D8       01440 	BTFSS 0xFD8,Carry,0
000624 D002       01441 	BRA   m076
000626 0E0A       01442 	MOVLW 10
000628 5E7F       01443 	SUBWF unid,1,0
00062A 2E7F       01444 m076	DECFSZ C16cnt,1,0
00062C D7F6       01445 	BRA   m075
                  01446 			;		// Envio
                  01447 			;		for (xx = xy; xx < 7; xx++)
00062E CF7F FF7F  01448 	MOVFF xy,xx
000632 0E07       01449 m077	MOVLW 7
000634 607F       01450 	CPFSLT xx,0
000636 D0A5       01451 	BRA   m096
                  01452 			;		{
                  01453 			;			clrwdt () ;
000638 0004       01454 	CLRWDT
                  01455 			;			if (xx == 1) 
00063A 2C7F       01456 	DECFSZ xx,W,0
00063C D00B       01457 	BRA   m079
                  01458 			;			{
                  01459 			;				if ((u_milers==0)&&(!bd)) dat = ' '; // bd =0 --> espai
00063E 507F       01460 	MOVF  u_milers,W,0
000640 107F       01461 	IORWF u_milers+1,W,0
000642 A4D8       01462 	BTFSS 0xFD8,Zero_,0
000644 D005       01463 	BRA   m078
000646 B07F       01464 	BTFSC 0xF7F,bd,0
000648 D003       01465 	BRA   m078
00064A 0E20       01466 	MOVLW 32
00064C 6E7F       01467 	MOVWF dat,0
                  01468 			;				else dat = u_milers;
00064E D002       01469 	BRA   m079
000650 CF7F FF7F  01470 m078	MOVFF u_milers,dat
                  01471 			;			}
                  01472 			;			if (xx == 2) 
000654 0E02       01473 m079	MOVLW 2
000656 627F       01474 	CPFSEQ xx,0
000658 D00F       01475 	BRA   m081
                  01476 			;			{
                  01477 			;				if ((u_milers==0)&&(cent==0)&&(!bd)) dat = ' '; // bd =0 --> espai
00065A 507F       01478 	MOVF  u_milers,W,0
00065C 107F       01479 	IORWF u_milers+1,W,0
00065E A4D8       01480 	BTFSS 0xFD8,Zero_,0
000660 D009       01481 	BRA   m080
000662 507F       01482 	MOVF  cent,W,0
000664 107F       01483 	IORWF cent+1,W,0
000666 A4D8       01484 	BTFSS 0xFD8,Zero_,0
000668 D005       01485 	BRA   m080
00066A B07F       01486 	BTFSC 0xF7F,bd,0
00066C D003       01487 	BRA   m080
00066E 0E20       01488 	MOVLW 32
000670 6E7F       01489 	MOVWF dat,0
                  01490 			;				else dat = cent;
000672 D002       01491 	BRA   m081
000674 CF7F FF7F  01492 m080	MOVFF cent,dat
                  01493 			;			}
                  01494 			;			if (xx == 3) 
000678 0E03       01495 m081	MOVLW 3
00067A 627F       01496 	CPFSEQ xx,0
00067C D00A       01497 	BRA   m084
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 26

ADDR   CODE       LINE  SOURCE

                  01498 			;			{
                  01499 			;				if(ndp) { if (dp==0) dat = '.';
00067E A07F       01500 	BTFSS 0xF7F,ndp,0
000680 D007       01501 	BRA   m083
000682 B07F       01502 	BTFSC 0xF7F,dp,0
000684 D003       01503 	BRA   m082
000686 0E2E       01504 	MOVLW 46
000688 6E7F       01505 	MOVWF dat,0
                  01506 			;				          else xx++;  
00068A D003       01507 	BRA   m084
00068C 2A7F       01508 m082	INCF  xx,1,0
                  01509 			;				        }
                  01510 			;				else xx++;		
00068E D001       01511 	BRA   m084
000690 2A7F       01512 m083	INCF  xx,1,0
                  01513 			;			}
                  01514 			;			if (xx == 4)
000692 0E04       01515 m084	MOVLW 4
000694 627F       01516 	CPFSEQ xx,0
000696 D012       01517 	BRA   m086
                  01518 			;			{
                  01519 			;				if ((u_milers==0)&&(cent==0)&&(dec==0)&&(!bd)) dat = ' ';
000698 507F       01520 	MOVF  u_milers,W,0
00069A 107F       01521 	IORWF u_milers+1,W,0
00069C A4D8       01522 	BTFSS 0xFD8,Zero_,0
00069E D00C       01523 	BRA   m085
0006A0 507F       01524 	MOVF  cent,W,0
0006A2 107F       01525 	IORWF cent+1,W,0
0006A4 A4D8       01526 	BTFSS 0xFD8,Zero_,0
0006A6 D008       01527 	BRA   m085
0006A8 507F       01528 	MOVF  dec,W,0
0006AA A4D8       01529 	BTFSS 0xFD8,Zero_,0
0006AC D005       01530 	BRA   m085
0006AE B07F       01531 	BTFSC 0xF7F,bd,0
0006B0 D003       01532 	BRA   m085
0006B2 0E20       01533 	MOVLW 32
0006B4 6E7F       01534 	MOVWF dat,0
                  01535 			;				else dat = dec ;
0006B6 D002       01536 	BRA   m086
0006B8 CF7F FF7F  01537 m085	MOVFF dec,dat
                  01538 			;			}
                  01539 			;			if (xx == 5)
0006BC 0E05       01540 m086	MOVLW 5
0006BE 627F       01541 	CPFSEQ xx,0
0006C0 D00A       01542 	BRA   m089
                  01543 			;			{
                  01544 			;				if(!ndp) { if (dp==0) dat = '.';	
0006C2 B07F       01545 	BTFSC 0xF7F,ndp,0
0006C4 D007       01546 	BRA   m088
0006C6 B07F       01547 	BTFSC 0xF7F,dp,0
0006C8 D003       01548 	BRA   m087
0006CA 0E2E       01549 	MOVLW 46
0006CC 6E7F       01550 	MOVWF dat,0
                  01551 			;				           else xx++;
0006CE D003       01552 	BRA   m089
0006D0 2A7F       01553 m087	INCF  xx,1,0
                  01554 			;						 }
                  01555 			;				else xx++;		 
0006D2 D001       01556 	BRA   m089
0006D4 2A7F       01557 m088	INCF  xx,1,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 27

ADDR   CODE       LINE  SOURCE

                  01558 			;			}
                  01559 			;			if (xx == 6) dat = unid;
0006D6 0E06       01560 m089	MOVLW 6
0006D8 627F       01561 	CPFSEQ xx,0
0006DA D002       01562 	BRA   m090
0006DC CF7F FF7F  01563 	MOVFF unid,dat
                  01564 			;						
                  01565 			;			if ((dat!='.')&&(dat!=' ')) dat = dat + 0x30;
0006E0 507F       01566 m090	MOVF  dat,W,0
0006E2 0A2E       01567 	XORLW 46
0006E4 B4D8       01568 	BTFSC 0xFD8,Zero_,0
0006E6 D006       01569 	BRA   m091
0006E8 507F       01570 	MOVF  dat,W,0
0006EA 0A20       01571 	XORLW 32
0006EC B4D8       01572 	BTFSC 0xFD8,Zero_,0
0006EE D002       01573 	BRA   m091
0006F0 0E30       01574 	MOVLW 48
0006F2 267F       01575 	ADDWF dat,1,0
                  01576 			;
                  01577 			;			PORTB.3 = dat.4;nop();
0006F4 A87F       01578 m091	BTFSS dat,4,0
0006F6 9681       01579 	BCF   PORTB,3,0
0006F8 B87F       01580 	BTFSC dat,4,0
0006FA 8681       01581 	BSF   PORTB,3,0
0006FC 0000       01582 	NOP  
                  01583 			;			PORTB.2 = dat.5;nop();
0006FE AA7F       01584 	BTFSS dat,5,0
000700 9481       01585 	BCF   PORTB,2,0
000702 BA7F       01586 	BTFSC dat,5,0
000704 8481       01587 	BSF   PORTB,2,0
000706 0000       01588 	NOP  
                  01589 			;			PORTB.1 = dat.6;nop();
000708 AC7F       01590 	BTFSS dat,6,0
00070A 9281       01591 	BCF   PORTB,1,0
00070C BC7F       01592 	BTFSC dat,6,0
00070E 8281       01593 	BSF   PORTB,1,0
000710 0000       01594 	NOP  
                  01595 			;			PORTB.0 = dat.7;nop();
000712 AE7F       01596 	BTFSS dat,7,0
000714 9081       01597 	BCF   PORTB,0,0
000716 BE7F       01598 	BTFSC dat,7,0
000718 8081       01599 	BSF   PORTB,0,0
00071A 0000       01600 	NOP  
                  01601 			;			PORTB.5 = 1;  									// Modo dato.
00071C 8A81       01602 	BSF   PORTB,5,0
                  01603 			;			retardo_20u ();
00071E DCED       01604 	RCALL retardo_20u
                  01605 			;			PORTB.4 = 1;  									// Breve pulso.
000720 8881       01606 	BSF   PORTB,4,0
                  01607 			;			retardo_20u ();
000722 DCEB       01608 	RCALL retardo_20u
                  01609 			;			PORTB.4 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
000724 9881       01610 	BCF   PORTB,4,0
                  01611 			;			for (i = 1; i <= 6; i++) retardo_20u ();
000726 0E01       01612 	MOVLW 1
000728 6E7F       01613 	MOVWF i_6,0
00072A 0E07       01614 m092	MOVLW 7
00072C 607F       01615 	CPFSLT i_6,0
00072E D003       01616 	BRA   m093
000730 DCE4       01617 	RCALL retardo_20u
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 28

ADDR   CODE       LINE  SOURCE

000732 2A7F       01618 	INCF  i_6,1,0
000734 D7FA       01619 	BRA   m092
                  01620 			;			dat = swap (dat);
000736 3A7F       01621 m093	SWAPF dat,1,0
                  01622 			;			PORTB.3 = dat.4;nop();
000738 A87F       01623 	BTFSS dat,4,0
00073A 9681       01624 	BCF   PORTB,3,0
00073C B87F       01625 	BTFSC dat,4,0
00073E 8681       01626 	BSF   PORTB,3,0
000740 0000       01627 	NOP  
                  01628 			;			PORTB.2 = dat.5;nop();
000742 AA7F       01629 	BTFSS dat,5,0
000744 9481       01630 	BCF   PORTB,2,0
000746 BA7F       01631 	BTFSC dat,5,0
000748 8481       01632 	BSF   PORTB,2,0
00074A 0000       01633 	NOP  
                  01634 			;			PORTB.1 = dat.6;nop();
00074C AC7F       01635 	BTFSS dat,6,0
00074E 9281       01636 	BCF   PORTB,1,0
000750 BC7F       01637 	BTFSC dat,6,0
000752 8281       01638 	BSF   PORTB,1,0
000754 0000       01639 	NOP  
                  01640 			;			PORTB.0 = dat.7;
000756 AE7F       01641 	BTFSS dat,7,0
000758 9081       01642 	BCF   PORTB,0,0
00075A BE7F       01643 	BTFSC dat,7,0
00075C 8081       01644 	BSF   PORTB,0,0
                  01645 			;			retardo_1m ();
00075E DCD7       01646 	RCALL retardo_1m
                  01647 			;			PORTB.5 = 1;  									// Modo dato.
000760 8A81       01648 	BSF   PORTB,5,0
                  01649 			;			retardo_1m ();
000762 DCD5       01650 	RCALL retardo_1m
                  01651 			;			PORTB.4 = 1;  									// Breve pulso.
000764 8881       01652 	BSF   PORTB,4,0
                  01653 			;			retardo_20u ();
000766 DCC9       01654 	RCALL retardo_20u
                  01655 			;			PORTB.4 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000768 9881       01656 	BCF   PORTB,4,0
                  01657 			;			for (i = 1; i<= 6; i++) retardo_20u ();
00076A 0E01       01658 	MOVLW 1
00076C 6E7F       01659 	MOVWF i_6,0
00076E 0E07       01660 m094	MOVLW 7
000770 607F       01661 	CPFSLT i_6,0
000772 D003       01662 	BRA   m095
000774 DCC2       01663 	RCALL retardo_20u
000776 2A7F       01664 	INCF  i_6,1,0
000778 D7FA       01665 	BRA   m094
                  01666 			;			enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.			
00077A 0E0C       01667 m095	MOVLW 12
00077C DD31       01668 	RCALL enviar_comando
                  01669 			;		}
00077E 2A7F       01670 	INCF  xx,1,0
000780 D758       01671 	BRA   m077
                  01672 			;so:	//DESCON_LCD ();
                  01673 			;	return;
000782 0012       01674 m096	RETURN
                  01675 			;}
                  01676 			;
                  01677 			;void Enviar_uns16(char linea,char columna,uns16 dato){
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 29

ADDR   CODE       LINE  SOURCE

                  01678 Enviar_uns16
                  01679 			;	//utilizaremos esta funcion en caso de necesitar un numero entero hasta 65536(16bits)
                  01680 			;	uns16 num, u_milers, cent, d_milers;
                  01681 			;	char dec, unid, resto1;
                  01682 			;	char i, xx, yy, dat,xy;
                  01683 			;
                  01684 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
000784 0100       01685 	MOVLB 0
000786 5198       01686 	MOVF  linea_4,W,1
000788 0A01       01687 	XORLW 1
00078A B4D8       01688 	BTFSC 0xFD8,Zero_,0
00078C D00A       01689 	BRA   m097
00078E 0A03       01690 	XORLW 3
000790 B4D8       01691 	BTFSC 0xFD8,Zero_,0
000792 D00C       01692 	BRA   m098
000794 0A01       01693 	XORLW 1
000796 B4D8       01694 	BTFSC 0xFD8,Zero_,0
000798 D00E       01695 	BRA   m099
00079A 0A07       01696 	XORLW 7
00079C B4D8       01697 	BTFSC 0xFD8,Zero_,0
00079E D010       01698 	BRA   m100
0007A0 D016       01699 	BRA   m101
                  01700 			;		{
                  01701 			;			case 1:	enviar_comando (127 + columna); 	// inicio primera linea.
0007A2 0E7F       01702 m097	MOVLW 127
0007A4 0100       01703 	MOVLB 0
0007A6 2599       01704 	ADDWF columna_3,W,1
0007A8 DD1B       01705 	RCALL enviar_comando
                  01706 			;			break;	
0007AA D011       01707 	BRA   m101
                  01708 			;			case 2:	enviar_comando (191 + columna); 	// inicio segunda lÌnea.
0007AC 0EBF       01709 m098	MOVLW 191
0007AE 0100       01710 	MOVLB 0
0007B0 2599       01711 	ADDWF columna_3,W,1
0007B2 DD16       01712 	RCALL enviar_comando
                  01713 			;			break;			
0007B4 D00C       01714 	BRA   m101
                  01715 			;			case 3:	enviar_comando (147 + columna); 	// inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
0007B6 0E93       01716 m099	MOVLW 147
0007B8 0100       01717 	MOVLB 0
0007BA 2599       01718 	ADDWF columna_3,W,1
0007BC DD11       01719 	RCALL enviar_comando
                  01720 			;			break;				
0007BE D007       01721 	BRA   m101
                  01722 			;			case 4:	enviar_comando (211 + columna); 	// inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
0007C0 0ED3       01723 m100	MOVLW 211
0007C2 0100       01724 	MOVLB 0
0007C4 2599       01725 	ADDWF columna_3,W,1
0007C6 DD0C       01726 	RCALL enviar_comando
                  01727 			;			break;	
0007C8 D002       01728 	BRA   m101
                  01729 			;			enviar_comando (0b.0000.1100);			// pantalla encendida, sin cursor
0007CA 0E0C       01730 	MOVLW 12
0007CC DD09       01731 	RCALL enviar_comando
                  01732 			;		}				
                  01733 			;	
                  01734 			;			
                  01735 			;			num = dato; 
0007CE C09A F09C  01736 m101	MOVFF dato_4,num_2
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 30

ADDR   CODE       LINE  SOURCE

0007D2 C09B F09D  01737 	MOVFF dato_4+1,num_2+1
                  01738 			;			d_milers =num/10000;
0007D6 0100       01739 	MOVLB 0
0007D8 519C       01740 	MOVF  num_2,W,1
0007DA 6FAD       01741 	MOVWF C19tmp,1
0007DC 519D       01742 	MOVF  num_2+1,W,1
0007DE 6FAE       01743 	MOVWF C19tmp+1,1
0007E0 6BAF       01744 	CLRF  C20rem,1
0007E2 6BB0       01745 	CLRF  C20rem+1,1
0007E4 0E10       01746 	MOVLW 16
0007E6 6FAC       01747 	MOVWF C18cnt,1
0007E8 0100       01748 m102	MOVLB 0
0007EA 37AD       01749 	RLCF  C19tmp,1,1
0007EC 37AE       01750 	RLCF  C19tmp+1,1,1
0007EE 37AF       01751 	RLCF  C20rem,1,1
0007F0 37B0       01752 	RLCF  C20rem+1,1,1
0007F2 0E10       01753 	MOVLW 16
0007F4 5DAF       01754 	SUBWF C20rem,W,1
0007F6 0E27       01755 	MOVLW 39
0007F8 59B0       01756 	SUBWFB C20rem+1,W,1
0007FA A0D8       01757 	BTFSS 0xFD8,Carry,0
0007FC D006       01758 	BRA   m103
0007FE 0E10       01759 	MOVLW 16
000800 0100       01760 	MOVLB 0
000802 5FAF       01761 	SUBWF C20rem,1,1
000804 0E27       01762 	MOVLW 39
000806 5BB0       01763 	SUBWFB C20rem+1,1,1
000808 80D8       01764 	BSF   0xFD8,Carry,0
00080A 0100       01765 m103	MOVLB 0
00080C 37A2       01766 	RLCF  d_milers,1,1
00080E 37A3       01767 	RLCF  d_milers+1,1,1
000810 2FAC       01768 	DECFSZ C18cnt,1,1
000812 D7EA       01769 	BRA   m102
                  01770 			;			num= num%10000;
000814 519C       01771 	MOVF  num_2,W,1
000816 6FAD       01772 	MOVWF C22tmp,1
000818 519D       01773 	MOVF  num_2+1,W,1
00081A 6FAE       01774 	MOVWF C22tmp+1,1
00081C 6B9C       01775 	CLRF  num_2,1
00081E 6B9D       01776 	CLRF  num_2+1,1
000820 0E10       01777 	MOVLW 16
000822 6FAC       01778 	MOVWF C21cnt,1
000824 0100       01779 m104	MOVLB 0
000826 37AD       01780 	RLCF  C22tmp,1,1
000828 37AE       01781 	RLCF  C22tmp+1,1,1
00082A 379C       01782 	RLCF  num_2,1,1
00082C 379D       01783 	RLCF  num_2+1,1,1
00082E 0E10       01784 	MOVLW 16
000830 5D9C       01785 	SUBWF num_2,W,1
000832 0E27       01786 	MOVLW 39
000834 599D       01787 	SUBWFB num_2+1,W,1
000836 A0D8       01788 	BTFSS 0xFD8,Carry,0
000838 D005       01789 	BRA   m105
00083A 0E10       01790 	MOVLW 16
00083C 0100       01791 	MOVLB 0
00083E 5F9C       01792 	SUBWF num_2,1,1
000840 0E27       01793 	MOVLW 39
000842 5B9D       01794 	SUBWFB num_2+1,1,1
000844 0100       01795 m105	MOVLB 0
000846 2FAC       01796 	DECFSZ C21cnt,1,1
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 31

ADDR   CODE       LINE  SOURCE

000848 D7ED       01797 	BRA   m104
                  01798 			;			u_milers = num / 1000;
00084A 519C       01799 	MOVF  num_2,W,1
00084C 6FAD       01800 	MOVWF C24tmp,1
00084E 519D       01801 	MOVF  num_2+1,W,1
000850 6FAE       01802 	MOVWF C24tmp+1,1
000852 6BAF       01803 	CLRF  C25rem,1
000854 6BB0       01804 	CLRF  C25rem+1,1
000856 0E10       01805 	MOVLW 16
000858 6FAC       01806 	MOVWF C23cnt,1
00085A 0100       01807 m106	MOVLB 0
00085C 37AD       01808 	RLCF  C24tmp,1,1
00085E 37AE       01809 	RLCF  C24tmp+1,1,1
000860 37AF       01810 	RLCF  C25rem,1,1
000862 37B0       01811 	RLCF  C25rem+1,1,1
000864 0EE8       01812 	MOVLW 232
000866 5DAF       01813 	SUBWF C25rem,W,1
000868 0E03       01814 	MOVLW 3
00086A 59B0       01815 	SUBWFB C25rem+1,W,1
00086C A0D8       01816 	BTFSS 0xFD8,Carry,0
00086E D006       01817 	BRA   m107
000870 0EE8       01818 	MOVLW 232
000872 0100       01819 	MOVLB 0
000874 5FAF       01820 	SUBWF C25rem,1,1
000876 0E03       01821 	MOVLW 3
000878 5BB0       01822 	SUBWFB C25rem+1,1,1
00087A 80D8       01823 	BSF   0xFD8,Carry,0
00087C 0100       01824 m107	MOVLB 0
00087E 379E       01825 	RLCF  u_milers_2,1,1
000880 379F       01826 	RLCF  u_milers_2+1,1,1
000882 2FAC       01827 	DECFSZ C23cnt,1,1
000884 D7EA       01828 	BRA   m106
                  01829 			;			dato = num % 1000;
000886 519C       01830 	MOVF  num_2,W,1
000888 6FAD       01831 	MOVWF C27tmp,1
00088A 519D       01832 	MOVF  num_2+1,W,1
00088C 6FAE       01833 	MOVWF C27tmp+1,1
00088E 6B9A       01834 	CLRF  dato_4,1
000890 6B9B       01835 	CLRF  dato_4+1,1
000892 0E10       01836 	MOVLW 16
000894 6FAC       01837 	MOVWF C26cnt,1
000896 0100       01838 m108	MOVLB 0
000898 37AD       01839 	RLCF  C27tmp,1,1
00089A 37AE       01840 	RLCF  C27tmp+1,1,1
00089C 379A       01841 	RLCF  dato_4,1,1
00089E 379B       01842 	RLCF  dato_4+1,1,1
0008A0 0EE8       01843 	MOVLW 232
0008A2 5D9A       01844 	SUBWF dato_4,W,1
0008A4 0E03       01845 	MOVLW 3
0008A6 599B       01846 	SUBWFB dato_4+1,W,1
0008A8 A0D8       01847 	BTFSS 0xFD8,Carry,0
0008AA D005       01848 	BRA   m109
0008AC 0EE8       01849 	MOVLW 232
0008AE 0100       01850 	MOVLB 0
0008B0 5F9A       01851 	SUBWF dato_4,1,1
0008B2 0E03       01852 	MOVLW 3
0008B4 5B9B       01853 	SUBWFB dato_4+1,1,1
0008B6 0100       01854 m109	MOVLB 0
0008B8 2FAC       01855 	DECFSZ C26cnt,1,1
0008BA D7ED       01856 	BRA   m108
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 32

ADDR   CODE       LINE  SOURCE

                  01857 			;
                  01858 			;			cent   = dato   / 100;   	
0008BC 519A       01859 	MOVF  dato_4,W,1
0008BE 6FAD       01860 	MOVWF C29tmp,1
0008C0 519B       01861 	MOVF  dato_4+1,W,1
0008C2 6FAE       01862 	MOVWF C29tmp+1,1
0008C4 6BAF       01863 	CLRF  C30rem,1
0008C6 0E10       01864 	MOVLW 16
0008C8 6FAC       01865 	MOVWF C28cnt,1
0008CA 0100       01866 m110	MOVLB 0
0008CC 37AD       01867 	RLCF  C29tmp,1,1
0008CE 37AE       01868 	RLCF  C29tmp+1,1,1
0008D0 37AF       01869 	RLCF  C30rem,1,1
0008D2 B0D8       01870 	BTFSC 0xFD8,Carry,0
0008D4 D004       01871 	BRA   m111
0008D6 0E64       01872 	MOVLW 100
0008D8 5DAF       01873 	SUBWF C30rem,W,1
0008DA A0D8       01874 	BTFSS 0xFD8,Carry,0
0008DC D004       01875 	BRA   m112
0008DE 0E64       01876 m111	MOVLW 100
0008E0 0100       01877 	MOVLB 0
0008E2 5FAF       01878 	SUBWF C30rem,1,1
0008E4 80D8       01879 	BSF   0xFD8,Carry,0
0008E6 0100       01880 m112	MOVLB 0
0008E8 37A0       01881 	RLCF  cent_2,1,1
0008EA 37A1       01882 	RLCF  cent_2+1,1,1
0008EC 2FAC       01883 	DECFSZ C28cnt,1,1
0008EE D7ED       01884 	BRA   m110
                  01885 			;			resto1 = dato   % 100;
0008F0 519A       01886 	MOVF  dato_4,W,1
0008F2 6FAD       01887 	MOVWF C32tmp,1
0008F4 519B       01888 	MOVF  dato_4+1,W,1
0008F6 6FAE       01889 	MOVWF C32tmp+1,1
0008F8 6BA6       01890 	CLRF  resto1_2,1
0008FA 0E10       01891 	MOVLW 16
0008FC 6FAC       01892 	MOVWF C31cnt,1
0008FE 0100       01893 m113	MOVLB 0
000900 37AD       01894 	RLCF  C32tmp,1,1
000902 37AE       01895 	RLCF  C32tmp+1,1,1
000904 37A6       01896 	RLCF  resto1_2,1,1
000906 B0D8       01897 	BTFSC 0xFD8,Carry,0
000908 D004       01898 	BRA   m114
00090A 0E64       01899 	MOVLW 100
00090C 5DA6       01900 	SUBWF resto1_2,W,1
00090E A0D8       01901 	BTFSS 0xFD8,Carry,0
000910 D003       01902 	BRA   m115
000912 0E64       01903 m114	MOVLW 100
000914 0100       01904 	MOVLB 0
000916 5FA6       01905 	SUBWF resto1_2,1,1
000918 0100       01906 m115	MOVLB 0
00091A 2FAC       01907 	DECFSZ C31cnt,1,1
00091C D7F0       01908 	BRA   m113
                  01909 			;			dec    = resto1 /  10;  
00091E 51A6       01910 	MOVF  resto1_2,W,1
000920 6FAD       01911 	MOVWF C34tmp,1
000922 6BAE       01912 	CLRF  C35rem,1
000924 0E08       01913 	MOVLW 8
000926 6FAC       01914 	MOVWF C33cnt,1
000928 0100       01915 m116	MOVLB 0
00092A 37AD       01916 	RLCF  C34tmp,1,1
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 33

ADDR   CODE       LINE  SOURCE

00092C 37AE       01917 	RLCF  C35rem,1,1
00092E 0E0A       01918 	MOVLW 10
000930 5DAE       01919 	SUBWF C35rem,W,1
000932 A0D8       01920 	BTFSS 0xFD8,Carry,0
000934 D004       01921 	BRA   m117
000936 0E0A       01922 	MOVLW 10
000938 0100       01923 	MOVLB 0
00093A 5FAE       01924 	SUBWF C35rem,1,1
00093C 80D8       01925 	BSF   0xFD8,Carry,0
00093E 0100       01926 m117	MOVLB 0
000940 37A4       01927 	RLCF  dec_2,1,1
000942 2FAC       01928 	DECFSZ C33cnt,1,1
000944 D7F1       01929 	BRA   m116
                  01930 			;			unid   = resto1 %  10; 		
000946 51A6       01931 	MOVF  resto1_2,W,1
000948 6FAD       01932 	MOVWF C37tmp,1
00094A 6BA5       01933 	CLRF  unid_2,1
00094C 0E08       01934 	MOVLW 8
00094E 6FAC       01935 	MOVWF C36cnt,1
000950 0100       01936 m118	MOVLB 0
000952 37AD       01937 	RLCF  C37tmp,1,1
000954 37A5       01938 	RLCF  unid_2,1,1
000956 0E0A       01939 	MOVLW 10
000958 5DA5       01940 	SUBWF unid_2,W,1
00095A A0D8       01941 	BTFSS 0xFD8,Carry,0
00095C D003       01942 	BRA   m119
00095E 0E0A       01943 	MOVLW 10
000960 0100       01944 	MOVLB 0
000962 5FA5       01945 	SUBWF unid_2,1,1
000964 0100       01946 m119	MOVLB 0
000966 2FAC       01947 	DECFSZ C36cnt,1,1
000968 D7F3       01948 	BRA   m118
                  01949 			;		// Envio
                  01950 			;		for (xx=0 ; xx < 5; xx++)
00096A 6BA8       01951 	CLRF  xx_2,1
00096C 0E05       01952 m120	MOVLW 5
00096E 0100       01953 	MOVLB 0
000970 61A8       01954 	CPFSLT xx_2,1
000972 D0B4       01955 	BRA   m136
                  01956 			;		{
                  01957 			;			switch(xx){
000974 51A8       01958 	MOVF  xx_2,W,1
000976 B4D8       01959 	BTFSC 0xFD8,Zero_,0
000978 D00D       01960 	BRA   m121
00097A 0A01       01961 	XORLW 1
00097C B4D8       01962 	BTFSC 0xFD8,Zero_,0
00097E D015       01963 	BRA   m123
000980 0A03       01964 	XORLW 3
000982 B4D8       01965 	BTFSC 0xFD8,Zero_,0
000984 D021       01966 	BRA   m125
000986 0A01       01967 	XORLW 1
000988 B4D8       01968 	BTFSC 0xFD8,Zero_,0
00098A D031       01969 	BRA   m127
00098C 0A07       01970 	XORLW 7
00098E B4D8       01971 	BTFSC 0xFD8,Zero_,0
000990 D044       01972 	BRA   m129
000992 D045       01973 	BRA   m130
                  01974 			;				case 0:
                  01975 			;					if (d_milers==0) dat = ' '; 
000994 0100       01976 m121	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 34

ADDR   CODE       LINE  SOURCE

000996 51A2       01977 	MOVF  d_milers,W,1
000998 11A3       01978 	IORWF d_milers+1,W,1
00099A A4D8       01979 	BTFSS 0xFD8,Zero_,0
00099C D003       01980 	BRA   m122
00099E 0E20       01981 	MOVLW 32
0009A0 6FAA       01982 	MOVWF dat_2,1
                  01983 			;					else dat = d_milers;
0009A2 D03D       01984 	BRA   m130
0009A4 C0A2 F0AA  01985 m122	MOVFF d_milers,dat_2
                  01986 			;					break;
0009A8 D03A       01987 	BRA   m130
                  01988 			;				case 1:
                  01989 			;					if ((u_milers==0)&&(d_milers==0)) dat = ' ';
0009AA 0100       01990 m123	MOVLB 0
0009AC 519E       01991 	MOVF  u_milers_2,W,1
0009AE 119F       01992 	IORWF u_milers_2+1,W,1
0009B0 A4D8       01993 	BTFSS 0xFD8,Zero_,0
0009B2 D007       01994 	BRA   m124
0009B4 51A2       01995 	MOVF  d_milers,W,1
0009B6 11A3       01996 	IORWF d_milers+1,W,1
0009B8 A4D8       01997 	BTFSS 0xFD8,Zero_,0
0009BA D003       01998 	BRA   m124
0009BC 0E20       01999 	MOVLW 32
0009BE 6FAA       02000 	MOVWF dat_2,1
                  02001 			;					else dat = u_milers;
0009C0 D02E       02002 	BRA   m130
0009C2 C09E F0AA  02003 m124	MOVFF u_milers_2,dat_2
                  02004 			;					break;
0009C6 D02B       02005 	BRA   m130
                  02006 			;				case 2:
                  02007 			;					if ((d_milers==0)&&(u_milers==0)&&(cent==0)) dat = ' '; 
0009C8 0100       02008 m125	MOVLB 0
0009CA 51A2       02009 	MOVF  d_milers,W,1
0009CC 11A3       02010 	IORWF d_milers+1,W,1
0009CE A4D8       02011 	BTFSS 0xFD8,Zero_,0
0009D0 D00B       02012 	BRA   m126
0009D2 519E       02013 	MOVF  u_milers_2,W,1
0009D4 119F       02014 	IORWF u_milers_2+1,W,1
0009D6 A4D8       02015 	BTFSS 0xFD8,Zero_,0
0009D8 D007       02016 	BRA   m126
0009DA 51A0       02017 	MOVF  cent_2,W,1
0009DC 11A1       02018 	IORWF cent_2+1,W,1
0009DE A4D8       02019 	BTFSS 0xFD8,Zero_,0
0009E0 D003       02020 	BRA   m126
0009E2 0E20       02021 	MOVLW 32
0009E4 6FAA       02022 	MOVWF dat_2,1
                  02023 			;					else dat = cent;
0009E6 D01B       02024 	BRA   m130
0009E8 C0A0 F0AA  02025 m126	MOVFF cent_2,dat_2
                  02026 			;					break;
0009EC D018       02027 	BRA   m130
                  02028 			;				case 3:
                  02029 			;					if ((u_milers==0)&&(cent==0)&&(dec==0)&&(d_milers==0)) dat = ' ';
0009EE 0100       02030 m127	MOVLB 0
0009F0 519E       02031 	MOVF  u_milers_2,W,1
0009F2 119F       02032 	IORWF u_milers_2+1,W,1
0009F4 A4D8       02033 	BTFSS 0xFD8,Zero_,0
0009F6 D00E       02034 	BRA   m128
0009F8 51A0       02035 	MOVF  cent_2,W,1
0009FA 11A1       02036 	IORWF cent_2+1,W,1
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 35

ADDR   CODE       LINE  SOURCE

0009FC A4D8       02037 	BTFSS 0xFD8,Zero_,0
0009FE D00A       02038 	BRA   m128
000A00 53A4       02039 	MOVF  dec_2,1,1
000A02 A4D8       02040 	BTFSS 0xFD8,Zero_,0
000A04 D007       02041 	BRA   m128
000A06 51A2       02042 	MOVF  d_milers,W,1
000A08 11A3       02043 	IORWF d_milers+1,W,1
000A0A A4D8       02044 	BTFSS 0xFD8,Zero_,0
000A0C D003       02045 	BRA   m128
000A0E 0E20       02046 	MOVLW 32
000A10 6FAA       02047 	MOVWF dat_2,1
                  02048 			;					else dat = dec ;
000A12 D005       02049 	BRA   m130
000A14 C0A4 F0AA  02050 m128	MOVFF dec_2,dat_2
                  02051 			;					break;
000A18 D002       02052 	BRA   m130
                  02053 			;				case 4:
                  02054 			;					dat = unid;
000A1A C0A5 F0AA  02055 m129	MOVFF unid_2,dat_2
                  02056 			;					break;
                  02057 			;			}		
                  02058 			;			if (dat!=' ') dat = dat + 0x30;
000A1E 0100       02059 m130	MOVLB 0
000A20 51AA       02060 	MOVF  dat_2,W,1
000A22 0A20       02061 	XORLW 32
000A24 B4D8       02062 	BTFSC 0xFD8,Zero_,0
000A26 D002       02063 	BRA   m131
000A28 0E30       02064 	MOVLW 48
000A2A 27AA       02065 	ADDWF dat_2,1,1
                  02066 			;			PORTB.3 = dat.4;nop();
000A2C 0100       02067 m131	MOVLB 0
000A2E A9AA       02068 	BTFSS dat_2,4,1
000A30 9681       02069 	BCF   PORTB,3,0
000A32 B9AA       02070 	BTFSC dat_2,4,1
000A34 8681       02071 	BSF   PORTB,3,0
000A36 0000       02072 	NOP  
                  02073 			;			PORTB.2 = dat.5;nop();
000A38 ABAA       02074 	BTFSS dat_2,5,1
000A3A 9481       02075 	BCF   PORTB,2,0
000A3C BBAA       02076 	BTFSC dat_2,5,1
000A3E 8481       02077 	BSF   PORTB,2,0
000A40 0000       02078 	NOP  
                  02079 			;			PORTB.1 = dat.6;nop();
000A42 ADAA       02080 	BTFSS dat_2,6,1
000A44 9281       02081 	BCF   PORTB,1,0
000A46 BDAA       02082 	BTFSC dat_2,6,1
000A48 8281       02083 	BSF   PORTB,1,0
000A4A 0000       02084 	NOP  
                  02085 			;			PORTB.0 = dat.7;nop();
000A4C AFAA       02086 	BTFSS dat_2,7,1
000A4E 9081       02087 	BCF   PORTB,0,0
000A50 BFAA       02088 	BTFSC dat_2,7,1
000A52 8081       02089 	BSF   PORTB,0,0
000A54 0000       02090 	NOP  
                  02091 			;			PORTB.5 = 1;  									// Modo dato.
000A56 8A81       02092 	BSF   PORTB,5,0
                  02093 			;			retardo_20u ();
000A58 EC7D F000  02094 	CALL  retardo_20u
                  02095 			;			PORTB.4 = 1;  									// Breve pulso.
000A5C 8881       02096 	BSF   PORTB,4,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 36

ADDR   CODE       LINE  SOURCE

                  02097 			;			retardo_20u ();
000A5E EC7D F000  02098 	CALL  retardo_20u
                  02099 			;			PORTB.4 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
000A62 9881       02100 	BCF   PORTB,4,0
                  02101 			;			for (i = 1; i <= 6; i++) retardo_20u ();
000A64 0E01       02102 	MOVLW 1
000A66 0100       02103 	MOVLB 0
000A68 6FA7       02104 	MOVWF i_7,1
000A6A 0E07       02105 m132	MOVLW 7
000A6C 0100       02106 	MOVLB 0
000A6E 61A7       02107 	CPFSLT i_7,1
000A70 D005       02108 	BRA   m133
000A72 EC7D F000  02109 	CALL  retardo_20u
000A76 0100       02110 	MOVLB 0
000A78 2BA7       02111 	INCF  i_7,1,1
000A7A D7F7       02112 	BRA   m132
                  02113 			;			dat = swap (dat);
000A7C 0100       02114 m133	MOVLB 0
000A7E 3BAA       02115 	SWAPF dat_2,1,1
                  02116 			;			PORTB.3 = dat.4;nop();
000A80 A9AA       02117 	BTFSS dat_2,4,1
000A82 9681       02118 	BCF   PORTB,3,0
000A84 B9AA       02119 	BTFSC dat_2,4,1
000A86 8681       02120 	BSF   PORTB,3,0
000A88 0000       02121 	NOP  
                  02122 			;			PORTB.2 = dat.5;nop();
000A8A ABAA       02123 	BTFSS dat_2,5,1
000A8C 9481       02124 	BCF   PORTB,2,0
000A8E BBAA       02125 	BTFSC dat_2,5,1
000A90 8481       02126 	BSF   PORTB,2,0
000A92 0000       02127 	NOP  
                  02128 			;			PORTB.1 = dat.6;nop();
000A94 ADAA       02129 	BTFSS dat_2,6,1
000A96 9281       02130 	BCF   PORTB,1,0
000A98 BDAA       02131 	BTFSC dat_2,6,1
000A9A 8281       02132 	BSF   PORTB,1,0
000A9C 0000       02133 	NOP  
                  02134 			;			PORTB.0 = dat.7;
000A9E AFAA       02135 	BTFSS dat_2,7,1
000AA0 9081       02136 	BCF   PORTB,0,0
000AA2 BFAA       02137 	BTFSC dat_2,7,1
000AA4 8081       02138 	BSF   PORTB,0,0
                  02139 			;			retardo_1m ();
000AA6 EC87 F000  02140 	CALL  retardo_1m
                  02141 			;			PORTB.5 = 1;  									// Modo dato.
000AAA 8A81       02142 	BSF   PORTB,5,0
                  02143 			;			retardo_1m ();
000AAC EC87 F000  02144 	CALL  retardo_1m
                  02145 			;			PORTB.4 = 1;  									// Breve pulso.
000AB0 8881       02146 	BSF   PORTB,4,0
                  02147 			;			retardo_20u ();
000AB2 EC7D F000  02148 	CALL  retardo_20u
                  02149 			;			PORTB.4 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000AB6 9881       02150 	BCF   PORTB,4,0
                  02151 			;			for (i = 1; i<= 6; i++) retardo_20u ();
000AB8 0E01       02152 	MOVLW 1
000ABA 0100       02153 	MOVLB 0
000ABC 6FA7       02154 	MOVWF i_7,1
000ABE 0E07       02155 m134	MOVLW 7
000AC0 0100       02156 	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 37

ADDR   CODE       LINE  SOURCE

000AC2 61A7       02157 	CPFSLT i_7,1
000AC4 D005       02158 	BRA   m135
000AC6 EC7D F000  02159 	CALL  retardo_20u
000ACA 0100       02160 	MOVLB 0
000ACC 2BA7       02161 	INCF  i_7,1,1
000ACE D7F7       02162 	BRA   m134
                  02163 			;			enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.			
000AD0 0E0C       02164 m135	MOVLW 12
000AD2 ECF0 F000  02165 	CALL  enviar_comando
                  02166 			;		}
000AD6 0100       02167 	MOVLB 0
000AD8 2BA8       02168 	INCF  xx_2,1,1
000ADA D748       02169 	BRA   m120
                  02170 			;
                  02171 			;	return;
000ADC 0012       02172 m136	RETURN
                  02173 			;
                  02174 			;}
                  02175 			;
                  02176 			;//***********************************************************************************************
                  02177 			;//***********************************************************************************************
                  02178 			;// Definicio caracter especial : PROCES  -> posar x, on volguem el pixel ,pes 16 8 4 2 1  Rtat Hexa
                  02179 			;//                         -  contar pesos ( veure exple, per Ah)             ° °x°x° ° ° 0x0C
                  02180 			;//                             -  de dalt a baix, es el codi a posar          °x° ° °x° ° 0x12
                  02181 			;//                                                en el vector.               °x°x°x°x° ° 0x1E
                  02182 			;//                   - Al inici cridar funcio per ecriure CGRAM               °x° ° °x° ° 0x12
                  02183 			;//                    - Hi caben 8 carac especials de 64 a 120                ° ° °x° ° ° 0x00
                  02184 			;//                       de 8 e 8,  64 , 72, 80, 88, 96,104.112,120           ° ° °x°x°x° 0x04
                  02185 			;//                   - Despres d'escriure la CGRAM, cal fer un                ° ° °x° °x° 0x07
                  02186 			;//                     comando, per no apuntar a la CGRAM                     ° ° °x° °x° 0x05
                  02187 			;// Per escriure simbol .... fer :   enviar_literal(3);enviar_literal(4);
                  02188 			;//************IMPORTANTE****************************************
                  02189 			;//******Poner despues de inicializar_lcd();*********************
                  02190 			;void RAM_LCD (void)
                  02191 			;{
                  02192 RAM_LCD
                  02193 			;	static const char Carac_1[] = {0x0C,0x10,0x08,0x04,0x1B,0x04,0x04,0x03};//caracter micro 	//escribir_literal(0);
                  02194 			;	static const char Carac_2[] = {0xEE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};	//escribir_literal(1); BAT_FULL
                  02195 			;	static const char Carac_3[] = {0xEE,0xFF,0xF1,0xFF,0xFF,0xFF,0xFF,0xFF};	// ""...               BAT_75
                  02196 			;	static const char Carac_4[] = {0xEE,0xFF,0xF1,0xF1,0xFF,0xFF,0xFF,0xFF};					    // BAT_50
                  02197 			;	static const char Carac_5[] = {0xEE,0xFF,0xF1,0xF1,0xF1,0xFF,0xFF,0xFF};					    // BAT_25
                  02198 			;	static const char Carac_6[] = {0xEE,0xFF,0xF1,0xF1,0xF1,0xF1,0xFF,0xFF};					    // BAT_10
                  02199 			;	static const char Carac_7[] = {0xEE,0xFF,0xF1,0xF1,0xF1,0xF1,0xF1,0xFF};					    // BAT_LW
                  02200 			;	static const char Carac_8[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
                  02201 			;	// 1era posicio CGRAM es la 64 , 72, 80, 88, 96,104.112,120
                  02202 			;	char i;
                  02203 			;	
                  02204 			;	enviar_comando (64);// primera posicio del Carac_1, els altres seran consecutius
000ADE 0E40       02205 	MOVLW 64
000AE0 ECF0 F000  02206 	CALL  enviar_comando
                  02207 			;	retardo_20u ();
000AE4 EC7D F000  02208 	CALL  retardo_20u
                  02209 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_1[i]); retardo_20u (); retardo_20u ();}
000AE8 0100       02210 	MOVLB 0
000AEA 6B96       02211 	CLRF  i_8,1
000AEC 0E08       02212 m137	MOVLW 8
000AEE 0100       02213 	MOVLB 0
000AF0 6196       02214 	CPFSLT i_8,1
000AF2 D00D       02215 	BRA   m138
000AF4 0E1A       02216 	MOVLW 26
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 38

ADDR   CODE       LINE  SOURCE

000AF6 2596       02217 	ADDWF i_8,W,1
000AF8 ECAB F009  02218 	CALL  _const1
000AFC EC2B F001  02219 	CALL  enviar_literal
000B00 EC7D F000  02220 	CALL  retardo_20u
000B04 EC7D F000  02221 	CALL  retardo_20u
000B08 0100       02222 	MOVLB 0
000B0A 2B96       02223 	INCF  i_8,1,1
000B0C D7EF       02224 	BRA   m137
                  02225 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_2[i]); retardo_20u (); retardo_20u ();}
000B0E 0100       02226 m138	MOVLB 0
000B10 6B96       02227 	CLRF  i_8,1
000B12 0E08       02228 m139	MOVLW 8
000B14 0100       02229 	MOVLB 0
000B16 6196       02230 	CPFSLT i_8,1
000B18 D00D       02231 	BRA   m140
000B1A 0E22       02232 	MOVLW 34
000B1C 2596       02233 	ADDWF i_8,W,1
000B1E ECAB F009  02234 	CALL  _const1
000B22 EC2B F001  02235 	CALL  enviar_literal
000B26 EC7D F000  02236 	CALL  retardo_20u
000B2A EC7D F000  02237 	CALL  retardo_20u
000B2E 0100       02238 	MOVLB 0
000B30 2B96       02239 	INCF  i_8,1,1
000B32 D7EF       02240 	BRA   m139
                  02241 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_3[i]); retardo_20u (); retardo_20u ();}
000B34 0100       02242 m140	MOVLB 0
000B36 6B96       02243 	CLRF  i_8,1
000B38 0E08       02244 m141	MOVLW 8
000B3A 0100       02245 	MOVLB 0
000B3C 6196       02246 	CPFSLT i_8,1
000B3E D00D       02247 	BRA   m142
000B40 0E2A       02248 	MOVLW 42
000B42 2596       02249 	ADDWF i_8,W,1
000B44 ECAB F009  02250 	CALL  _const1
000B48 EC2B F001  02251 	CALL  enviar_literal
000B4C EC7D F000  02252 	CALL  retardo_20u
000B50 EC7D F000  02253 	CALL  retardo_20u
000B54 0100       02254 	MOVLB 0
000B56 2B96       02255 	INCF  i_8,1,1
000B58 D7EF       02256 	BRA   m141
                  02257 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_4[i]); retardo_20u (); retardo_20u ();}
000B5A 0100       02258 m142	MOVLB 0
000B5C 6B96       02259 	CLRF  i_8,1
000B5E 0E08       02260 m143	MOVLW 8
000B60 0100       02261 	MOVLB 0
000B62 6196       02262 	CPFSLT i_8,1
000B64 D00C       02263 	BRA   m144
000B66 0E32       02264 	MOVLW 50
000B68 2596       02265 	ADDWF i_8,W,1
000B6A DBF5       02266 	RCALL _const1
000B6C EC2B F001  02267 	CALL  enviar_literal
000B70 EC7D F000  02268 	CALL  retardo_20u
000B74 EC7D F000  02269 	CALL  retardo_20u
000B78 0100       02270 	MOVLB 0
000B7A 2B96       02271 	INCF  i_8,1,1
000B7C D7F0       02272 	BRA   m143
                  02273 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_5[i]); retardo_20u (); retardo_20u ();}
000B7E 0100       02274 m144	MOVLB 0
000B80 6B96       02275 	CLRF  i_8,1
000B82 0E08       02276 m145	MOVLW 8
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 39

ADDR   CODE       LINE  SOURCE

000B84 0100       02277 	MOVLB 0
000B86 6196       02278 	CPFSLT i_8,1
000B88 D00C       02279 	BRA   m146
000B8A 0E3A       02280 	MOVLW 58
000B8C 2596       02281 	ADDWF i_8,W,1
000B8E DBE3       02282 	RCALL _const1
000B90 EC2B F001  02283 	CALL  enviar_literal
000B94 EC7D F000  02284 	CALL  retardo_20u
000B98 EC7D F000  02285 	CALL  retardo_20u
000B9C 0100       02286 	MOVLB 0
000B9E 2B96       02287 	INCF  i_8,1,1
000BA0 D7F0       02288 	BRA   m145
                  02289 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_6[i]); retardo_20u (); retardo_20u ();}
000BA2 0100       02290 m146	MOVLB 0
000BA4 6B96       02291 	CLRF  i_8,1
000BA6 0E08       02292 m147	MOVLW 8
000BA8 0100       02293 	MOVLB 0
000BAA 6196       02294 	CPFSLT i_8,1
000BAC D00C       02295 	BRA   m148
000BAE 0E42       02296 	MOVLW 66
000BB0 2596       02297 	ADDWF i_8,W,1
000BB2 DBD1       02298 	RCALL _const1
000BB4 EC2B F001  02299 	CALL  enviar_literal
000BB8 EC7D F000  02300 	CALL  retardo_20u
000BBC EC7D F000  02301 	CALL  retardo_20u
000BC0 0100       02302 	MOVLB 0
000BC2 2B96       02303 	INCF  i_8,1,1
000BC4 D7F0       02304 	BRA   m147
                  02305 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_7[i]); retardo_20u (); retardo_20u ();}
000BC6 0100       02306 m148	MOVLB 0
000BC8 6B96       02307 	CLRF  i_8,1
000BCA 0E08       02308 m149	MOVLW 8
000BCC 0100       02309 	MOVLB 0
000BCE 6196       02310 	CPFSLT i_8,1
000BD0 D00C       02311 	BRA   m150
000BD2 0E4A       02312 	MOVLW 74
000BD4 2596       02313 	ADDWF i_8,W,1
000BD6 DBBF       02314 	RCALL _const1
000BD8 EC2B F001  02315 	CALL  enviar_literal
000BDC EC7D F000  02316 	CALL  retardo_20u
000BE0 EC7D F000  02317 	CALL  retardo_20u
000BE4 0100       02318 	MOVLB 0
000BE6 2B96       02319 	INCF  i_8,1,1
000BE8 D7F0       02320 	BRA   m149
                  02321 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_8[i]); retardo_20u (); retardo_20u ();}	
000BEA 0100       02322 m150	MOVLB 0
000BEC 6B96       02323 	CLRF  i_8,1
000BEE 0E08       02324 m151	MOVLW 8
000BF0 0100       02325 	MOVLB 0
000BF2 6196       02326 	CPFSLT i_8,1
000BF4 D00C       02327 	BRA   m152
000BF6 0E52       02328 	MOVLW 82
000BF8 2596       02329 	ADDWF i_8,W,1
000BFA DBAD       02330 	RCALL _const1
000BFC EC2B F001  02331 	CALL  enviar_literal
000C00 EC7D F000  02332 	CALL  retardo_20u
000C04 EC7D F000  02333 	CALL  retardo_20u
000C08 0100       02334 	MOVLB 0
000C0A 2B96       02335 	INCF  i_8,1,1
000C0C D7F0       02336 	BRA   m151
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 40

ADDR   CODE       LINE  SOURCE

                  02337 			;	enviar_comando (0b.0000.0010);
000C0E 0E02       02338 m152	MOVLW 2
000C10 EFF0 F000  02339 	GOTO  enviar_comando
                  02340 			;	
                  02341 			;	return;
                  02342 
                  02343   ; FILE medir_18F4XK20.h
                  02344 			;/*funci√≥n void medir (char, char)
                  02345 			;recibe como par√°metros:
                  02346 			;Primer par√°metro: el canal A/D a convertir  (0...4,8...13) . Si est√° fuera del rango, toma 0 por defecto
                  02347 			;Segundo par√°metro: solo admite 8 o 10 (bits del resultado). si el par√°metro no es 8 o 10,
                  02348 			;interpreta autom√°ticamente a 10.
                  02349 			;Siempre. se configura autom√°ticamente la entrada anal√≥gica solicitada. Fosc/32
                  02350 			;Requiere la funci√≥n retardo_20u()  (en retardos.h)
                  02351 			;resultado: en ADRESH:ADRESL
                  02352 			;*/
                  02353 			;uns16 medir (char canal, char bits)
                  02354 			;{
                  02355 medir
000C14 0100       02356 	MOVLB 0
000C16 6F99       02357 	MOVWF bits,1
                  02358 			;	uns16 resultado;
                  02359 			;	switch (canal)
000C18 5198       02360 	MOVF  canal,W,1
000C1A B4D8       02361 	BTFSC 0xFD8,Zero_,0
000C1C D028       02362 	BRA   m153
000C1E 0A01       02363 	XORLW 1
000C20 B4D8       02364 	BTFSC 0xFD8,Zero_,0
000C22 D028       02365 	BRA   m154
000C24 0A03       02366 	XORLW 3
000C26 B4D8       02367 	BTFSC 0xFD8,Zero_,0
000C28 D028       02368 	BRA   m155
000C2A 0A01       02369 	XORLW 1
000C2C B4D8       02370 	BTFSC 0xFD8,Zero_,0
000C2E D028       02371 	BRA   m156
000C30 0A07       02372 	XORLW 7
000C32 B4D8       02373 	BTFSC 0xFD8,Zero_,0
000C34 D028       02374 	BRA   m157
000C36 0A01       02375 	XORLW 1
000C38 B4D8       02376 	BTFSC 0xFD8,Zero_,0
000C3A D028       02377 	BRA   m158
000C3C 0A03       02378 	XORLW 3
000C3E B4D8       02379 	BTFSC 0xFD8,Zero_,0
000C40 D028       02380 	BRA   m159
000C42 0A01       02381 	XORLW 1
000C44 B4D8       02382 	BTFSC 0xFD8,Zero_,0
000C46 D028       02383 	BRA   m160
000C48 0A0F       02384 	XORLW 15
000C4A B4D8       02385 	BTFSC 0xFD8,Zero_,0
000C4C D028       02386 	BRA   m161
000C4E 0A01       02387 	XORLW 1
000C50 B4D8       02388 	BTFSC 0xFD8,Zero_,0
000C52 D028       02389 	BRA   m162
000C54 0A03       02390 	XORLW 3
000C56 B4D8       02391 	BTFSC 0xFD8,Zero_,0
000C58 D028       02392 	BRA   m163
000C5A 0A01       02393 	XORLW 1
000C5C B4D8       02394 	BTFSC 0xFD8,Zero_,0
000C5E D028       02395 	BRA   m164
000C60 0A07       02396 	XORLW 7
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 41

ADDR   CODE       LINE  SOURCE

000C62 B4D8       02397 	BTFSC 0xFD8,Zero_,0
000C64 D028       02398 	BRA   m165
000C66 0A01       02399 	XORLW 1
000C68 B4D8       02400 	BTFSC 0xFD8,Zero_,0
000C6A D028       02401 	BRA   m166
000C6C D02A       02402 	BRA   m167
                  02403 			;	{
                  02404 			;		//del 0 al 4, est√°n en el PORTA
                  02405 			;		case 0: 	ADCON0 = 0b.00.0000.01;		break;
000C6E 0E01       02406 m153	MOVLW 1
000C70 6EC2       02407 	MOVWF ADCON0,0
000C72 D029       02408 	BRA   m168
                  02409 			;		case 1:		ADCON0 = 0b.00.0001.01;		break;
000C74 0E05       02410 m154	MOVLW 5
000C76 6EC2       02411 	MOVWF ADCON0,0
000C78 D026       02412 	BRA   m168
                  02413 			;		case 2:		ADCON0 = 0b.00.0010.01;		break;
000C7A 0E09       02414 m155	MOVLW 9
000C7C 6EC2       02415 	MOVWF ADCON0,0
000C7E D023       02416 	BRA   m168
                  02417 			;		case 3:		ADCON0 = 0b.00.0011.01;		break;
000C80 0E0D       02418 m156	MOVLW 13
000C82 6EC2       02419 	MOVWF ADCON0,0
000C84 D020       02420 	BRA   m168
                  02421 			;		case 4:		ADCON0 = 0b.00.0100.01;		break;
000C86 0E11       02422 m157	MOVLW 17
000C88 6EC2       02423 	MOVWF ADCON0,0
000C8A D01D       02424 	BRA   m168
                  02425 			;		case 5:		ADCON0 = 0b.00.0101.01;		break;
000C8C 0E15       02426 m158	MOVLW 21
000C8E 6EC2       02427 	MOVWF ADCON0,0
000C90 D01A       02428 	BRA   m168
                  02429 			;		case 6:		ADCON0 = 0b.00.0110.01;		break;
000C92 0E19       02430 m159	MOVLW 25
000C94 6EC2       02431 	MOVWF ADCON0,0
000C96 D017       02432 	BRA   m168
                  02433 			;		case 7:		ADCON0 = 0b.00.0111.01;		break;
000C98 0E1D       02434 m160	MOVLW 29
000C9A 6EC2       02435 	MOVWF ADCON0,0
000C9C D014       02436 	BRA   m168
                  02437 			;		case 8:		ADCON0 = 0b.00.1000.01;		break;
000C9E 0E21       02438 m161	MOVLW 33
000CA0 6EC2       02439 	MOVWF ADCON0,0
000CA2 D011       02440 	BRA   m168
                  02441 			;		case 9:		ADCON0 = 0b.00.1001.01;		break;
000CA4 0E25       02442 m162	MOVLW 37
000CA6 6EC2       02443 	MOVWF ADCON0,0
000CA8 D00E       02444 	BRA   m168
                  02445 			;		case 10:	ADCON0 = 0b.00.1010.01;		break;
000CAA 0E29       02446 m163	MOVLW 41
000CAC 6EC2       02447 	MOVWF ADCON0,0
000CAE D00B       02448 	BRA   m168
                  02449 			;		case 11:	ADCON0 = 0b.00.1011.01;		break;
000CB0 0E2D       02450 m164	MOVLW 45
000CB2 6EC2       02451 	MOVWF ADCON0,0
000CB4 D008       02452 	BRA   m168
                  02453 			;		case 12:	ADCON0 = 0b.00.1100.01;		break;
000CB6 0E31       02454 m165	MOVLW 49
000CB8 6EC2       02455 	MOVWF ADCON0,0
000CBA D005       02456 	BRA   m168
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 42

ADDR   CODE       LINE  SOURCE

                  02457 			;		case 13:	ADCON0 = 0b.00.1101.01;		break;
000CBC 0E35       02458 m166	MOVLW 53
000CBE 6EC2       02459 	MOVWF ADCON0,0
000CC0 D002       02460 	BRA   m168
                  02461 			;		default:	ADCON0 = 0b.00.0000.01;
000CC2 0E01       02462 m167	MOVLW 1
000CC4 6EC2       02463 	MOVWF ADCON0,0
                  02464 			;	}
                  02465 			;	if (bits == 8){ADFM=0;GO = 1;  while(GO);resultado = ADRESH;}
000CC6 0E08       02466 m168	MOVLW 8
000CC8 0100       02467 	MOVLB 0
000CCA 6399       02468 	CPFSEQ bits,1
000CCC D009       02469 	BRA   m170
000CCE 9EC0       02470 	BCF   0xFC0,ADFM,0
000CD0 82C2       02471 	BSF   0xFC2,GO,0
000CD2 B2C2       02472 m169	BTFSC 0xFC2,GO,0
000CD4 D7FE       02473 	BRA   m169
000CD6 CFC4 F09A  02474 	MOVFF ADRESH,resultado
000CDA 0100       02475 	MOVLB 0
000CDC 6B9B       02476 	CLRF  resultado+1,1
                  02477 			;	else 		  {ADFM=1;GO = 1;  while(GO);resultado.low8 = ADRESL;resultado.high8 = ADRESH;}
000CDE D008       02478 	BRA   m172
000CE0 8EC0       02479 m170	BSF   0xFC0,ADFM,0
000CE2 82C2       02480 	BSF   0xFC2,GO,0
000CE4 B2C2       02481 m171	BTFSC 0xFC2,GO,0
000CE6 D7FE       02482 	BRA   m171
000CE8 CFC3 F09A  02483 	MOVFF ADRESL,resultado
000CEC CFC4 F09B  02484 	MOVFF ADRESH,resultado+1
                  02485 			;   	
                  02486 			;   	return resultado;
000CF0 0100       02487 m172	MOVLB 0
000CF2 519A       02488 	MOVF  resultado,W,1
000CF4 0012       02489 	RETURN
                  02490 
                  02491   ; FILE ondulador_migrado.c
                  02492 			;
                  02493 			;//==============================================================================================
                  02494 			;#include "Temporiz_64Mhz.h"
                  02495 			;void configuraPic (void);
                  02496 			;void configura1_PWM (void); 				// Configura todos los pr√°metros excepto M.
                  02497 			;uns8 lectura_VAC (void);
                  02498 			;	
                  02499 			;#include "LCD_4bit.h"
                  02500 			;#include "medir_18F4XK20.h"
                  02501 			;
                  02502 			;static const char mensaje1[19] ="ONDULADOR 50HZ  by ";
                  02503 			;static const char mensaje2[3] ="VAC";
                  02504 			;static const char mensaje3[5] ="VMAX:";
                  02505 			;static const char mensaje4[3] ="IAC";
                  02506 			;static const uns16 refAC [6] = {600,750,900,900,750,600};
                  02507 			;static const uns16 refIC [6] = {600,750,900,900,750,600};
                  02508 			;//==============================================================================================
                  02509 			;//==============================================================================================
                  02510 			;
                  02511 			;void main (void)
                  02512 			;{
                  02513 main
                  02514 			;
                  02515 			;	GIE = 0;								// Desactivamos inicialmente todas las interrupciones.
000CF6 9EF2       02516 	BCF   0xFF2,GIE,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 43

ADDR   CODE       LINE  SOURCE

                  02517 			;	configuraPic (); 						// Configuramos todos los puertos y PWM
000CF8 DB16       02518 	RCALL configuraPic
                  02519 			;
                  02520 			;
                  02521 			;	char p,h=0;
000CFA 0100       02522 	MOVLB 0
000CFC 6B6D       02523 	CLRF  h,1
                  02524 			;
                  02525 			;	OSCTUNE=0b.01.000000; //PLL enable 
000CFE 0E40       02526 	MOVLW 64
000D00 6E9B       02527 	MOVWF OSCTUNE,0
                  02528 			;	
                  02529 			;	RCON = 0b.01111111; //C18 pag 80 i 167  Causes del RESET i IPEN (priority Enabled o no)
000D02 0E7F       02530 	MOVLW 127
000D04 6ED0       02531 	MOVWF RCON,0
                  02532 			;	OSCCON    = 0b.0.111.0.0.00;
000D06 0E70       02533 	MOVLW 112
000D08 6ED3       02534 	MOVWF OSCCON,0
                  02535 			;
                  02536 			;	inicializar_lcd(); 
000D0A ECCA F001  02537 	CALL  inicializar_lcd
                  02538 			;	borrar_lcd();
000D0E EC51 F002  02539 	CALL  borrar_lcd
                  02540 			;//	retardo_100m();
                  02541 			;	RAM_LCD();
000D12 DEE5       02542 	RCALL RAM_LCD
                  02543 			;
                  02544 			;	borrar_lcd();
000D14 EC51 F002  02545 	CALL  borrar_lcd
                  02546 			;	escribir_posicion (1, 1);
000D18 0E01       02547 	MOVLW 1
000D1A 0100       02548 	MOVLB 0
000D1C 6F98       02549 	MOVWF linea,1
000D1E 0E01       02550 	MOVLW 1
000D20 EC05 F002  02551 	CALL  escribir_posicion
                  02552 			;	
                  02553 			;	for(p=0;p<19;p++ )enviar_literal(mensaje1[p]);
000D24 0100       02554 	MOVLB 0
000D26 6B6C       02555 	CLRF  p,1
000D28 0E13       02556 m173	MOVLW 19
000D2A 0100       02557 	MOVLB 0
000D2C 616C       02558 	CPFSLT p,1
000D2E D008       02559 	BRA   m174
000D30 0E5A       02560 	MOVLW 90
000D32 256C       02561 	ADDWF p,W,1
000D34 DB10       02562 	RCALL _const1
000D36 EC2B F001  02563 	CALL  enviar_literal
000D3A 0100       02564 	MOVLB 0
000D3C 2B6C       02565 	INCF  p,1,1
000D3E D7F4       02566 	BRA   m173
                  02567 			;	enviar_literal(LOGO_SC);
000D40 0E00       02568 m174	MOVLW 0
000D42 EC2B F001  02569 	CALL  enviar_literal
                  02570 			;
                  02571 			;
                  02572 			;	
                  02573 			;	T0CON   = 0b.01000.001; //(PIC 18F4550)	// Equivale junto con INTCON2 al OPTION_REG del 16F88x).							
                           	
000D46 0E41       02574 	MOVLW 65
000D48 6ED5       02575 	MOVWF T0CON,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 44

ADDR   CODE       LINE  SOURCE

                  02576 			;	INTCON2 = 0b.0000.0100; //(PIC 18F4550)	// Equivale junto con T0CON al OPTION_REG del 16F88x).	
000D4A 0E04       02577 	MOVLW 4
000D4C 6EF1       02578 	MOVWF INTCON2,0
                  02579 			;	TMR0IF = 0;   //T0IF = 0; (PIC 16F88x)	// Ponemos el flanco de interrupciones a cero (aun no se ha efectuado ninguna).
000D4E 94F2       02580 	BCF   0xFF2,TMR0IF,0
                  02581 			;   // w1   =   0;								// Reseteamos la variable √≠ndice de la tabla.
                  02582 			;	LATD.0 =0;            Vmax = 3; //2 el pwm maximo en 
000D50 908C       02583 	BCF   LATD,0,0
000D52 0E03       02584 	MOVLW 3
000D54 0100       02585 	MOVLB 0
000D56 6FB4       02586 	MOVWF Vmax,1
000D58 6BB5       02587 	CLRF  Vmax+1,1
                  02588 			;
                  02589 			;	
                  02590 			;	INTCON = 0b.0100.0000;				// Interrupciones globales (bit 7) e interrupci√≥n por Timer0 (bit 5) activadas.
000D5A 0E40       02591 	MOVLW 64
000D5C 6EF2       02592 	MOVWF INTCON,0
                  02593 			;
                  02594 			;	// COMEN√áO AL PAS PER 0, AMB 2 CICLES DE PWM A Ton=0 --> SON 100uS
                  02595 			;	T=0; ancho_pwm =0; bUdw=1;	// Comen√ßo carregant 0
000D5E 6BB7       02596 	CLRF  T,1
000D60 6BB2       02597 	CLRF  ancho_pwm,1
000D62 6BB3       02598 	CLRF  ancho_pwm+1,1
000D64 81B1       02599 	BSF   0xB1,bUdw,1
                  02600 			;	for (i = 1; i <= 6; i ++)  ancho_pwm = rl (ancho_pwm);
000D66 0E01       02601 	MOVLW 1
000D68 6FB8       02602 	MOVWF i,1
000D6A 0E07       02603 m175	MOVLW 7
000D6C 0100       02604 	MOVLB 0
000D6E 61B8       02605 	CPFSLT i,1
000D70 D004       02606 	BRA   m176
000D72 37B2       02607 	RLCF  ancho_pwm,1,1
000D74 37B3       02608 	RLCF  ancho_pwm+1,1,1
000D76 2BB8       02609 	INCF  i,1,1
000D78 D7F8       02610 	BRA   m175
                  02611 			;	CCPR1L    = ancho_pwm.high8;	CCP1CON.5 = ancho_pwm.7;	CCP1CON.4 = ancho_pwm.6; // PWM carregat a 0
000D7A C0B3 FFBE  02612 m176	MOVFF ancho_pwm+1,CCPR1L
000D7E 0100       02613 	MOVLB 0
000D80 AFB2       02614 	BTFSS ancho_pwm,7,1
000D82 9ABD       02615 	BCF   CCP1CON,5,0
000D84 BFB2       02616 	BTFSC ancho_pwm,7,1
000D86 8ABD       02617 	BSF   CCP1CON,5,0
000D88 ADB2       02618 	BTFSS ancho_pwm,6,1
000D8A 98BD       02619 	BCF   CCP1CON,4,0
000D8C BDB2       02620 	BTFSC ancho_pwm,6,1
000D8E 88BD       02621 	BSF   CCP1CON,4,0
                  02622 			;	TMR2IF=0;	TMR2IE=1; TMR2ON  = 1;
000D90 929E       02623 	BCF   0xF9E,TMR2IF,0
000D92 829D       02624 	BSF   0xF9D,TMR2IE,0
000D94 84CA       02625 	BSF   0xFCA,TMR2ON,0
                  02626 			;	T++; SENO = sen[T];		ancho_pwm = (uns16)SENO*Vmax; // PREPARO SEGUENT VALOR
000D96 2BB7       02627 	INCF  T,1,1
000D98 51B7       02628 	MOVF  T,W,1
000D9A DADD       02629 	RCALL _const1
000D9C 0100       02630 	MOVLB 0
000D9E 6FB6       02631 	MOVWF SENO,1
000DA0 51B6       02632 	MOVF  SENO,W,1
000DA2 03B4       02633 	MULWF Vmax,1
000DA4 CFF3 F0B2  02634 	MOVFF PRODL,ancho_pwm
000DA8 CFF4 F0B3  02635 	MOVFF PRODH,ancho_pwm+1
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 45

ADDR   CODE       LINE  SOURCE

000DAC 51B6       02636 	MOVF  SENO,W,1
000DAE 03B5       02637 	MULWF Vmax+1,1
000DB0 50F3       02638 	MOVF  PRODL,W,0
000DB2 27B3       02639 	ADDWF ancho_pwm+1,1,1
                  02640 			; //**************************************************************************************//
                  02641 			; //*******************  V A R I A B L E S   L O C A L E L E S ***************************//
                  02642 			; //**************************************************************************************//
                  02643 			;	estado=0; //empieza por estado 0
000DB4 6BB9       02644 	CLRF  estado,1
                  02645 			;	uns8 x;
                  02646 			;	uns16 vac[6],ac;
                  02647 			;	uns16 iac[6],ic,rf;
                  02648 			;	uns16 dif,difMediaAC,difMediaIC;
                  02649 			;	char vbat,o=0; //variables para guardar temporalmente las arrays
000DB6 6B94       02650 	CLRF  o,1
                  02651 			;	bit a,b,c,vuelta=0,flancoVAC,flancoIAC;
000DB8 9795       02652 	BCF   0x95,vuelta,1
                  02653 			;	
                  02654 			;	escribir_posicion (2, 1);
000DBA 0E02       02655 	MOVLW 2
000DBC 6F98       02656 	MOVWF linea,1
000DBE 0E01       02657 	MOVLW 1
000DC0 EC05 F002  02658 	CALL  escribir_posicion
                  02659 			; 	for(p=0;p<3;p++ )enviar_literal(mensaje2[p]);
000DC4 0100       02660 	MOVLB 0
000DC6 6B6C       02661 	CLRF  p,1
000DC8 0E03       02662 m177	MOVLW 3
000DCA 0100       02663 	MOVLB 0
000DCC 616C       02664 	CPFSLT p,1
000DCE D008       02665 	BRA   m178
000DD0 0E6D       02666 	MOVLW 109
000DD2 256C       02667 	ADDWF p,W,1
000DD4 DAC0       02668 	RCALL _const1
000DD6 EC2B F001  02669 	CALL  enviar_literal
000DDA 0100       02670 	MOVLB 0
000DDC 2B6C       02671 	INCF  p,1,1
000DDE D7F4       02672 	BRA   m177
                  02673 			; 	escribir_posicion (4, 1);
000DE0 0E04       02674 m178	MOVLW 4
000DE2 0100       02675 	MOVLB 0
000DE4 6F98       02676 	MOVWF linea,1
000DE6 0E01       02677 	MOVLW 1
000DE8 EC05 F002  02678 	CALL  escribir_posicion
                  02679 			; 	for(p=0;p<5;p++ )enviar_literal(mensaje3[p]);
000DEC 0100       02680 	MOVLB 0
000DEE 6B6C       02681 	CLRF  p,1
000DF0 0E05       02682 m179	MOVLW 5
000DF2 0100       02683 	MOVLB 0
000DF4 616C       02684 	CPFSLT p,1
000DF6 D008       02685 	BRA   m180
000DF8 0E70       02686 	MOVLW 112
000DFA 256C       02687 	ADDWF p,W,1
000DFC DAAC       02688 	RCALL _const1
000DFE EC2B F001  02689 	CALL  enviar_literal
000E02 0100       02690 	MOVLB 0
000E04 2B6C       02691 	INCF  p,1,1
000E06 D7F4       02692 	BRA   m179
                  02693 			; 	escribir_posicion (3, 1);
000E08 0E03       02694 m180	MOVLW 3
000E0A 0100       02695 	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 46

ADDR   CODE       LINE  SOURCE

000E0C 6F98       02696 	MOVWF linea,1
000E0E 0E01       02697 	MOVLW 1
000E10 EC05 F002  02698 	CALL  escribir_posicion
                  02699 			;	for(p=0;p<3;p++ )enviar_literal(mensaje4[p]);
000E14 0100       02700 	MOVLB 0
000E16 6B6C       02701 	CLRF  p,1
000E18 0E03       02702 m181	MOVLW 3
000E1A 0100       02703 	MOVLB 0
000E1C 616C       02704 	CPFSLT p,1
000E1E D008       02705 	BRA   m182
000E20 0E75       02706 	MOVLW 117
000E22 256C       02707 	ADDWF p,W,1
000E24 DA98       02708 	RCALL _const1
000E26 EC2B F001  02709 	CALL  enviar_literal
000E2A 0100       02710 	MOVLB 0
000E2C 2B6C       02711 	INCF  p,1,1
000E2E D7F4       02712 	BRA   m181
                  02713 			; 	GIE=1;
000E30 8EF2       02714 m182	BSF   0xFF2,GIE,0
                  02715 			;	ADCON1=0b.0000.0000;
000E32 6AC1       02716 	CLRF  ADCON1,0
                  02717 			;	ADCON2=0b.10.001.110;
000E34 0E8E       02718 	MOVLW 142
000E36 6EC0       02719 	MOVWF ADCON2,0
                  02720 			;
                  02721 			; //**************************************************************************************//
                  02722 			; //**************************  B U C L E   I N F I N I T O  *****************************//
                  02723 			; //**************************************************************************************//
                  02724 			;	while (1)       					
                  02725 			;	{
                  02726 			;		PORTC.1^=1;
000E38 7282       02727 m183	BTG   PORTC,1,0
                  02728 			;	
                  02729 			;		switch(estado){
000E3A 0100       02730 	MOVLB 0
000E3C 51B9       02731 	MOVF  estado,W,1
000E3E B4D8       02732 	BTFSC 0xFD8,Zero_,0
000E40 D010       02733 	BRA   m184
000E42 0A01       02734 	XORLW 1
000E44 B4D8       02735 	BTFSC 0xFD8,Zero_,0
000E46 D069       02736 	BRA   m191
000E48 0A03       02737 	XORLW 3
000E4A B4D8       02738 	BTFSC 0xFD8,Zero_,0
000E4C D0BB       02739 	BRA   m199
000E4E 0A01       02740 	XORLW 1
000E50 B4D8       02741 	BTFSC 0xFD8,Zero_,0
000E52 D112       02742 	BRA   m205
000E54 0A07       02743 	XORLW 7
000E56 B4D8       02744 	BTFSC 0xFD8,Zero_,0
000E58 D164       02745 	BRA   m213
000E5A 0A01       02746 	XORLW 1
000E5C B4D8       02747 	BTFSC 0xFD8,Zero_,0
000E5E D1D0       02748 	BRA   m222
000E60 D7EB       02749 	BRA   m183
                  02750 			;			case LECTURA_VAC:
                  02751 			;				x=0;
000E62 0100       02752 m184	MOVLB 0
000E64 6B6E       02753 	CLRF  x,1
                  02754 			;				while(LATD.0==1){   //vmax en LEO_VAC 18V 22k serie 8k2
000E66 A08C       02755 m185	BTFSS LATD,0,0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 47

ADDR   CODE       LINE  SOURCE

000E68 D050       02756 	BRA   m190
                  02757 			;					PORTC.4=1;
000E6A 8882       02758 	BSF   PORTC,4,0
                  02759 			;					if (((T == 6)&&((x==0)||(x==5))) || ((T == 12 )&&((x==1)||(x==4))) || ((T == 20)&&((x==2)||(x==3)))) {
000E6C 0E06       02760 	MOVLW 6
000E6E 0100       02761 	MOVLB 0
000E70 63B7       02762 	CPFSEQ T,1
000E72 D007       02763 	BRA   m186
000E74 536E       02764 	MOVF  x,1,1
000E76 B4D8       02765 	BTFSC 0xFD8,Zero_,0
000E78 D019       02766 	BRA   m188
000E7A 516E       02767 	MOVF  x,W,1
000E7C 0A05       02768 	XORLW 5
000E7E B4D8       02769 	BTFSC 0xFD8,Zero_,0
000E80 D015       02770 	BRA   m188
000E82 0E0C       02771 m186	MOVLW 12
000E84 0100       02772 	MOVLB 0
000E86 63B7       02773 	CPFSEQ T,1
000E88 D006       02774 	BRA   m187
000E8A 4D6E       02775 	DCFSNZ x,W,1
000E8C D00F       02776 	BRA   m188
000E8E 516E       02777 	MOVF  x,W,1
000E90 0A04       02778 	XORLW 4
000E92 B4D8       02779 	BTFSC 0xFD8,Zero_,0
000E94 D00B       02780 	BRA   m188
000E96 0E14       02781 m187	MOVLW 20
000E98 0100       02782 	MOVLB 0
000E9A 63B7       02783 	CPFSEQ T,1
000E9C D034       02784 	BRA   m189
000E9E 516E       02785 	MOVF  x,W,1
000EA0 0A02       02786 	XORLW 2
000EA2 B4D8       02787 	BTFSC 0xFD8,Zero_,0
000EA4 D003       02788 	BRA   m188
000EA6 0E03       02789 	MOVLW 3
000EA8 636E       02790 	CPFSEQ x,1
000EAA D02D       02791 	BRA   m189
                  02792 			;						PORTC.3=1;
000EAC 8682       02793 m188	BSF   PORTC,3,0
                  02794 			;						ac=medir(LEO_VAC,10);
000EAE 0100       02795 	MOVLB 0
000EB0 6B98       02796 	CLRF  canal,1
000EB2 0E0A       02797 	MOVLW 10
000EB4 DEAF       02798 	RCALL medir
000EB6 C09A F07B  02799 	MOVFF resultado,ac
000EBA C09B F07C  02800 	MOVFF resultado+1,ac+1
                  02801 			;						PORTC.3=0;	
000EBE 9682       02802 	BCF   PORTC,3,0
                  02803 			;						vac[x]=ac;
000EC0 6AEA       02804 	CLRF  FSR0+1,0
000EC2 90D8       02805 	BCF   0xFD8,Carry,0
000EC4 0100       02806 	MOVLB 0
000EC6 356E       02807 	RLCF  x,W,1
000EC8 0F6F       02808 	ADDLW 111
000ECA 6EE9       02809 	MOVWF FSR0,0
000ECC C07B FFEE  02810 	MOVFF ac,POSTINC0
000ED0 C07C FFEE  02811 	MOVFF ac+1,POSTINC0
                  02812 			;						x++;
000ED4 2B6E       02813 	INCF  x,1,1
                  02814 			;						
                  02815 			;						if ((T==20&&x==3)) {retardo_20u();retardo_20u();retardo_20u();retardo_20u();
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 48

ADDR   CODE       LINE  SOURCE

000ED6 0E14       02816 	MOVLW 20
000ED8 63B7       02817 	CPFSEQ T,1
000EDA D015       02818 	BRA   m189
000EDC 0E03       02819 	MOVLW 3
000EDE 636E       02820 	CPFSEQ x,1
000EE0 D012       02821 	BRA   m189
000EE2 EC7D F000  02822 	CALL  retardo_20u
000EE6 EC7D F000  02823 	CALL  retardo_20u
000EEA EC7D F000  02824 	CALL  retardo_20u
000EEE EC7D F000  02825 	CALL  retardo_20u
                  02826 			;							retardo_20u();retardo_20u();retardo_20u();retardo_20u();retardo_20u();}
000EF2 EC7D F000  02827 	CALL  retardo_20u
000EF6 EC7D F000  02828 	CALL  retardo_20u
000EFA EC7D F000  02829 	CALL  retardo_20u
000EFE EC7D F000  02830 	CALL  retardo_20u
000F02 EC7D F000  02831 	CALL  retardo_20u
                  02832 			;					}		
                  02833 			;					PORTC.4=0;		
000F06 9882       02834 m189	BCF   PORTC,4,0
                  02835 			;				}
000F08 D7AE       02836 	BRA   m185
                  02837 			;				estado = CALCULOS_VAC;
000F0A 0E01       02838 m190	MOVLW 1
000F0C 0100       02839 	MOVLB 0
000F0E 6FB9       02840 	MOVWF estado,1
                  02841 			;				if(x<=4) estado = LECTURA_VAC;
000F10 0E05       02842 	MOVLW 5
000F12 616E       02843 	CPFSLT x,1
000F14 D791       02844 	BRA   m183
000F16 6BB9       02845 	CLRF  estado,1
                  02846 			;			break;
000F18 D78F       02847 	BRA   m183
                  02848 			;
                  02849 			;			case CALCULOS_VAC:
                  02850 			;				difMediaAC=0;
000F1A 0100       02851 m191	MOVLB 0
000F1C 6B8F       02852 	CLRF  difMediaAC,1
000F1E 6B90       02853 	CLRF  difMediaAC+1,1
                  02854 			;				for(p=0;p<=5;p++){
000F20 6B6C       02855 	CLRF  p,1
000F22 0E06       02856 m192	MOVLW 6
000F24 0100       02857 	MOVLB 0
000F26 616C       02858 	CPFSLT p,1
000F28 D02F       02859 	BRA   m195
                  02860 			;					ac= vac[p];
000F2A 6AEA       02861 	CLRF  FSR0+1,0
000F2C 90D8       02862 	BCF   0xFD8,Carry,0
000F2E 356C       02863 	RLCF  p,W,1
000F30 0F6F       02864 	ADDLW 111
000F32 6EE9       02865 	MOVWF FSR0,0
000F34 CFEE F07B  02866 	MOVFF POSTINC0,ac
000F38 CFEE F07C  02867 	MOVFF POSTINC0,ac+1
                  02868 			;					rf= refAC[p];
000F3C 90D8       02869 	BCF   0xFD8,Carry,0
000F3E 356C       02870 	RLCF  p,W,1
000F40 0F78       02871 	ADDLW 120
000F42 DA09       02872 	RCALL _const1
000F44 0100       02873 	MOVLB 0
000F46 6F8B       02874 	MOVWF rf,1
000F48 000B       02875 	TBLRD +*
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 49

ADDR   CODE       LINE  SOURCE

000F4A 50F5       02876 	MOVF  TABLAT,W,0
000F4C 6F8C       02877 	MOVWF rf+1,1
                  02878 			;					if(ac>=rf){
000F4E 518B       02879 	MOVF  rf,W,1
000F50 5D7B       02880 	SUBWF ac,W,1
000F52 518C       02881 	MOVF  rf+1,W,1
000F54 597C       02882 	SUBWFB ac+1,W,1
000F56 A0D8       02883 	BTFSS 0xFD8,Carry,0
000F58 D008       02884 	BRA   m193
                  02885 			;						dif=ac-rf;
000F5A 518B       02886 	MOVF  rf,W,1
000F5C 5D7B       02887 	SUBWF ac,W,1
000F5E 6F8D       02888 	MOVWF dif,1
000F60 518C       02889 	MOVF  rf+1,W,1
000F62 597C       02890 	SUBWFB ac+1,W,1
000F64 6F8E       02891 	MOVWF dif+1,1
                  02892 			;						flancoVAC=POSITIVO;
000F66 8995       02893 	BSF   0x95,flancoVAC,1
                  02894 			;					}
                  02895 			;					else {
000F68 D008       02896 	BRA   m194
                  02897 			;						dif= rf-ac;
000F6A 0100       02898 m193	MOVLB 0
000F6C 517B       02899 	MOVF  ac,W,1
000F6E 5D8B       02900 	SUBWF rf,W,1
000F70 6F8D       02901 	MOVWF dif,1
000F72 517C       02902 	MOVF  ac+1,W,1
000F74 598C       02903 	SUBWFB rf+1,W,1
000F76 6F8E       02904 	MOVWF dif+1,1
                  02905 			;						flancoVAC=NEGATIVO;
000F78 9995       02906 	BCF   0x95,flancoVAC,1
                  02907 			;					}
                  02908 			;					difMediaAC+=dif; 
000F7A 0100       02909 m194	MOVLB 0
000F7C 518D       02910 	MOVF  dif,W,1
000F7E 278F       02911 	ADDWF difMediaAC,1,1
000F80 518E       02912 	MOVF  dif+1,W,1
000F82 2390       02913 	ADDWFC difMediaAC+1,1,1
                  02914 			;				}
000F84 2B6C       02915 	INCF  p,1,1
000F86 D7CD       02916 	BRA   m192
                  02917 			;				difMediaAC/=6;
000F88 0100       02918 m195	MOVLB 0
000F8A 518F       02919 	MOVF  difMediaAC,W,1
000F8C 6F99       02920 	MOVWF C41tmp,1
000F8E 5190       02921 	MOVF  difMediaAC+1,W,1
000F90 6F9A       02922 	MOVWF C41tmp+1,1
000F92 6B9B       02923 	CLRF  C42rem,1
000F94 0E10       02924 	MOVLW 16
000F96 6F98       02925 	MOVWF C40cnt,1
000F98 0100       02926 m196	MOVLB 0
000F9A 3799       02927 	RLCF  C41tmp,1,1
000F9C 379A       02928 	RLCF  C41tmp+1,1,1
000F9E 379B       02929 	RLCF  C42rem,1,1
000FA0 B0D8       02930 	BTFSC 0xFD8,Carry,0
000FA2 D004       02931 	BRA   m197
000FA4 0E06       02932 	MOVLW 6
000FA6 5D9B       02933 	SUBWF C42rem,W,1
000FA8 A0D8       02934 	BTFSS 0xFD8,Carry,0
000FAA D004       02935 	BRA   m198
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 50

ADDR   CODE       LINE  SOURCE

000FAC 0E06       02936 m197	MOVLW 6
000FAE 0100       02937 	MOVLB 0
000FB0 5F9B       02938 	SUBWF C42rem,1,1
000FB2 80D8       02939 	BSF   0xFD8,Carry,0
000FB4 0100       02940 m198	MOVLB 0
000FB6 378F       02941 	RLCF  difMediaAC,1,1
000FB8 3790       02942 	RLCF  difMediaAC+1,1,1
000FBA 2F98       02943 	DECFSZ C40cnt,1,1
000FBC D7ED       02944 	BRA   m196
                  02945 			;				
                  02946 			;				estado = LECTURA_IAC;
000FBE 0E02       02947 	MOVLW 2
000FC0 6FB9       02948 	MOVWF estado,1
                  02949 			;			break;
000FC2 D73A       02950 	BRA   m183
                  02951 			;
                  02952 			;			case LECTURA_IAC:
                  02953 			;				x=0;
000FC4 0100       02954 m199	MOVLB 0
000FC6 6B6E       02955 	CLRF  x,1
                  02956 			;				while(LATD.0==1){
000FC8 A08C       02957 m200	BTFSS LATD,0,0
000FCA D04D       02958 	BRA   m204
                  02959 			;					if (((T == 6)&&((x==0)||(x==5))) || ((T == 12 )&&((x==1)||(x==4))) || ((T == 20)&&((x==2)||(x==3)))) {
000FCC 0E06       02960 	MOVLW 6
000FCE 0100       02961 	MOVLB 0
000FD0 63B7       02962 	CPFSEQ T,1
000FD2 D007       02963 	BRA   m201
000FD4 536E       02964 	MOVF  x,1,1
000FD6 B4D8       02965 	BTFSC 0xFD8,Zero_,0
000FD8 D019       02966 	BRA   m203
000FDA 516E       02967 	MOVF  x,W,1
000FDC 0A05       02968 	XORLW 5
000FDE B4D8       02969 	BTFSC 0xFD8,Zero_,0
000FE0 D015       02970 	BRA   m203
000FE2 0E0C       02971 m201	MOVLW 12
000FE4 0100       02972 	MOVLB 0
000FE6 63B7       02973 	CPFSEQ T,1
000FE8 D006       02974 	BRA   m202
000FEA 4D6E       02975 	DCFSNZ x,W,1
000FEC D00F       02976 	BRA   m203
000FEE 516E       02977 	MOVF  x,W,1
000FF0 0A04       02978 	XORLW 4
000FF2 B4D8       02979 	BTFSC 0xFD8,Zero_,0
000FF4 D00B       02980 	BRA   m203
000FF6 0E14       02981 m202	MOVLW 20
000FF8 0100       02982 	MOVLB 0
000FFA 63B7       02983 	CPFSEQ T,1
000FFC D7E5       02984 	BRA   m200
000FFE 516E       02985 	MOVF  x,W,1
001000 0A02       02986 	XORLW 2
001002 B4D8       02987 	BTFSC 0xFD8,Zero_,0
001004 D003       02988 	BRA   m203
001006 0E03       02989 	MOVLW 3
001008 636E       02990 	CPFSEQ x,1
00100A D7DE       02991 	BRA   m200
                  02992 			;
                  02993 			;						ic=medir(LEO_IAC,10);	
00100C 0E02       02994 m203	MOVLW 2
00100E 0100       02995 	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 51

ADDR   CODE       LINE  SOURCE

001010 6F98       02996 	MOVWF canal,1
001012 0E0A       02997 	MOVLW 10
001014 DDFF       02998 	RCALL medir
001016 C09A F089  02999 	MOVFF resultado,ic
00101A C09B F08A  03000 	MOVFF resultado+1,ic+1
                  03001 			;						iac[x]=ic;
00101E 6AEA       03002 	CLRF  FSR0+1,0
001020 90D8       03003 	BCF   0xFD8,Carry,0
001022 0100       03004 	MOVLB 0
001024 356E       03005 	RLCF  x,W,1
001026 0F7D       03006 	ADDLW 125
001028 6EE9       03007 	MOVWF FSR0,0
00102A C089 FFEE  03008 	MOVFF ic,POSTINC0
00102E C08A FFEE  03009 	MOVFF ic+1,POSTINC0
                  03010 			;						x++;
001032 2B6E       03011 	INCF  x,1,1
                  03012 			;						
                  03013 			;						if ((T==20&&x==3)) {retardo_20u();retardo_20u();retardo_20u();retardo_20u();
001034 0E14       03014 	MOVLW 20
001036 63B7       03015 	CPFSEQ T,1
001038 D7C7       03016 	BRA   m200
00103A 0E03       03017 	MOVLW 3
00103C 636E       03018 	CPFSEQ x,1
00103E D7C4       03019 	BRA   m200
001040 EC7D F000  03020 	CALL  retardo_20u
001044 EC7D F000  03021 	CALL  retardo_20u
001048 EC7D F000  03022 	CALL  retardo_20u
00104C EC7D F000  03023 	CALL  retardo_20u
                  03024 			;							retardo_20u();retardo_20u();retardo_20u();retardo_20u();retardo_20u();}
001050 EC7D F000  03025 	CALL  retardo_20u
001054 EC7D F000  03026 	CALL  retardo_20u
001058 EC7D F000  03027 	CALL  retardo_20u
00105C EC7D F000  03028 	CALL  retardo_20u
001060 EC7D F000  03029 	CALL  retardo_20u
                  03030 			;					}		
                  03031 			;				}
001064 D7B1       03032 	BRA   m200
                  03033 			;				estado = CALCULOS_IAC;// cambiar para cacular corriente!!
001066 0E03       03034 m204	MOVLW 3
001068 0100       03035 	MOVLB 0
00106A 6FB9       03036 	MOVWF estado,1
                  03037 			;				if(x<=4) estado = LECTURA_IAC;
00106C 0E05       03038 	MOVLW 5
00106E 616E       03039 	CPFSLT x,1
001070 D6E3       03040 	BRA   m183
001072 0E02       03041 	MOVLW 2
001074 6FB9       03042 	MOVWF estado,1
                  03043 			;			break;
001076 D6E0       03044 	BRA   m183
                  03045 			;
                  03046 			;			case CALCULOS_IAC:
                  03047 			;				difMediaIC=0;
001078 0100       03048 m205	MOVLB 0
00107A 6B91       03049 	CLRF  difMediaIC,1
00107C 6B92       03050 	CLRF  difMediaIC+1,1
                  03051 			;				for(p=0;p<=5;p++){
00107E 6B6C       03052 	CLRF  p,1
001080 0E06       03053 m206	MOVLW 6
001082 0100       03054 	MOVLB 0
001084 616C       03055 	CPFSLT p,1
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 52

ADDR   CODE       LINE  SOURCE

001086 D02F       03056 	BRA   m209
                  03057 			;					ic= iac[p];
001088 6AEA       03058 	CLRF  FSR0+1,0
00108A 90D8       03059 	BCF   0xFD8,Carry,0
00108C 356C       03060 	RLCF  p,W,1
00108E 0F7D       03061 	ADDLW 125
001090 6EE9       03062 	MOVWF FSR0,0
001092 CFEE F089  03063 	MOVFF POSTINC0,ic
001096 CFEE F08A  03064 	MOVFF POSTINC0,ic+1
                  03065 			;					rf= refIC[p];
00109A 90D8       03066 	BCF   0xFD8,Carry,0
00109C 356C       03067 	RLCF  p,W,1
00109E 0F78       03068 	ADDLW 120
0010A0 D95A       03069 	RCALL _const1
0010A2 0100       03070 	MOVLB 0
0010A4 6F8B       03071 	MOVWF rf,1
0010A6 000B       03072 	TBLRD +*
0010A8 50F5       03073 	MOVF  TABLAT,W,0
0010AA 6F8C       03074 	MOVWF rf+1,1
                  03075 			;
                  03076 			;					if(ic>rf){
0010AC 5189       03077 	MOVF  ic,W,1
0010AE 5D8B       03078 	SUBWF rf,W,1
0010B0 518A       03079 	MOVF  ic+1,W,1
0010B2 598C       03080 	SUBWFB rf+1,W,1
0010B4 B0D8       03081 	BTFSC 0xFD8,Carry,0
0010B6 D008       03082 	BRA   m207
                  03083 			;						dif=ic-rf;
0010B8 518B       03084 	MOVF  rf,W,1
0010BA 5D89       03085 	SUBWF ic,W,1
0010BC 6F8D       03086 	MOVWF dif,1
0010BE 518C       03087 	MOVF  rf+1,W,1
0010C0 598A       03088 	SUBWFB ic+1,W,1
0010C2 6F8E       03089 	MOVWF dif+1,1
                  03090 			;						flancoIAC=POSITIVO;
0010C4 8B95       03091 	BSF   0x95,flancoIAC,1
                  03092 			;					}
                  03093 			;					else{
0010C6 D008       03094 	BRA   m208
                  03095 			;						dif = rf - ic;
0010C8 0100       03096 m207	MOVLB 0
0010CA 5189       03097 	MOVF  ic,W,1
0010CC 5D8B       03098 	SUBWF rf,W,1
0010CE 6F8D       03099 	MOVWF dif,1
0010D0 518A       03100 	MOVF  ic+1,W,1
0010D2 598C       03101 	SUBWFB rf+1,W,1
0010D4 6F8E       03102 	MOVWF dif+1,1
                  03103 			;						flancoIAC=NEGATIVO;
0010D6 9B95       03104 	BCF   0x95,flancoIAC,1
                  03105 			;					}
                  03106 			;					difMediaIC+=dif; 
0010D8 0100       03107 m208	MOVLB 0
0010DA 518D       03108 	MOVF  dif,W,1
0010DC 2791       03109 	ADDWF difMediaIC,1,1
0010DE 518E       03110 	MOVF  dif+1,W,1
0010E0 2392       03111 	ADDWFC difMediaIC+1,1,1
                  03112 			;				}
0010E2 2B6C       03113 	INCF  p,1,1
0010E4 D7CD       03114 	BRA   m206
                  03115 			;				difMediaIC/=6;
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 53

ADDR   CODE       LINE  SOURCE

0010E6 0100       03116 m209	MOVLB 0
0010E8 5191       03117 	MOVF  difMediaIC,W,1
0010EA 6F99       03118 	MOVWF C44tmp,1
0010EC 5192       03119 	MOVF  difMediaIC+1,W,1
0010EE 6F9A       03120 	MOVWF C44tmp+1,1
0010F0 6B9B       03121 	CLRF  C45rem,1
0010F2 0E10       03122 	MOVLW 16
0010F4 6F98       03123 	MOVWF C43cnt,1
0010F6 0100       03124 m210	MOVLB 0
0010F8 3799       03125 	RLCF  C44tmp,1,1
0010FA 379A       03126 	RLCF  C44tmp+1,1,1
0010FC 379B       03127 	RLCF  C45rem,1,1
0010FE B0D8       03128 	BTFSC 0xFD8,Carry,0
001100 D004       03129 	BRA   m211
001102 0E06       03130 	MOVLW 6
001104 5D9B       03131 	SUBWF C45rem,W,1
001106 A0D8       03132 	BTFSS 0xFD8,Carry,0
001108 D004       03133 	BRA   m212
00110A 0E06       03134 m211	MOVLW 6
00110C 0100       03135 	MOVLB 0
00110E 5F9B       03136 	SUBWF C45rem,1,1
001110 80D8       03137 	BSF   0xFD8,Carry,0
001112 0100       03138 m212	MOVLB 0
001114 3791       03139 	RLCF  difMediaIC,1,1
001116 3792       03140 	RLCF  difMediaIC+1,1,1
001118 2F98       03141 	DECFSZ C43cnt,1,1
00111A D7ED       03142 	BRA   m210
                  03143 			;				estado=ENVIO_LCD;// para version final quitar esto y descomentar el siguiente!!!!!!!
00111C 0E05       03144 	MOVLW 5
00111E 6FB9       03145 	MOVWF estado,1
                  03146 			;			//	estado = LECTURAS_VARIAS;
                  03147 			;			break;
001120 D68B       03148 	BRA   m183
                  03149 			;															///11,5v-->700
                  03150 			;			case LECTURAS_VARIAS:								///11,8v-->728
                  03151 			;				uns16 bat = medir(LEO_BAT,10);				 	///12,0v-->730
001122 0E01       03152 m213	MOVLW 1
001124 0100       03153 	MOVLB 0
001126 6F98       03154 	MOVWF canal,1
001128 0E0A       03155 	MOVLW 10
00112A DD74       03156 	RCALL medir
00112C C09A F096  03157 	MOVFF resultado,bat
001130 C09B F097  03158 	MOVFF resultado+1,bat+1
                  03159 			;				if (bat>785)				vbat=BATT_FULL;  	///12,3v-->763
001134 0E12       03160 	MOVLW 18
001136 0100       03161 	MOVLB 0
001138 5D96       03162 	SUBWF bat,W,1
00113A 0E03       03163 	MOVLW 3
00113C 5997       03164 	SUBWFB bat+1,W,1
00113E A0D8       03165 	BTFSS 0xFD8,Carry,0
001140 D003       03166 	BRA   m214
001142 0E01       03167 	MOVLW 1
001144 6F93       03168 	MOVWF vbat,1
                  03169 			;				else if((bat>762&&bat<775))	vbat=BATT_75;		///12,5v-->774
001146 D058       03170 	BRA   m221
001148 0EFB       03171 m214	MOVLW 251
00114A 0100       03172 	MOVLB 0
00114C 5D96       03173 	SUBWF bat,W,1
00114E 0E02       03174 	MOVLW 2
001150 5997       03175 	SUBWFB bat+1,W,1
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 54

ADDR   CODE       LINE  SOURCE

001152 A0D8       03176 	BTFSS 0xFD8,Carry,0
001154 D009       03177 	BRA   m215
001156 0E07       03178 	MOVLW 7
001158 5D96       03179 	SUBWF bat,W,1
00115A 0E03       03180 	MOVLW 3
00115C 5997       03181 	SUBWFB bat+1,W,1
00115E B0D8       03182 	BTFSC 0xFD8,Carry,0
001160 D003       03183 	BRA   m215
001162 0E02       03184 	MOVLW 2
001164 6F93       03185 	MOVWF vbat,1
                  03186 			;				else if((bat>742&&bat<760)) vbat=BATT_50;		///12,8v-->794
001166 D048       03187 	BRA   m221
001168 0EE7       03188 m215	MOVLW 231
00116A 0100       03189 	MOVLB 0
00116C 5D96       03190 	SUBWF bat,W,1
00116E 0E02       03191 	MOVLW 2
001170 5997       03192 	SUBWFB bat+1,W,1
001172 A0D8       03193 	BTFSS 0xFD8,Carry,0
001174 D009       03194 	BRA   m216
001176 0EF8       03195 	MOVLW 248
001178 5D96       03196 	SUBWF bat,W,1
00117A 0E02       03197 	MOVLW 2
00117C 5997       03198 	SUBWFB bat+1,W,1
00117E B0D8       03199 	BTFSC 0xFD8,Carry,0
001180 D003       03200 	BRA   m216
001182 0E03       03201 	MOVLW 3
001184 6F93       03202 	MOVWF vbat,1
                  03203 			;				else if((bat>722&&bat<740)) vbat=BATT_25;		///13,0v-->804
001186 D038       03204 	BRA   m221
001188 0ED3       03205 m216	MOVLW 211
00118A 0100       03206 	MOVLB 0
00118C 5D96       03207 	SUBWF bat,W,1
00118E 0E02       03208 	MOVLW 2
001190 5997       03209 	SUBWFB bat+1,W,1
001192 A0D8       03210 	BTFSS 0xFD8,Carry,0
001194 D009       03211 	BRA   m217
001196 0EE4       03212 	MOVLW 228
001198 5D96       03213 	SUBWF bat,W,1
00119A 0E02       03214 	MOVLW 2
00119C 5997       03215 	SUBWFB bat+1,W,1
00119E B0D8       03216 	BTFSC 0xFD8,Carry,0
0011A0 D003       03217 	BRA   m217
0011A2 0E04       03218 	MOVLW 4
0011A4 6F93       03219 	MOVWF vbat,1
                  03220 			;				else if((bat>710&&bat<720)) vbat=BATT_10;		///13,5v-->837
0011A6 D028       03221 	BRA   m221
0011A8 0EC7       03222 m217	MOVLW 199
0011AA 0100       03223 	MOVLB 0
0011AC 5D96       03224 	SUBWF bat,W,1
0011AE 0E02       03225 	MOVLW 2
0011B0 5997       03226 	SUBWFB bat+1,W,1
0011B2 A0D8       03227 	BTFSS 0xFD8,Carry,0
0011B4 D009       03228 	BRA   m218
0011B6 0ED0       03229 	MOVLW 208
0011B8 5D96       03230 	SUBWF bat,W,1
0011BA 0E02       03231 	MOVLW 2
0011BC 5997       03232 	SUBWFB bat+1,W,1
0011BE B0D8       03233 	BTFSC 0xFD8,Carry,0
0011C0 D003       03234 	BRA   m218
0011C2 0E05       03235 	MOVLW 5
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 55

ADDR   CODE       LINE  SOURCE

0011C4 6F93       03236 	MOVWF vbat,1
                  03237 			;				else if(bat<=708){								///14,0v-->872
0011C6 D018       03238 	BRA   m221
0011C8 0EC5       03239 m218	MOVLW 197
0011CA 0100       03240 	MOVLB 0
0011CC 5D96       03241 	SUBWF bat,W,1
0011CE 0E02       03242 	MOVLW 2
0011D0 5997       03243 	SUBWFB bat+1,W,1
0011D2 B0D8       03244 	BTFSC 0xFD8,Carry,0
0011D4 D011       03245 	BRA   m221
                  03246 			;					o++;										///14,5v-->895
0011D6 2B94       03247 	INCF  o,1,1
                  03248 			;					if(o<=5)vbat=BATT_LW;						///15,0v-->946
0011D8 0E06       03249 	MOVLW 6
0011DA 6194       03250 	CPFSLT o,1
0011DC D002       03251 	BRA   m219
0011DE 0E06       03252 	MOVLW 6
0011E0 6F93       03253 	MOVWF vbat,1
                  03254 			;					if(o>6)vbat=BATT_CLEAR;
0011E2 0E06       03255 m219	MOVLW 6
0011E4 0100       03256 	MOVLB 0
0011E6 6594       03257 	CPFSGT o,1
0011E8 D002       03258 	BRA   m220
0011EA 0E07       03259 	MOVLW 7
0011EC 6F93       03260 	MOVWF vbat,1
                  03261 			;					if(o==10)o=0;
0011EE 0E0A       03262 m220	MOVLW 10
0011F0 0100       03263 	MOVLB 0
0011F2 6394       03264 	CPFSEQ o,1
0011F4 D001       03265 	BRA   m221
0011F6 6B94       03266 	CLRF  o,1
                  03267 			;				} 			
                  03268 			;				estado= ENVIO_LCD;
0011F8 0E05       03269 m221	MOVLW 5
0011FA 0100       03270 	MOVLB 0
0011FC 6FB9       03271 	MOVWF estado,1
                  03272 			;			break;
0011FE D61C       03273 	BRA   m183
                  03274 			;
                  03275 			;			case ENVIO_LCD:
                  03276 			;
                  03277 			;				if(vuelta){
001200 0100       03278 m222	MOVLB 0
001202 A795       03279 	BTFSS 0x95,vuelta,1
001204 D047       03280 	BRA   m223
                  03281 			;					escribir_posicion(4,6);
001206 0E04       03282 	MOVLW 4
001208 6F98       03283 	MOVWF linea,1
00120A 0E06       03284 	MOVLW 6
00120C EC05 F002  03285 	CALL  escribir_posicion
                  03286 			;					enviar_cifra(Vmax);
001210 0100       03287 	MOVLB 0
001212 51B4       03288 	MOVF  Vmax,W,1
001214 EC7A F001  03289 	CALL  enviar_cifra
                  03290 			;					//Enviar_uns16(3,16,bat); // ya no hace falta...
                  03291 			;					Enviar_uns16(3,4,iac[h]);
001218 0E03       03292 	MOVLW 3
00121A 0100       03293 	MOVLB 0
00121C 6F98       03294 	MOVWF linea_4,1
00121E 0E04       03295 	MOVLW 4
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 56

ADDR   CODE       LINE  SOURCE

001220 6F99       03296 	MOVWF columna_3,1
001222 6AEA       03297 	CLRF  FSR0+1,0
001224 90D8       03298 	BCF   0xFD8,Carry,0
001226 356D       03299 	RLCF  h,W,1
001228 0F7D       03300 	ADDLW 125
00122A 6EE9       03301 	MOVWF FSR0,0
00122C CFEE F09A  03302 	MOVFF POSTINC0,dato_4
001230 CFEE F09B  03303 	MOVFF POSTINC0,dato_4+1
001234 ECC2 F003  03304 	CALL  Enviar_uns16
                  03305 			;					Enviar_uns16(3,9,iac[h+1]);
001238 0E03       03306 	MOVLW 3
00123A 0100       03307 	MOVLB 0
00123C 6F98       03308 	MOVWF linea_4,1
00123E 0E09       03309 	MOVLW 9
001240 6F99       03310 	MOVWF columna_3,1
001242 6AEA       03311 	CLRF  FSR0+1,0
001244 90D8       03312 	BCF   0xFD8,Carry,0
001246 356D       03313 	RLCF  h,W,1
001248 0F7F       03314 	ADDLW 127
00124A 6EE9       03315 	MOVWF FSR0,0
00124C CFEE F09A  03316 	MOVFF POSTINC0,dato_4
001250 CFEE F09B  03317 	MOVFF POSTINC0,dato_4+1
001254 ECC2 F003  03318 	CALL  Enviar_uns16
                  03319 			;					Enviar_uns16(3,14, difMediaIC);
001258 0E03       03320 	MOVLW 3
00125A 0100       03321 	MOVLB 0
00125C 6F98       03322 	MOVWF linea_4,1
00125E 0E0E       03323 	MOVLW 14
001260 6F99       03324 	MOVWF columna_3,1
001262 C091 F09A  03325 	MOVFF difMediaIC,dato_4
001266 C092 F09B  03326 	MOVFF difMediaIC+1,dato_4+1
00126A ECC2 F003  03327 	CALL  Enviar_uns16
                  03328 			;					escribir_posicion(3,20);
00126E 0E03       03329 	MOVLW 3
001270 0100       03330 	MOVLB 0
001272 6F98       03331 	MOVWF linea,1
001274 0E14       03332 	MOVLW 20
001276 EC05 F002  03333 	CALL  escribir_posicion
                  03334 			;					enviar_cifra(flancoIAC);
00127A 0E00       03335 	MOVLW 0
00127C 0100       03336 	MOVLB 0
00127E BB95       03337 	BTFSC 0x95,flancoIAC,1
001280 0E01       03338 	MOVLW 1
001282 EC7A F001  03339 	CALL  enviar_cifra
                  03340 			;					h++;
001286 0100       03341 	MOVLB 0
001288 2B6D       03342 	INCF  h,1,1
                  03343 			;					if(h==6)h=0;	
00128A 0E06       03344 	MOVLW 6
00128C 636D       03345 	CPFSEQ h,1
00128E D047       03346 	BRA   m224
001290 6B6D       03347 	CLRF  h,1
                  03348 			;					
                  03349 			;				}
                  03350 			;				else{
001292 D045       03351 	BRA   m224
                  03352 			;					
                  03353 			;					escribir_posicion(4,19);
001294 0E04       03354 m223	MOVLW 4
001296 0100       03355 	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 57

ADDR   CODE       LINE  SOURCE

001298 6F98       03356 	MOVWF linea,1
00129A 0E13       03357 	MOVLW 19
00129C EC05 F002  03358 	CALL  escribir_posicion
                  03359 			;					enviar_cifra(h);
0012A0 0100       03360 	MOVLB 0
0012A2 516D       03361 	MOVF  h,W,1
0012A4 EC7A F001  03362 	CALL  enviar_cifra
                  03363 			;					enviar_literal(vbat);
0012A8 0100       03364 	MOVLB 0
0012AA 5193       03365 	MOVF  vbat,W,1
0012AC EC2B F001  03366 	CALL  enviar_literal
                  03367 			;					Enviar_uns16(2,4,vac[h]);
0012B0 0E02       03368 	MOVLW 2
0012B2 0100       03369 	MOVLB 0
0012B4 6F98       03370 	MOVWF linea_4,1
0012B6 0E04       03371 	MOVLW 4
0012B8 6F99       03372 	MOVWF columna_3,1
0012BA 6AEA       03373 	CLRF  FSR0+1,0
0012BC 90D8       03374 	BCF   0xFD8,Carry,0
0012BE 356D       03375 	RLCF  h,W,1
0012C0 0F6F       03376 	ADDLW 111
0012C2 6EE9       03377 	MOVWF FSR0,0
0012C4 CFEE F09A  03378 	MOVFF POSTINC0,dato_4
0012C8 CFEE F09B  03379 	MOVFF POSTINC0,dato_4+1
0012CC ECC2 F003  03380 	CALL  Enviar_uns16
                  03381 			;					Enviar_uns16(2,9,vac[h+1]);
0012D0 0E02       03382 	MOVLW 2
0012D2 0100       03383 	MOVLB 0
0012D4 6F98       03384 	MOVWF linea_4,1
0012D6 0E09       03385 	MOVLW 9
0012D8 6F99       03386 	MOVWF columna_3,1
0012DA 6AEA       03387 	CLRF  FSR0+1,0
0012DC 90D8       03388 	BCF   0xFD8,Carry,0
0012DE 356D       03389 	RLCF  h,W,1
0012E0 0F71       03390 	ADDLW 113
0012E2 6EE9       03391 	MOVWF FSR0,0
0012E4 CFEE F09A  03392 	MOVFF POSTINC0,dato_4
0012E8 CFEE F09B  03393 	MOVFF POSTINC0,dato_4+1
0012EC ECC2 F003  03394 	CALL  Enviar_uns16
                  03395 			;					Enviar_uns16(2,14, difMediaAC);
0012F0 0E02       03396 	MOVLW 2
0012F2 0100       03397 	MOVLB 0
0012F4 6F98       03398 	MOVWF linea_4,1
0012F6 0E0E       03399 	MOVLW 14
0012F8 6F99       03400 	MOVWF columna_3,1
0012FA C08F F09A  03401 	MOVFF difMediaAC,dato_4
0012FE C090 F09B  03402 	MOVFF difMediaAC+1,dato_4+1
001302 ECC2 F003  03403 	CALL  Enviar_uns16
                  03404 			;					escribir_posicion(2,20);
001306 0E02       03405 	MOVLW 2
001308 0100       03406 	MOVLB 0
00130A 6F98       03407 	MOVWF linea,1
00130C 0E14       03408 	MOVLW 20
00130E EC05 F002  03409 	CALL  escribir_posicion
                  03410 			;					enviar_cifra(flancoVAC);
001312 0E00       03411 	MOVLW 0
001314 0100       03412 	MOVLB 0
001316 B995       03413 	BTFSC 0x95,flancoVAC,1
001318 0E01       03414 	MOVLW 1
00131A EC7A F001  03415 	CALL  enviar_cifra
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 58

ADDR   CODE       LINE  SOURCE

                  03416 			;				}
                  03417 			;				vuelta^=1;
00131E 0100       03418 m224	MOVLB 0
001320 7795       03419 	BTG   0x95,vuelta,1
                  03420 			;				estado = LECTURA_VAC;
001322 6BB9       03421 	CLRF  estado,1
                  03422 			;			break;
001324 D589       03423 	BRA   m183
                  03424 			;
                  03425 			;		}
                  03426 			;	}	
                  03427 			;}
                  03428 			;
                  03429 			;//=============================================================================================================
                  03430 			;			
                  03431 			;void configuraPic (void)					
                  03432 			;{
                  03433 configuraPic
                  03434 			;
                  03435 			;	OSCTUNE=0b.01.000000; //PLL enable 
001326 0E40       03436 	MOVLW 64
001328 6E9B       03437 	MOVWF OSCTUNE,0
                  03438 			;	
                  03439 			;	RCON = 0b.01111111; //C18 pag 80 i 167  Causes del RESET i IPEN (priority Enabled o no)
00132A 0E7F       03440 	MOVLW 127
00132C 6ED0       03441 	MOVWF RCON,0
                  03442 			;	OSCCON    = 0b.0.111.0.0.00;//C18 pag 53  //=============== ULL b3 abans 0 
00132E 0E70       03443 	MOVLW 112
001330 6ED3       03444 	MOVWF OSCCON,0
                  03445 			;	
                  03446 			;	ANSEL  = 0b.0000.0111;					// Solo el canal AN0 ser√° entrada anal√≥gica, el resto ser√°n entradas/salidas digitales.(PIC 8
                           16F87)
001332 0E07       03447 	MOVLW 7
001334 6E7E       03448 	MOVWF ANSEL,0
                  03449 			;	//ANSELH = 0b.0000.0000;					// Solo el canal AN0 ser√° entrada anal√≥gica, el resto ser√°n entradas/salidas digitale
                           s.(PIC 816F87)
                  03450 			;	
                  03451 			;	TRISA  = 0b.0000.1111;					// PORTA.0 es entrada, el resto son salidas.
001336 0E0F       03452 	MOVLW 15
001338 6E92       03453 	MOVWF TRISA,0
                  03454 			;	TRISB  = 0b.0000.0000;					// PORTB todo salidas.
00133A 6A93       03455 	CLRF  TRISB,0
                  03456 			;	TRISC  = 0b.0000.0000;					// PORTC todo salidas adem√°s de la salida del PWM.
00133C 6A94       03457 	CLRF  TRISC,0
                  03458 			;	TRISD  = 0b.0000.0000;					// PORTD todo salidas.				
00133E 6A95       03459 	CLRF  TRISD,0
                  03460 			;	LATB  = 0x00;							// Inicializa las salidas de PORTB a 0.
001340 6A8A       03461 	CLRF  LATB,0
                  03462 			;	PORTC  = 0x00;							// Inicializa las salidas de PORTC a 0.
001342 6A82       03463 	CLRF  PORTC,0
                  03464 			;	PORTD  = 0x00;							// Inicializa las salidas de PORTD a 0.
001344 6A83       03465 	CLRF  PORTD,0
                  03466 			;
                  03467 			;	//configuro ccp y pwm
                  03468 			;
                  03469 			;
                  03470 			;	T2CON   = 0b.0.0001.0.01;				// Prescaler P1 = 4, TMR2ON = 1 cuenta;	
001346 0E09       03471 	MOVLW 9
001348 6ECA       03472 	MOVWF T2CON,0
                  03473 			;	PR2     = 199;
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 59

ADDR   CODE       LINE  SOURCE

00134A 0EC7       03474 	MOVLW 199
00134C 6ECB       03475 	MOVWF PR2,0
                  03476 			;	CCP1CON = 0b.1000.1100;					// CCP1: modo PWM half bridge con bits de CCPR1L a 00 inicialmente.
00134E 0E8C       03477 	MOVLW 140
001350 6EBD       03478 	MOVWF CCP1CON,0
                  03479 			;
                  03480 			;	PWM1CON =0b.0000.0000; //tiempo muerto entre P1A y P1B
001352 6AB7       03481 	CLRF  PWM1CON,0
001354 0012       03482 	RETURN
                  03483 _const1
001356 0100       03484 	MOVLB 0
001358 6F69       03485 	MOVWF ci,1
00135A 5169       03486 	MOVF  ci,W,1
00135C 0F6E       03487 	ADDLW 110
00135E 6EF6       03488 	MOVWF TBLPTR,0
001360 0E13       03489 	MOVLW 19
001362 6AF7       03490 	CLRF  TBLPTR+1,0
001364 22F7       03491 	ADDWFC TBLPTR+1,1,0
001366 6AF8       03492 	CLRF  TBLPTR+2,0
001368 0008       03493 	TBLRD *
00136A 50F5       03494 	MOVF  TABLAT,W,0
00136C 0012       03495 	RETURN
00136E 0800       03496 	DW    0x800
001370 1710       03497 	DW    0x1710
001372 271F       03498 	DW    0x271F
001374 362F       03499 	DW    0x362F
001376 443D       03500 	DW    0x443D
001378 514B       03501 	DW    0x514B
00137A 5D57       03502 	DW    0x5D57
00137C 6762       03503 	DW    0x6762
00137E 706C       03504 	DW    0x706C
001380 7773       03505 	DW    0x7773
001382 7B79       03506 	DW    0x7B79
001384 7E7D       03507 	DW    0x7E7D
001386 807F       03508 	DW    0x807F
001388 100C       03509 	DW    0x100C
00138A 0408       03510 	DW    0x408
00138C 041B       03511 	DW    0x41B
00138E 0304       03512 	DW    0x304
001390 FFEE       03513 	DW    0xFFEE
001392 FFFF       03514 	DW    0xFFFF
001394 FFFF       03515 	DW    0xFFFF
001396 FFFF       03516 	DW    0xFFFF
001398 FFEE       03517 	DW    0xFFEE
00139A FFF1       03518 	DW    0xFFF1
00139C FFFF       03519 	DW    0xFFFF
00139E FFFF       03520 	DW    0xFFFF
0013A0 FFEE       03521 	DW    0xFFEE
0013A2 F1F1       03522 	DW    0xF1F1
0013A4 FFFF       03523 	DW    0xFFFF
0013A6 FFFF       03524 	DW    0xFFFF
0013A8 FFEE       03525 	DW    0xFFEE
0013AA F1F1       03526 	DW    0xF1F1
0013AC FFF1       03527 	DW    0xFFF1
0013AE FFFF       03528 	DW    0xFFFF
0013B0 FFEE       03529 	DW    0xFFEE
0013B2 F1F1       03530 	DW    0xF1F1
0013B4 F1F1       03531 	DW    0xF1F1
0013B6 FFFF       03532 	DW    0xFFFF
0013B8 FFEE       03533 	DW    0xFFEE
CC8E Version 1.4,   File: ondulador_migrado.c 13. May 2015  19:27   Page 60

ADDR   CODE       LINE  SOURCE

0013BA F1F1       03534 	DW    0xF1F1
0013BC F1F1       03535 	DW    0xF1F1
0013BE FFF1       03536 	DW    0xFFF1
0013C0 0000       03537 	DW    0x0
0013C2 0000       03538 	DW    0x0
0013C4 0000       03539 	DW    0x0
0013C6 0000       03540 	DW    0x0
0013C8 4E4F       03541 	DW    0x4E4F
0013CA 5544       03542 	DW    0x5544
0013CC 414C       03543 	DW    0x414C
0013CE 4F44       03544 	DW    0x4F44
0013D0 2052       03545 	DW    0x2052
0013D2 3035       03546 	DW    0x3035
0013D4 5A48       03547 	DW    0x5A48
0013D6 2020       03548 	DW    0x2020
0013D8 7962       03549 	DW    0x7962
0013DA 5620       03550 	DW    0x5620
0013DC 4341       03551 	DW    0x4341
0013DE 4D56       03552 	DW    0x4D56
0013E0 5841       03553 	DW    0x5841
0013E2 493A       03554 	DW    0x493A
0013E4 4341       03555 	DW    0x4341
0013E6 0258       03556 	DW    0x258
0013E8 02EE       03557 	DW    0x2EE
0013EA 0384       03558 	DW    0x384
0013EC 0384       03559 	DW    0x384
0013EE 02EE       03560 	DW    0x2EE
0013F0 0258       03561 	DW    0x258
                  03562 
                  03563 	END
                  03564 
                  03565 
                  03566 ; *** KEY INFO ***
                  03567 
                  03568 ; 0x000008  121 word(s)  1 % : highPriorityTimer_0
                  03569 ; 0x001356   78 word(s)  0 % : _const1
                  03570 ; 0x0000FA   10 word(s)  0 % : retardo_20u
                  03571 ; 0x00010E   19 word(s)  0 % : retardo_1m
                  03572 ; 0x000134   20 word(s)  0 % : retardo_50m
                  03573 ; 0x00015C   18 word(s)  0 % : retardo_100m
                  03574 ; 0x000180   20 word(s)  0 % : retardo_500m
                  03575 ; 0x001326   24 word(s)  0 % : configuraPic
                  03576 ; 0x0001A8   28 word(s)  0 % : envia_codigo_inicial
                  03577 ; 0x0001E0   59 word(s)  0 % : enviar_comando
                  03578 ; 0x000256   79 word(s)  0 % : enviar_literal
                  03579 ; 0x0002F4   80 word(s)  0 % : enviar_cifra
                  03580 ; 0x000394   59 word(s)  0 % : inicializar_lcd
                  03581 ; 0x00040A   39 word(s)  0 % : escribir_posicion
                  03582 ; 0x000458   37 word(s)  0 % : borrar_linea
                  03583 ; 0x0004A2    2 word(s)  0 % : borrar_lcd
                  03584 ; 0x0004A6  367 word(s)  4 % : Enviar_lcd
                  03585 ; 0x000784  429 word(s)  5 % : Enviar_uns16
                  03586 ; 0x000ADE  155 word(s)  1 % : RAM_LCD
                  03587 ; 0x000C14  113 word(s)  1 % : medir
                  03588 ; 0x000CF6  792 word(s)  9 % : main
                  03589 
                  03590 ; RAM usage: 90 bytes (81 local), 678 bytes free
                  03591 ; Maximum call level: 3 (+2 for interrupt)
                  03592 ; Total of 2551 code words (31 %)
