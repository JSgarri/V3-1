CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 1

ADDR   CODE       LINE  SOURCE

                  00001 
                  00002 ; CC8E Version 1.4, Copyright (c) B Knudsen Data
                  00003 ; C compiler for the PIC18 microcontrollers
                  00004 ; ************   1. May 2015  14:06  *************
                  00005 
                  00006 	processor  PIC18F44K20
                  00007 	radix  DEC
                  00008 
300000 08FF       00009 	__config 0x300001, 0x8
                  00010 	__config 0x300002, 0x1
300002 1601       00011 	__config 0x300003, 0x16
300004 88FF       00012 	__config 0x300005, 0x88
300006 FF81       00013 	__config 0x300006, 0x81
                  00014 
       0FF6       00015 TBLPTR      EQU   0xFF6
       0FF5       00016 TABLAT      EQU   0xFF5
       0FF4       00017 PRODH       EQU   0xFF4
       0FF3       00018 PRODL       EQU   0xFF3
       0FF2       00019 INTCON      EQU   0xFF2
       0FF1       00020 INTCON2     EQU   0xFF1
       0FEF       00021 INDF0       EQU   0xFEF
       0FE9       00022 FSR0        EQU   0xFE9
       0FE0       00023 BSR         EQU   0xFE0
       0FD8       00024 STATUS      EQU   0xFD8
       0000       00025 Carry       EQU   0
       0002       00026 Zero_       EQU   2
       0FD5       00027 T0CON       EQU   0xFD5
       0FD3       00028 OSCCON      EQU   0xFD3
       0FD0       00029 RCON        EQU   0xFD0
       0FCB       00030 PR2         EQU   0xFCB
       0FCA       00031 T2CON       EQU   0xFCA
       0FC4       00032 ADRESH      EQU   0xFC4
       0FC3       00033 ADRESL      EQU   0xFC3
       0FC2       00034 ADCON0      EQU   0xFC2
       0FC0       00035 ADCON2      EQU   0xFC0
       0FBE       00036 CCPR1L      EQU   0xFBE
       0FBD       00037 CCP1CON     EQU   0xFBD
       0FB7       00038 PWM1CON     EQU   0xFB7
       0F9B       00039 OSCTUNE     EQU   0xF9B
       0F95       00040 TRISD       EQU   0xF95
       0F94       00041 TRISC       EQU   0xF94
       0F93       00042 TRISB       EQU   0xF93
       0F92       00043 TRISA       EQU   0xF92
       0F8C       00044 LATD        EQU   0xF8C
       0F8B       00045 LATC        EQU   0xF8B
       0F8A       00046 LATB        EQU   0xF8A
       0F83       00047 PORTD       EQU   0xF83
       0F82       00048 PORTC       EQU   0xF82
       0F81       00049 PORTB       EQU   0xF81
       0002       00050 TMR0IF      EQU   2
       0007       00051 GIE         EQU   7
       0002       00052 TMR2ON      EQU   2
       0001       00053 GO          EQU   1
       0007       00054 ADFM        EQU   7
       0001       00055 TMR2IF      EQU   1
       0001       00056 TMR2IE      EQU   1
       0000       00057 bUdw        EQU   0
       0096       00058 ancho_pwm   EQU   0x96
       0098       00059 Vmax        EQU   0x98
       009A       00060 SENO        EQU   0x9A
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 2

ADDR   CODE       LINE  SOURCE

       009B       00061 T           EQU   0x9B
       009C       00062 i           EQU   0x9C
       009D       00063 estado      EQU   0x9D
       0060       00064 svrSTATUS   EQU   0x60
       0061       00065 svrBSR      EQU   0x61
       0062       00066 svrWREG     EQU   0x62
       0063       00067 sv_PRODL    EQU   0x63
       0064       00068 sv_PRODH    EQU   0x64
       0065       00069 sv_TBLPTR   EQU   0x65
       0068       00070 sv_TABLAT   EQU   0x68
       0091       00071 PDel0       EQU   0x91
       0091       00072 PDel0_2     EQU   0x91
       0092       00073 PDel1       EQU   0x92
       0F7F       00074 PDel0_3     EQU   0xF7F
       0F7F       00075 PDel1_2     EQU   0xF7F
       0F7F       00076 PDel2       EQU   0xF7F
       007B       00077 PDel0_4     EQU   0x7B
       007C       00078 PDel1_3     EQU   0x7C
       007D       00079 PDel2_2     EQU   0x7D
       0F7F       00080 PDel0_5     EQU   0xF7F
       0F7F       00081 PDel1_4     EQU   0xF7F
       0F7F       00082 PDel2_3     EQU   0xF7F
       007C       00083 codigo      EQU   0x7C
       0090       00084 comando     EQU   0x90
       007C       00085 dato        EQU   0x7C
       007D       00086 i_2         EQU   0x7D
       007C       00087 dato_2      EQU   0x7C
       007D       00088 i_3         EQU   0x7D
       007B       00089 i_4         EQU   0x7B
       007C       00090 linea       EQU   0x7C
       007D       00091 columna     EQU   0x7D
       0F7F       00092 linea_2     EQU   0xF7F
       0F7F       00093 i_5         EQU   0xF7F
       0F7F       00094 linea_3     EQU   0xF7F
       0F7F       00095 columna_2   EQU   0xF7F
       0F7F       00096 dato_3      EQU   0xF7F
       0000       00097 bd          EQU   0
       0000       00098 dp          EQU   0
       0000       00099 xi          EQU   0
       0000       00100 ndp         EQU   0
       0F7F       00101 num         EQU   0xF7F
       0F7F       00102 u_milers    EQU   0xF7F
       0F7F       00103 cent        EQU   0xF7F
       0F7F       00104 dec         EQU   0xF7F
       0F7F       00105 unid        EQU   0xF7F
       0F7F       00106 resto1      EQU   0xF7F
       0F7F       00107 i_6         EQU   0xF7F
       0F7F       00108 xx          EQU   0xF7F
       0F7F       00109 dat         EQU   0xF7F
       0F7F       00110 xy          EQU   0xF7F
       0F7F       00111 C3cnt       EQU   0xF7F
       0F7F       00112 C4tmp       EQU   0xF7F
       0F7F       00113 C5rem       EQU   0xF7F
       0F7F       00114 C6cnt       EQU   0xF7F
       0F7F       00115 C7tmp       EQU   0xF7F
       0F7F       00116 C8cnt       EQU   0xF7F
       0F7F       00117 C9tmp       EQU   0xF7F
       0F7F       00118 C10rem      EQU   0xF7F
       0F7F       00119 C11cnt      EQU   0xF7F
       0F7F       00120 C12tmp      EQU   0xF7F
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 3

ADDR   CODE       LINE  SOURCE

       0F7F       00121 C13cnt      EQU   0xF7F
       0F7F       00122 C14tmp      EQU   0xF7F
       0F7F       00123 C15rem      EQU   0xF7F
       0F7F       00124 C16cnt      EQU   0xF7F
       0F7F       00125 C17tmp      EQU   0xF7F
       007C       00126 linea_4     EQU   0x7C
       007D       00127 columna_3   EQU   0x7D
       007E       00128 dato_4      EQU   0x7E
       0080       00129 num_2       EQU   0x80
       0082       00130 u_milers_2  EQU   0x82
       0084       00131 cent_2      EQU   0x84
       0086       00132 d_milers    EQU   0x86
       0088       00133 dec_2       EQU   0x88
       0089       00134 unid_2      EQU   0x89
       008A       00135 resto1_2    EQU   0x8A
       008B       00136 i_7         EQU   0x8B
       008C       00137 xx_2        EQU   0x8C
       008E       00138 dat_2       EQU   0x8E
       0090       00139 C18cnt      EQU   0x90
       0091       00140 C19tmp      EQU   0x91
       0093       00141 C20rem      EQU   0x93
       0090       00142 C21cnt      EQU   0x90
       0091       00143 C22tmp      EQU   0x91
       0090       00144 C23cnt      EQU   0x90
       0091       00145 C24tmp      EQU   0x91
       0093       00146 C25rem      EQU   0x93
       0090       00147 C26cnt      EQU   0x90
       0091       00148 C27tmp      EQU   0x91
       0090       00149 C28cnt      EQU   0x90
       0091       00150 C29tmp      EQU   0x91
       0093       00151 C30rem      EQU   0x93
       0090       00152 C31cnt      EQU   0x90
       0091       00153 C32tmp      EQU   0x91
       0090       00154 C33cnt      EQU   0x90
       0091       00155 C34tmp      EQU   0x91
       0092       00156 C35rem      EQU   0x92
       0090       00157 C36cnt      EQU   0x90
       0091       00158 C37tmp      EQU   0x91
       007B       00159 i_8         EQU   0x7B
       007C       00160 canal       EQU   0x7C
       007D       00161 bits        EQU   0x7D
       007E       00162 resultado   EQU   0x7E
       006C       00163 x           EQU   0x6C
       006D       00164 vac         EQU   0x6D
       0073       00165 ac          EQU   0x73
       0074       00166 rf          EQU   0x74
       0075       00167 dif         EQU   0x75
       0076       00168 vbat        EQU   0x76
       0077       00169 o           EQU   0x77
       0003       00170 vuelta      EQU   3
       0078       00171 p           EQU   0x78
       0079       00172 h           EQU   0x79
       007B       00173 bat         EQU   0x7B
       0069       00174 ci          EQU   0x69
                  00175 
000000 EF78 F006  00176 	GOTO main
                  00177 
                  00178   ; FILE ondulador_migrado.c
                  00179 			;/*
                  00180 			; * Autor: J_Sanchez
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 4

ADDR   CODE       LINE  SOURCE

                  00181 			; * 
                  00182 			; * Fecha: 31-03-2015
                  00183 			; * Descripcion:Primera prueba con el 18F44K20 para el proyecto del ondulador v2.0
                  00184 			; *  Configuracion: 
                  00185 			; *		Modelo: 18F44K20
                  00186 			; *		Oscilador: Crystal 64Mhz
                  00187 			; *		Puente en H con PWM mejorado
                  00188 			; */
                  00189 			;
                  00190 			; //**************************************************************************************//
                  00191 			; //******************* C O N F I G  U R A C I O N    I N I C I A L  *********************//
                  00192 			; //**************************************************************************************//
                  00193 			; 
                  00194 			; #pragma chip PIC18F44K20
                  00195 			; #pragma config[1] = 0b.0000.1000//pagina 301 datasheet
                  00196 			; #pragma config[2] = 0b.0000.0001
                  00197 			; #pragma config[3] = 0b.0001.0110
                  00198 			; #pragma config[5] = 0b.1000.1000//Mirar CCP2 MUX bit 0 
                  00199 			; 				//-->1 = CCP2 input/output is multiplexed with RC1
                  00200 			;				//   -->0 = CCP2 input/output is multiplexed with RB3 
                  00201 			; #pragma config[6] = 0b.1000.0001
                  00202 			; // resto configs son para la proteccion del programa 
                  00203 			;
                  00204 			; #pragma sharedAllocation//evita error en las interrupciones
                  00205 			;
                  00206 			; //**************************************************************************************//
                  00207 			; //********************************  V A R I A B L E S  *********************************//
                  00208 			; //**************************************************************************************//
                  00209 			;
                  00210 			;#define LECTURA_VAC  0
                  00211 			;#define CALCULOS_VAC 1
                  00212 			;#define LECTURA_IAC  2
                  00213 			;#define CALCULOS_IAC 3
                  00214 			;#define LECTURAS_VARIAS 4
                  00215 			;#define ENVIO_LCD    5
                  00216 			;
                  00217 			;#define LOGO_SC		 0
                  00218 			;#define BATT_FULL	 1
                  00219 			;#define BATT_75		 2
                  00220 			;#define BATT_50		 3
                  00221 			;#define BATT_25		 4
                  00222 			;#define BATT_10		 5
                  00223 			;#define BATT_LW		 6 
                  00224 			;#define BATT_CLEAR	 7
                  00225 			;
                  00226 			;
                  00227 			;#pragma rambank 0
                  00228 			;bit bUdw; // a 1 puja en la taula (incrementa) , a 0 decrementa
                  00229 			;uns16 ancho_pwm;
                  00230 			;uns16 Vmax;
                  00231 			;uns8 SENO;
                  00232 			;char T,i,estado; // Index de la taula
                  00233 			;
                  00234 			;
                  00235 			;static const char sen [26] = 			
                  00236 			;{0,8,16,23,31,39,47,54,61,68,75,81,87,93,98,103,108,112,115,119,121,123,125,126,127,128};
                  00237 			;// PWM maximo 799 para ser 100% 
                  00238 			;
                  00239 			;//=======================================================================
                  00240 			;#include "int18XXX.h"	 // Cap√ßalera de interrupcions.
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 5

ADDR   CODE       LINE  SOURCE

                  00241 			;
                  00242 			;#pragma origin 0x08	//#pragma origin 0x18	(PIC 16F88x)
       0000       00243 	ORG 0x0008
                  00244 			;
                  00245 			;interrupt highPriorityTimer_0 (void)		// Interrupci√≥n por desbordamiento de Timer 0.			
                  00246 			;{
                  00247 highPriorityTimer_0
                  00248 			;	int_save_registers 
000008 CFD8 F060  00249 	MOVFF STATUS,svrSTATUS
00000C CFE0 F061  00250 	MOVFF BSR,svrBSR
000010 0100       00251 	MOVLB 0
000012 6F62       00252 	MOVWF svrWREG,1
                  00253 			;
                  00254 			;	// save remaining registers on demand (error/warning)
                  00255 			;	//uns16 sv_FSR0 = FSR0;
                  00256 			;	//uns16 sv_FSR1 = FSR1;
                  00257 			;	//uns16 sv_FSR2 = FSR2;
                  00258 			;	//uns8 sv_PCLATH = PCLATH;
                  00259 			;	//uns8 sv_PCLATU = PCLATU;
                  00260 			;	uns8 sv_PRODL = PRODL;
000014 CFF3 F063  00261 	MOVFF PRODL,sv_PRODL
                  00262 			;	uns8 sv_PRODH = PRODH;
000018 CFF4 F064  00263 	MOVFF PRODH,sv_PRODH
                  00264 			;	uns24 sv_TBLPTR = TBLPTR;
00001C CFF6 F065  00265 	MOVFF TBLPTR,sv_TBLPTR
000020 CFF7 F066  00266 	MOVFF TBLPTR+1,sv_TBLPTR+1
000024 CFF8 F067  00267 	MOVFF TBLPTR+2,sv_TBLPTR+2
                  00268 			;	uns8 sv_TABLAT = TABLAT;
000028 CFF5 F068  00269 	MOVFF TABLAT,sv_TABLAT
                  00270 			;
                  00271 			;
                  00272 			;	     				// Guarda W, STATUS y PCLATH.
                  00273 			;	LATC.0=!LATC.0;
00002C 708B       00274 	BTG   LATC,0,0
                  00275 			;	if(TMR2IF) 	//{ LATD.0= !LATD.0; TMR2IF=0; }
00002E A29E       00276 	BTFSS 0xF9E,TMR2IF,0
000030 D051       00277 	BRA   m008
                  00278 			;	{ 
                  00279 			;		T2CON = 0b.0.0011.1.01; TMR2IF =0; //TMR2ON =1; // PostScaler per 4
000032 0E1D       00280 	MOVLW 29
000034 6ECA       00281 	MOVWF T2CON,0
000036 929E       00282 	BCF   0xF9E,TMR2IF,0
                  00283 			;		for (i = 1; i <= 6; i ++)  ancho_pwm = rl (ancho_pwm);
000038 0E01       00284 	MOVLW 1
00003A 6F9C       00285 	MOVWF i,1
00003C 0E07       00286 m001	MOVLW 7
00003E 0100       00287 	MOVLB 0
000040 619C       00288 	CPFSLT i,1
000042 D004       00289 	BRA   m002
000044 3796       00290 	RLCF  ancho_pwm,1,1
000046 3797       00291 	RLCF  ancho_pwm+1,1,1
000048 2B9C       00292 	INCF  i,1,1
00004A D7F8       00293 	BRA   m001
                  00294 			;		CCPR1L    = ancho_pwm.high8;	CCP1CON.5 = ancho_pwm.7;	CCP1CON.4 = ancho_pwm.6;
00004C C097 FFBE  00295 m002	MOVFF ancho_pwm+1,CCPR1L
000050 0100       00296 	MOVLB 0
000052 AF96       00297 	BTFSS ancho_pwm,7,1
000054 9ABD       00298 	BCF   CCP1CON,5,0
000056 BF96       00299 	BTFSC ancho_pwm,7,1
000058 8ABD       00300 	BSF   CCP1CON,5,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 6

ADDR   CODE       LINE  SOURCE

00005A AD96       00301 	BTFSS ancho_pwm,6,1
00005C 98BD       00302 	BCF   CCP1CON,4,0
00005E BD96       00303 	BTFSC ancho_pwm,6,1
000060 88BD       00304 	BSF   CCP1CON,4,0
                  00305 			;				  
                  00306 			;		if(bUdw) 	{ if(T>=25)  bUdw=0;      
000062 A195       00307 	BTFSS 0x95,bUdw,1
000064 D007       00308 	BRA   m004
000066 0E18       00309 	MOVLW 24
000068 659B       00310 	CPFSGT T,1
00006A D002       00311 	BRA   m003
00006C 9195       00312 	BCF   0x95,bUdw,1
                  00313 			;				      else        T++;
00006E D002       00314 	BRA   m004
000070 0100       00315 m003	MOVLB 0
000072 2B9B       00316 	INCF  T,1,1
                  00317 			;					} 
                  00318 			;		if(!bUdw)   T--;                       
000074 0100       00319 m004	MOVLB 0
000076 A195       00320 	BTFSS 0x95,bUdw,1
000078 079B       00321 	DECF  T,1,1
                  00322 			;		if(T==0) 
00007A 0100       00323 	MOVLB 0
00007C 539B       00324 	MOVF  T,1,1
00007E A4D8       00325 	BTFSS 0xFD8,Zero_,0
000080 D019       00326 	BRA   m007
                  00327 			;		{  	while(!TMR2IF); TMR2IF =0; // ESPERO QUE ACABI  T=1
000082 A29E       00328 m005	BTFSS 0xF9E,TMR2IF,0
000084 D7FE       00329 	BRA   m005
000086 929E       00330 	BCF   0xF9E,TMR2IF,0
                  00331 			;			T2CON = 0b.0.0001.1.01;  	CCPR1L = 0;		CCP1CON.5 = 0;	CCP1CON.4 = 0;	 
000088 0E0D       00332 	MOVLW 13
00008A 6ECA       00333 	MOVWF T2CON,0
00008C 6ABE       00334 	CLRF  CCPR1L,0
00008E 9ABD       00335 	BCF   CCP1CON,5,0
000090 98BD       00336 	BCF   CCP1CON,4,0
                  00337 			;			// Posrescaler a 2
                  00338 			;			//while(!TMR2IF); // espero que acabi el T=0
                  00339 			;			//	TMR2IF =0; // Postscaler a 2
                  00340 			;			while(!TMR2IF); // espeor que acabi la 1era meitat del T=0, postsclaer =2
000092 A29E       00341 m006	BTFSS 0xF9E,TMR2IF,0
000094 D7FE       00342 	BRA   m006
                  00343 			;			TMR2IF =0; 	T2CON = 0b.0.0000.1.01;  	CCPR1L = 0;		CCP1CON.5 = 0;	CCP1CON.4 = 0;
000096 929E       00344 	BCF   0xF9E,TMR2IF,0
000098 0E05       00345 	MOVLW 5
00009A 6ECA       00346 	MOVWF T2CON,0
00009C 6ABE       00347 	CLRF  CCPR1L,0
00009E 9ABD       00348 	BCF   CCP1CON,5,0
0000A0 98BD       00349 	BCF   CCP1CON,4,0
                  00350 			;			LATD.0= !LATD.0;	bUdw=1;  T=1; if(estado==ENVIO_LCD) estado = LECTURA_VAC;  // el deixo sortir
0000A2 708C       00351 	BTG   LATD,0,0
0000A4 0100       00352 	MOVLB 0
0000A6 8195       00353 	BSF   0x95,bUdw,1
0000A8 0E01       00354 	MOVLW 1
0000AA 6F9B       00355 	MOVWF T,1
0000AC 0E05       00356 	MOVLW 5
0000AE 639D       00357 	CPFSEQ estado,1
0000B0 D001       00358 	BRA   m007
0000B2 6B9D       00359 	CLRF  estado,1
                  00360 			;		}			  
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 7

ADDR   CODE       LINE  SOURCE

                  00361 			;							
                  00362 			;		SENO = sen[T];			
0000B4 0100       00363 m007	MOVLB 0
0000B6 519B       00364 	MOVF  T,W,1
0000B8 EC6D F008  00365 	CALL  _const1
0000BC 0100       00366 	MOVLB 0
0000BE 6F9A       00367 	MOVWF SENO,1
                  00368 			;		ancho_pwm = (uns16)SENO*Vmax;
0000C0 519A       00369 	MOVF  SENO,W,1
0000C2 0398       00370 	MULWF Vmax,1
0000C4 CFF3 F096  00371 	MOVFF PRODL,ancho_pwm
0000C8 CFF4 F097  00372 	MOVFF PRODH,ancho_pwm+1
0000CC 519A       00373 	MOVF  SENO,W,1
0000CE 0399       00374 	MULWF Vmax+1,1
0000D0 50F3       00375 	MOVF  PRODL,W,0
0000D2 2797       00376 	ADDWF ancho_pwm+1,1,1
                  00377 			;				  			  
                  00378 			;	} 
                  00379 			;			
                  00380 			;	// restore registers that are saved
                  00381 			;	//FSR0 = sv_FSR0;
                  00382 			;	//FSR1 = sv_FSR1;
                  00383 			;	//FSR2 = sv_FSR2;
                  00384 			;	//PCLATH = sv_PCLATH;
                  00385 			;	//PCLATU = sv_PCLATU;
                  00386 			;	PRODL = sv_PRODL;
0000D4 C063 FFF3  00387 m008	MOVFF sv_PRODL,PRODL
                  00388 			;	PRODH = sv_PRODH;
0000D8 C064 FFF4  00389 	MOVFF sv_PRODH,PRODH
                  00390 			;	TBLPTR = sv_TBLPTR;
0000DC C065 FFF6  00391 	MOVFF sv_TBLPTR,TBLPTR
0000E0 C066 FFF7  00392 	MOVFF sv_TBLPTR+1,TBLPTR+1
0000E4 C067 FFF8  00393 	MOVFF sv_TBLPTR+2,TBLPTR+2
                  00394 			;	TABLAT = sv_TABLAT;
0000E8 C068 FFF5  00395 	MOVFF sv_TABLAT,TABLAT
                  00396 			;
                  00397 			;    int_restore_registers 					// Devuelve W, STATUS y PCLATH.
0000EC 0100       00398 	MOVLB 0
0000EE 5162       00399 	MOVF  svrWREG,W,1
0000F0 C061 FFE0  00400 	MOVFF svrBSR,BSR
0000F4 C060 FFD8  00401 	MOVFF svrSTATUS,STATUS
                  00402 			;}
0000F8 0010       00403 	RETFIE
                  00404 
                  00405   ; FILE Temporiz_64Mhz.h
                  00406 			;void retardo_20u(void){
                  00407 retardo_20u
                  00408 			;	
                  00409 			;		char PDel0;
                  00410 			;		#asm
                  00411 			;		;-------------------------------------------------------------
                  00412 			;		DEMORA  movlw     .78       ; 1 set numero de repeticion 
0000FA 0E4E       00413 	MOVLW 78
                  00414 			;		        movwf     PDel0     ; 1 |
0000FC 6F91       00415 	MOVWF PDel0,1
                  00416 			;		PLoop0  clrwdt              ; 1 clear watchdog
0000FE 0004       00417 m009	CLRWDT
                  00418 			;		        decfsz    PDel0, 1  ; 1 + (1) es el tiempo 0  ?
000100 2F91       00419 	DECFSZ PDel0,1,1
                  00420 			;		        goto      PLoop0    ; 2 no, loop
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 8

ADDR   CODE       LINE  SOURCE

000102 EF7F F000  00421 	GOTO  m009
                  00422 			;		PDelL1  goto PDelL2         ; 2 ciclos delay
000106 EF85 F000  00423 	GOTO  m010
                  00424 			;		PDelL2  clrwdt              ; 1 ciclo delay
00010A 0004       00425 m010	CLRWDT
                  00426 			;		        return              ; 2+2 Fin.
00010C 0012       00427 	RETURN
                  00428 			;		;-------------------------------------------------------------
                  00429 			;		#endasm
                  00430 			;	
                  00431 			;}
                  00432 			;void retardo_1m(void){
                  00433 retardo_1m
                  00434 			;	char PDel0,PDel1;
                  00435 			;	#asm
                  00436 			;	;-------------------------------------------------------------
                  00437 			;	DEMORA  movlw     .15       ; 1 set numero de repeticion  (B)
00010E 0E0F       00438 	MOVLW 15
                  00439 			;	        movwf     PDel0     ; 1 |
000110 6F91       00440 	MOVWF PDel0_2,1
                  00441 			;	PLoop1  movlw     .177      ; 1 set numero de repeticion  (A)
000112 0EB1       00442 m011	MOVLW 177
                  00443 			;	        movwf     PDel1     ; 1 |
000114 6F92       00444 	MOVWF PDel1,1
                  00445 			;	PLoop2  clrwdt              ; 1 clear watchdog
000116 0004       00446 m012	CLRWDT
                  00447 			;	PDelL1  goto PDelL2         ; 2 ciclos delay
000118 EF8E F000  00448 	GOTO  m013
                  00449 			;	PDelL2  
                  00450 			;	        decfsz    PDel1, 1  ; 1 + (1) es el tiempo 0  ? (A)
00011C 2F92       00451 m013	DECFSZ PDel1,1,1
                  00452 			;	        goto      PLoop2    ; 2 no, loop
00011E EF8B F000  00453 	GOTO  m012
                  00454 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (B)
000122 2F91       00455 	DECFSZ PDel0_2,1,1
                  00456 			;	        goto      PLoop1    ; 2 no, loop
000124 EF89 F000  00457 	GOTO  m011
                  00458 			;	PDelL3  goto PDelL4         ; 2 ciclos delay
000128 EF96 F000  00459 	GOTO  m014
                  00460 			;	PDelL4  goto PDelL5         ; 2 ciclos delay
00012C EF98 F000  00461 m014	GOTO  m015
                  00462 			;	PDelL5  clrwdt              ; 1 ciclo delay
000130 0004       00463 m015	CLRWDT
                  00464 			;	        return              ; 2+2 Fin.
000132 0012       00465 	RETURN
                  00466 			;	;-------------------------------------------------------------
                  00467 			;	#endasm
                  00468 			;}
                  00469 			;void retardo_50m(void){
                  00470 retardo_50m
                  00471 			;	char PDel0,PDel1,PDel2;
                  00472 			;	#asm
                  00473 			;	;-------------------------------------------------------------
                  00474 			;	DEMORA  movlw     .18       ; 1 set numero de repeticion  (C)
000134 0E12       00475 	MOVLW 18
                  00476 			;	        movwf     PDel0     ; 1 |
000136 6E7F       00477 	MOVWF PDel0_3,0
                  00478 			;	PLoop0  movlw     .55       ; 1 set numero de repeticion  (B)
000138 0E37       00479 m016	MOVLW 55
                  00480 			;	        movwf     PDel1     ; 1 |
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 9

ADDR   CODE       LINE  SOURCE

00013A 6E7F       00481 	MOVWF PDel1_2,0
                  00482 			;	PLoop1  movlw     .201      ; 1 set numero de repeticion  (A)
00013C 0EC9       00483 m017	MOVLW 201
                  00484 			;	        movwf     PDel2     ; 1 |
00013E 6E7F       00485 	MOVWF PDel2,0
                  00486 			;	PLoop2  clrwdt              ; 1 clear watchdog
000140 0004       00487 m018	CLRWDT
                  00488 			;	        decfsz    PDel2, 1  ; 1 + (1) es el tiempo 0  ? (A)
000142 2E7F       00489 	DECFSZ PDel2,1,0
                  00490 			;	        goto      PLoop2    ; 2 no, loop
000144 EFA0 F000  00491 	GOTO  m018
                  00492 			;	        decfsz    PDel1,  1 ; 1 + (1) es el tiempo 0  ? (B)
000148 2E7F       00493 	DECFSZ PDel1_2,1,0
                  00494 			;	        goto      PLoop1    ; 2 no, loop
00014A EF9E F000  00495 	GOTO  m017
                  00496 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (C)
00014E 2E7F       00497 	DECFSZ PDel0_3,1,0
                  00498 			;	        goto      PLoop0    ; 2 no, loop
000150 EF9C F000  00499 	GOTO  m016
                  00500 			;	PDelL1  goto PDelL2         ; 2 ciclos delay
000154 EFAC F000  00501 	GOTO  m019
                  00502 			;	PDelL2  clrwdt              ; 1 ciclo delay
000158 0004       00503 m019	CLRWDT
                  00504 			;	        return              ; 2+2 Fin.
00015A 0012       00505 	RETURN
                  00506 			;	;-------------------------------------------------------------
                  00507 			;	#endasm
                  00508 			;}
                  00509 			;void retardo_100m(void){
                  00510 retardo_100m
                  00511 			;	char PDel0,PDel1,PDel2;
                  00512 			;	#asm
                  00513 			;	;-------------------------------------------------------------
                  00514 			;	DEMORA  movlw     .23       ; 1 set numero de repeticion  (C)
00015C 0E17       00515 	MOVLW 23
                  00516 			;	        movwf     PDel0     ; 1 |
00015E 6F7B       00517 	MOVWF PDel0_4,1
                  00518 			;	PLoop0  movlw     .59       ; 1 set numero de repeticion  (B)
000160 0E3B       00519 m020	MOVLW 59
                  00520 			;	        movwf     PDel1     ; 1 |
000162 6F7C       00521 	MOVWF PDel1_3,1
                  00522 			;	PLoop1  movlw     .235      ; 1 set numero de repeticion  (A)
000164 0EEB       00523 m021	MOVLW 235
                  00524 			;	        movwf     PDel2     ; 1 |
000166 6F7D       00525 	MOVWF PDel2_2,1
                  00526 			;	PLoop2  clrwdt              ; 1 clear watchdog
000168 0004       00527 m022	CLRWDT
                  00528 			;	        clrwdt              ; 1 ciclo delay
00016A 0004       00529 	CLRWDT
                  00530 			;	        decfsz    PDel2, 1  ; 1 + (1) es el tiempo 0  ? (A)
00016C 2F7D       00531 	DECFSZ PDel2_2,1,1
                  00532 			;	        goto      PLoop2    ; 2 no, loop
00016E EFB4 F000  00533 	GOTO  m022
                  00534 			;	        decfsz    PDel1,  1 ; 1 + (1) es el tiempo 0  ? (B)
000172 2F7C       00535 	DECFSZ PDel1_3,1,1
                  00536 			;	        goto      PLoop1    ; 2 no, loop
000174 EFB2 F000  00537 	GOTO  m021
                  00538 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (C)
000178 2F7B       00539 	DECFSZ PDel0_4,1,1
                  00540 			;	        goto      PLoop0    ; 2 no, loop
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 10

ADDR   CODE       LINE  SOURCE

00017A EFB0 F000  00541 	GOTO  m020
                  00542 			;	        return              ; 2+2 Fin.
00017E 0012       00543 	RETURN
                  00544 			;	;-------------------------------------------------------------
                  00545 			;	#endasm
                  00546 			;}
                  00547 			;void retardo_500m(void){
                  00548 retardo_500m
                  00549 			;	char PDel0,PDel1,PDel2;
                  00550 			;	#asm
                  00551 			;	;-------------------------------------------------------------
                  00552 			;	DEMORA  movlw     .54       ; 1 set numero de repeticion  (C)
000180 0E36       00553 	MOVLW 54
                  00554 			;	        movwf     PDel0     ; 1 |
000182 6E7F       00555 	MOVWF PDel0_5,0
                  00556 			;	PLoop0  movlw     .188      ; 1 set numero de repeticion  (B)
000184 0EBC       00557 m023	MOVLW 188
                  00558 			;	        movwf     PDel1     ; 1 |
000186 6E7F       00559 	MOVWF PDel1_4,0
                  00560 			;	PLoop1  movlw     .196      ; 1 set numero de repeticion  (A)
000188 0EC4       00561 m024	MOVLW 196
                  00562 			;	        movwf     PDel2     ; 1 |
00018A 6E7F       00563 	MOVWF PDel2_3,0
                  00564 			;	PLoop2  clrwdt              ; 1 clear watchdog
00018C 0004       00565 m025	CLRWDT
                  00566 			;	        decfsz    PDel2, 1  ; 1 + (1) es el tiempo 0  ? (A)
00018E 2E7F       00567 	DECFSZ PDel2_3,1,0
                  00568 			;	        goto      PLoop2    ; 2 no, loop
000190 EFC6 F000  00569 	GOTO  m025
                  00570 			;	        decfsz    PDel1,  1 ; 1 + (1) es el tiempo 0  ? (B)
000194 2E7F       00571 	DECFSZ PDel1_4,1,0
                  00572 			;	        goto      PLoop1    ; 2 no, loop
000196 EFC4 F000  00573 	GOTO  m024
                  00574 			;	        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (C)
00019A 2E7F       00575 	DECFSZ PDel0_5,1,0
                  00576 			;	        goto      PLoop0    ; 2 no, loop
00019C EFC2 F000  00577 	GOTO  m023
                  00578 			;	PDelL1  goto PDelL2         ; 2 ciclos delay
0001A0 EFD2 F000  00579 	GOTO  m026
                  00580 			;	PDelL2  clrwdt              ; 1 ciclo delay
0001A4 0004       00581 m026	CLRWDT
                  00582 			;	        return              ; 2+2 Fin.
0001A6 0012       00583 	RETURN
                  00584 			;	;-------------------------------------------------------------
                  00585 			;	#endasm
                  00586 
                  00587   ; FILE LCD_4bit.h
                  00588 			;void envia_codigo_inicial (char codigo)
                  00589 			;{
                  00590 envia_codigo_inicial
0001A8 0100       00591 	MOVLB 0
0001AA 6F7C       00592 	MOVWF codigo,1
                  00593 			;	PORTB.4=0;nop();
0001AC 9881       00594 	BCF   PORTB,4,0
0001AE 0000       00595 	NOP  
                  00596 			;	PORTB.0 = codigo.4;
0001B0 A97C       00597 	BTFSS codigo,4,1
0001B2 9081       00598 	BCF   PORTB,0,0
0001B4 B97C       00599 	BTFSC codigo,4,1
0001B6 8081       00600 	BSF   PORTB,0,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 11

ADDR   CODE       LINE  SOURCE

                  00601 			;	nop();
0001B8 0000       00602 	NOP  
                  00603 			;	PORTB.1 = codigo.5;
0001BA AB7C       00604 	BTFSS codigo,5,1
0001BC 9281       00605 	BCF   PORTB,1,0
0001BE BB7C       00606 	BTFSC codigo,5,1
0001C0 8281       00607 	BSF   PORTB,1,0
                  00608 			;	nop();
0001C2 0000       00609 	NOP  
                  00610 			;	PORTB.2 = codigo.6;
0001C4 AD7C       00611 	BTFSS codigo,6,1
0001C6 9481       00612 	BCF   PORTB,2,0
0001C8 BD7C       00613 	BTFSC codigo,6,1
0001CA 8481       00614 	BSF   PORTB,2,0
                  00615 			;	nop();
0001CC 0000       00616 	NOP  
                  00617 			;	PORTB.3 = codigo.7;
0001CE AF7C       00618 	BTFSS codigo,7,1
0001D0 9681       00619 	BCF   PORTB,3,0
0001D2 BF7C       00620 	BTFSC codigo,7,1
0001D4 8681       00621 	BSF   PORTB,3,0
                  00622 			;	nop();
0001D6 0000       00623 	NOP  
                  00624 			;	PORTB.5 = 1; 
0001D8 8A81       00625 	BSF   PORTB,5,0
                  00626 			;	retardo_20u();
0001DA DF8F       00627 	RCALL retardo_20u
                  00628 			;	PORTB.5 = 0; 
0001DC 9A81       00629 	BCF   PORTB,5,0
                  00630 			;
                  00631 			;	return;
0001DE 0012       00632 	RETURN
                  00633 			;}
                  00634 			; 
                  00635 			;void enviar_comando (char comando) 
                  00636 			;{
                  00637 enviar_comando
0001E0 0100       00638 	MOVLB 0
0001E2 6F90       00639 	MOVWF comando,1
                  00640 			;	
                  00641 			;	PORTB.0 =  comando.4;nop();
0001E4 A990       00642 	BTFSS comando,4,1
0001E6 9081       00643 	BCF   PORTB,0,0
0001E8 B990       00644 	BTFSC comando,4,1
0001EA 8081       00645 	BSF   PORTB,0,0
0001EC 0000       00646 	NOP  
                  00647 			;	PORTB.1 =  comando.5;nop();
0001EE AB90       00648 	BTFSS comando,5,1
0001F0 9281       00649 	BCF   PORTB,1,0
0001F2 BB90       00650 	BTFSC comando,5,1
0001F4 8281       00651 	BSF   PORTB,1,0
0001F6 0000       00652 	NOP  
                  00653 			;	PORTB.2 =  comando.6;nop();
0001F8 AD90       00654 	BTFSS comando,6,1
0001FA 9481       00655 	BCF   PORTB,2,0
0001FC BD90       00656 	BTFSC comando,6,1
0001FE 8481       00657 	BSF   PORTB,2,0
000200 0000       00658 	NOP  
                  00659 			;	PORTB.3 =  comando.7;
000202 AF90       00660 	BTFSS comando,7,1
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 12

ADDR   CODE       LINE  SOURCE

000204 9681       00661 	BCF   PORTB,3,0
000206 BF90       00662 	BTFSC comando,7,1
000208 8681       00663 	BSF   PORTB,3,0
                  00664 			;	retardo_1m ();
00020A DF81       00665 	RCALL retardo_1m
                  00666 			;	PORTB.4 = 0;  									// Modo comando.
00020C 9881       00667 	BCF   PORTB,4,0
                  00668 			;	retardo_20u (); //
00020E DF75       00669 	RCALL retardo_20u
                  00670 			;	PORTB.5 = 1;  									// Breve pulso.
000210 8A81       00671 	BSF   PORTB,5,0
                  00672 			;	retardo_20u ();
000212 DF73       00673 	RCALL retardo_20u
                  00674 			;	PORTB.5 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000214 9A81       00675 	BCF   PORTB,5,0
                  00676 			;	retardo_1m ();
000216 DF7B       00677 	RCALL retardo_1m
                  00678 			;	retardo_1m ();
000218 DF7A       00679 	RCALL retardo_1m
                  00680 			;	comando = swap (comando);
00021A 0100       00681 	MOVLB 0
00021C 3B90       00682 	SWAPF comando,1,1
                  00683 			;	PORTB.0 =  comando.4;nop();
00021E A990       00684 	BTFSS comando,4,1
000220 9081       00685 	BCF   PORTB,0,0
000222 B990       00686 	BTFSC comando,4,1
000224 8081       00687 	BSF   PORTB,0,0
000226 0000       00688 	NOP  
                  00689 			;	PORTB.1 =  comando.5;nop();
000228 AB90       00690 	BTFSS comando,5,1
00022A 9281       00691 	BCF   PORTB,1,0
00022C BB90       00692 	BTFSC comando,5,1
00022E 8281       00693 	BSF   PORTB,1,0
000230 0000       00694 	NOP  
                  00695 			;	PORTB.2 =  comando.6;nop();
000232 AD90       00696 	BTFSS comando,6,1
000234 9481       00697 	BCF   PORTB,2,0
000236 BD90       00698 	BTFSC comando,6,1
000238 8481       00699 	BSF   PORTB,2,0
00023A 0000       00700 	NOP  
                  00701 			;	PORTB.3 =  comando.7;nop();
00023C AF90       00702 	BTFSS comando,7,1
00023E 9681       00703 	BCF   PORTB,3,0
000240 BF90       00704 	BTFSC comando,7,1
000242 8681       00705 	BSF   PORTB,3,0
000244 0000       00706 	NOP  
                  00707 			;	retardo_1m ();
000246 DF63       00708 	RCALL retardo_1m
                  00709 			;	PORTB.4 = 0;  									// Modo comando.
000248 9881       00710 	BCF   PORTB,4,0
                  00711 			;	retardo_20u ();
00024A DF57       00712 	RCALL retardo_20u
                  00713 			;	PORTB.5 = 1;  									// Breve pulso.
00024C 8A81       00714 	BSF   PORTB,5,0
                  00715 			;	retardo_20u ();
00024E DF55       00716 	RCALL retardo_20u
                  00717 			;	PORTB.5 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000250 9A81       00718 	BCF   PORTB,5,0
                  00719 			;	retardo_1m ();
000252 DF5D       00720 	RCALL retardo_1m
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 13

ADDR   CODE       LINE  SOURCE

                  00721 			;	retardo_1m ();
000254 D75C       00722 	BRA   retardo_1m
                  00723 			;	//leds_OFF (10);
                  00724 			;	
                  00725 			;	
                  00726 			;	return;
                  00727 			;}    
                  00728 			;
                  00729 			;void enviar_literal (char dato) 
                  00730 			;{
                  00731 enviar_literal
000256 0100       00732 	MOVLB 0
000258 6F7C       00733 	MOVWF dato,1
                  00734 			;    char i;
                  00735 			;
                  00736 			;	
                  00737 			;	PORTB.0 = dato.4;
00025A A97C       00738 	BTFSS dato,4,1
00025C 9081       00739 	BCF   PORTB,0,0
00025E B97C       00740 	BTFSC dato,4,1
000260 8081       00741 	BSF   PORTB,0,0
                  00742 			;	nop();
000262 0000       00743 	NOP  
                  00744 			;	PORTB.1 = dato.5;
000264 AB7C       00745 	BTFSS dato,5,1
000266 9281       00746 	BCF   PORTB,1,0
000268 BB7C       00747 	BTFSC dato,5,1
00026A 8281       00748 	BSF   PORTB,1,0
                  00749 			;	nop();
00026C 0000       00750 	NOP  
                  00751 			;	PORTB.2 = dato.6;
00026E AD7C       00752 	BTFSS dato,6,1
000270 9481       00753 	BCF   PORTB,2,0
000272 BD7C       00754 	BTFSC dato,6,1
000274 8481       00755 	BSF   PORTB,2,0
                  00756 			;	nop();
000276 0000       00757 	NOP  
                  00758 			;	PORTB.3 = dato.7;
000278 AF7C       00759 	BTFSS dato,7,1
00027A 9681       00760 	BCF   PORTB,3,0
00027C BF7C       00761 	BTFSC dato,7,1
00027E 8681       00762 	BSF   PORTB,3,0
                  00763 			;	nop();
000280 0000       00764 	NOP  
                  00765 			;	PORTB.4 = 1;  									// Modo dato.
000282 8881       00766 	BSF   PORTB,4,0
                  00767 			;	retardo_20u ();
000284 DF3A       00768 	RCALL retardo_20u
                  00769 			;	PORTB.5 = 1;  									// Breve pulso.
000286 8A81       00770 	BSF   PORTB,5,0
                  00771 			;	retardo_20u ();
000288 DF38       00772 	RCALL retardo_20u
                  00773 			;	PORTB.5 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
00028A 9A81       00774 	BCF   PORTB,5,0
                  00775 			;	for (i = 1; i <= 6; i++) retardo_20u ();
00028C 0E01       00776 	MOVLW 1
00028E 0100       00777 	MOVLB 0
000290 6F7D       00778 	MOVWF i_2,1
000292 0E07       00779 m027	MOVLW 7
000294 0100       00780 	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 14

ADDR   CODE       LINE  SOURCE

000296 617D       00781 	CPFSLT i_2,1
000298 D004       00782 	BRA   m028
00029A DF2F       00783 	RCALL retardo_20u
00029C 0100       00784 	MOVLB 0
00029E 2B7D       00785 	INCF  i_2,1,1
0002A0 D7F8       00786 	BRA   m027
                  00787 			;	dato = swap (dato);
0002A2 0100       00788 m028	MOVLB 0
0002A4 3B7C       00789 	SWAPF dato,1,1
                  00790 			;	PORTB.0 = dato.4;nop();
0002A6 A97C       00791 	BTFSS dato,4,1
0002A8 9081       00792 	BCF   PORTB,0,0
0002AA B97C       00793 	BTFSC dato,4,1
0002AC 8081       00794 	BSF   PORTB,0,0
0002AE 0000       00795 	NOP  
                  00796 			;	PORTB.1 = dato.5;nop();
0002B0 AB7C       00797 	BTFSS dato,5,1
0002B2 9281       00798 	BCF   PORTB,1,0
0002B4 BB7C       00799 	BTFSC dato,5,1
0002B6 8281       00800 	BSF   PORTB,1,0
0002B8 0000       00801 	NOP  
                  00802 			;	PORTB.2 = dato.6;nop();
0002BA AD7C       00803 	BTFSS dato,6,1
0002BC 9481       00804 	BCF   PORTB,2,0
0002BE BD7C       00805 	BTFSC dato,6,1
0002C0 8481       00806 	BSF   PORTB,2,0
0002C2 0000       00807 	NOP  
                  00808 			;	PORTB.3 = dato.7;nop();
0002C4 AF7C       00809 	BTFSS dato,7,1
0002C6 9681       00810 	BCF   PORTB,3,0
0002C8 BF7C       00811 	BTFSC dato,7,1
0002CA 8681       00812 	BSF   PORTB,3,0
0002CC 0000       00813 	NOP  
                  00814 			;	retardo_1m ();
0002CE DF1F       00815 	RCALL retardo_1m
                  00816 			;	PORTB.4 = 1;  									// Modo dato.
0002D0 8881       00817 	BSF   PORTB,4,0
                  00818 			;	retardo_1m ();
0002D2 DF1D       00819 	RCALL retardo_1m
                  00820 			;	PORTB.5 = 1;  									// Breve pulso.
0002D4 8A81       00821 	BSF   PORTB,5,0
                  00822 			;	retardo_20u ();
0002D6 DF11       00823 	RCALL retardo_20u
                  00824 			;	PORTB.5 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
0002D8 9A81       00825 	BCF   PORTB,5,0
                  00826 			;	for (i = 1; i<= 6; i++) retardo_20u ();
0002DA 0E01       00827 	MOVLW 1
0002DC 0100       00828 	MOVLB 0
0002DE 6F7D       00829 	MOVWF i_2,1
0002E0 0E07       00830 m029	MOVLW 7
0002E2 0100       00831 	MOVLB 0
0002E4 617D       00832 	CPFSLT i_2,1
0002E6 D004       00833 	BRA   m030
0002E8 DF08       00834 	RCALL retardo_20u
0002EA 0100       00835 	MOVLB 0
0002EC 2B7D       00836 	INCF  i_2,1,1
0002EE D7F8       00837 	BRA   m029
                  00838 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.	
0002F0 0E0C       00839 m030	MOVLW 12
0002F2 D776       00840 	BRA   enviar_comando
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 15

ADDR   CODE       LINE  SOURCE

                  00841 			;	return;
                  00842 			;}   
                  00843 			;
                  00844 			;void enviar_cifra (char dato) 
                  00845 			;{
                  00846 enviar_cifra
0002F4 0100       00847 	MOVLB 0
0002F6 6F7C       00848 	MOVWF dato_2,1
                  00849 			;    char i;
                  00850 			;	dato = dato + 0x30; 							// Convierto el n˙mero en su equivalente ASCII literal. 
0002F8 0E30       00851 	MOVLW 48
0002FA 277C       00852 	ADDWF dato_2,1,1
                  00853 			;	PORTB.0 = dato.4;
0002FC A97C       00854 	BTFSS dato_2,4,1
0002FE 9081       00855 	BCF   PORTB,0,0
000300 B97C       00856 	BTFSC dato_2,4,1
000302 8081       00857 	BSF   PORTB,0,0
                  00858 			;	nop();
000304 0000       00859 	NOP  
                  00860 			;	PORTB.1 = dato.5;
000306 AB7C       00861 	BTFSS dato_2,5,1
000308 9281       00862 	BCF   PORTB,1,0
00030A BB7C       00863 	BTFSC dato_2,5,1
00030C 8281       00864 	BSF   PORTB,1,0
                  00865 			;	nop();
00030E 0000       00866 	NOP  
                  00867 			;	PORTB.2 = dato.6;
000310 AD7C       00868 	BTFSS dato_2,6,1
000312 9481       00869 	BCF   PORTB,2,0
000314 BD7C       00870 	BTFSC dato_2,6,1
000316 8481       00871 	BSF   PORTB,2,0
                  00872 			;	nop();
000318 0000       00873 	NOP  
                  00874 			;	PORTB.3 = dato.7;
00031A AF7C       00875 	BTFSS dato_2,7,1
00031C 9681       00876 	BCF   PORTB,3,0
00031E BF7C       00877 	BTFSC dato_2,7,1
000320 8681       00878 	BSF   PORTB,3,0
                  00879 			;	nop();
000322 0000       00880 	NOP  
                  00881 			;	PORTB.4 = 1;  									// Modo dato.
000324 8881       00882 	BSF   PORTB,4,0
                  00883 			;	retardo_20u ();
000326 DEE9       00884 	RCALL retardo_20u
                  00885 			;	PORTB.5 = 1;  									// Breve pulso.
000328 8A81       00886 	BSF   PORTB,5,0
                  00887 			;	retardo_20u ();
00032A DEE7       00888 	RCALL retardo_20u
                  00889 			;	PORTB.5 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
00032C 9A81       00890 	BCF   PORTB,5,0
                  00891 			;	for (i = 1; i <= 6; i++) retardo_20u ();
00032E 0E01       00892 	MOVLW 1
000330 0100       00893 	MOVLB 0
000332 6F7D       00894 	MOVWF i_3,1
000334 0E07       00895 m031	MOVLW 7
000336 0100       00896 	MOVLB 0
000338 617D       00897 	CPFSLT i_3,1
00033A D004       00898 	BRA   m032
00033C DEDE       00899 	RCALL retardo_20u
00033E 0100       00900 	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 16

ADDR   CODE       LINE  SOURCE

000340 2B7D       00901 	INCF  i_3,1,1
000342 D7F8       00902 	BRA   m031
                  00903 			;	dato = swap (dato);
000344 0100       00904 m032	MOVLB 0
000346 3B7C       00905 	SWAPF dato_2,1,1
                  00906 			;	PORTB.0 = dato.4;
000348 A97C       00907 	BTFSS dato_2,4,1
00034A 9081       00908 	BCF   PORTB,0,0
00034C B97C       00909 	BTFSC dato_2,4,1
00034E 8081       00910 	BSF   PORTB,0,0
                  00911 			;	nop();
000350 0000       00912 	NOP  
                  00913 			;	PORTB.1 = dato.5;
000352 AB7C       00914 	BTFSS dato_2,5,1
000354 9281       00915 	BCF   PORTB,1,0
000356 BB7C       00916 	BTFSC dato_2,5,1
000358 8281       00917 	BSF   PORTB,1,0
                  00918 			;	nop();
00035A 0000       00919 	NOP  
                  00920 			;	PORTB.2 = dato.6;
00035C AD7C       00921 	BTFSS dato_2,6,1
00035E 9481       00922 	BCF   PORTB,2,0
000360 BD7C       00923 	BTFSC dato_2,6,1
000362 8481       00924 	BSF   PORTB,2,0
                  00925 			;	nop();
000364 0000       00926 	NOP  
                  00927 			;	PORTB.3 = dato.7;
000366 AF7C       00928 	BTFSS dato_2,7,1
000368 9681       00929 	BCF   PORTB,3,0
00036A BF7C       00930 	BTFSC dato_2,7,1
00036C 8681       00931 	BSF   PORTB,3,0
                  00932 			;	retardo_1m ();
00036E DECF       00933 	RCALL retardo_1m
                  00934 			;	PORTB.4 = 1;  									// Modo dato.
000370 8881       00935 	BSF   PORTB,4,0
                  00936 			;	retardo_1m ();
000372 DECD       00937 	RCALL retardo_1m
                  00938 			;	PORTB.5 = 1;  									// Breve pulso.
000374 8A81       00939 	BSF   PORTB,5,0
                  00940 			;	retardo_20u ();
000376 DEC1       00941 	RCALL retardo_20u
                  00942 			;	PORTB.5 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000378 9A81       00943 	BCF   PORTB,5,0
                  00944 			;	for (i = 1; i<= 6; i++) retardo_20u ();
00037A 0E01       00945 	MOVLW 1
00037C 0100       00946 	MOVLB 0
00037E 6F7D       00947 	MOVWF i_3,1
000380 0E07       00948 m033	MOVLW 7
000382 0100       00949 	MOVLB 0
000384 617D       00950 	CPFSLT i_3,1
000386 D004       00951 	BRA   m034
000388 DEB8       00952 	RCALL retardo_20u
00038A 0100       00953 	MOVLB 0
00038C 2B7D       00954 	INCF  i_3,1,1
00038E D7F8       00955 	BRA   m033
                  00956 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.
000390 0E0C       00957 m034	MOVLW 12
000392 D726       00958 	BRA   enviar_comando
                  00959 			;	return;
                  00960 			;} 
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 17

ADDR   CODE       LINE  SOURCE

                  00961 			;
                  00962 			;void inicializar_lcd (void) 
                  00963 			;{
                  00964 inicializar_lcd
                  00965 			;	char i;
                  00966 			;	clrwdt () ;	
000394 0004       00967 	CLRWDT
                  00968 			;	for (i = 1; i < 21; i++) retardo_1m ();    
000396 0E01       00969 	MOVLW 1
000398 0100       00970 	MOVLB 0
00039A 6F7B       00971 	MOVWF i_4,1
00039C 0E15       00972 m035	MOVLW 21
00039E 0100       00973 	MOVLB 0
0003A0 617B       00974 	CPFSLT i_4,1
0003A2 D004       00975 	BRA   m036
0003A4 DEB4       00976 	RCALL retardo_1m
0003A6 0100       00977 	MOVLB 0
0003A8 2B7B       00978 	INCF  i_4,1,1
0003AA D7F8       00979 	BRA   m035
                  00980 			;	envia_codigo_inicial (0b.00.11.0000);
0003AC 0E30       00981 m036	MOVLW 48
0003AE DEFC       00982 	RCALL envia_codigo_inicial
                  00983 			;	for (i = 1; i < 6; i++) retardo_1m ();
0003B0 0E01       00984 	MOVLW 1
0003B2 0100       00985 	MOVLB 0
0003B4 6F7B       00986 	MOVWF i_4,1
0003B6 0E06       00987 m037	MOVLW 6
0003B8 0100       00988 	MOVLB 0
0003BA 617B       00989 	CPFSLT i_4,1
0003BC D004       00990 	BRA   m038
0003BE DEA7       00991 	RCALL retardo_1m
0003C0 0100       00992 	MOVLB 0
0003C2 2B7B       00993 	INCF  i_4,1,1
0003C4 D7F8       00994 	BRA   m037
                  00995 			;    envia_codigo_inicial (0b.00.11.0000);	
0003C6 0E30       00996 m038	MOVLW 48
0003C8 DEEF       00997 	RCALL envia_codigo_inicial
                  00998 			;	for (i = 1; i< 11; i++) retardo_20u ();
0003CA 0E01       00999 	MOVLW 1
0003CC 0100       01000 	MOVLB 0
0003CE 6F7B       01001 	MOVWF i_4,1
0003D0 0E0B       01002 m039	MOVLW 11
0003D2 0100       01003 	MOVLB 0
0003D4 617B       01004 	CPFSLT i_4,1
0003D6 D004       01005 	BRA   m040
0003D8 DE90       01006 	RCALL retardo_20u
0003DA 0100       01007 	MOVLB 0
0003DC 2B7B       01008 	INCF  i_4,1,1
0003DE D7F8       01009 	BRA   m039
                  01010 			;    envia_codigo_inicial (0b.00.11.0000);
0003E0 0E30       01011 m040	MOVLW 48
0003E2 DEE2       01012 	RCALL envia_codigo_inicial
                  01013 			;	for (i = 1; i < 11; i++) retardo_20u ();
0003E4 0E01       01014 	MOVLW 1
0003E6 0100       01015 	MOVLB 0
0003E8 6F7B       01016 	MOVWF i_4,1
0003EA 0E0B       01017 m041	MOVLW 11
0003EC 0100       01018 	MOVLB 0
0003EE 617B       01019 	CPFSLT i_4,1
0003F0 D004       01020 	BRA   m042
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 18

ADDR   CODE       LINE  SOURCE

0003F2 DE83       01021 	RCALL retardo_20u
0003F4 0100       01022 	MOVLB 0
0003F6 2B7B       01023 	INCF  i_4,1,1
0003F8 D7F8       01024 	BRA   m041
                  01025 			;	envia_codigo_inicial (0b.00.10.0000);			// A 4 bits.
0003FA 0E20       01026 m042	MOVLW 32
0003FC DED5       01027 	RCALL envia_codigo_inicial
                  01028 			;	enviar_comando (0b.0010.1000);					// A 4 bits, doble lÌnea, caracteres 5x7.
0003FE 0E28       01029 	MOVLW 40
000400 DEEF       01030 	RCALL enviar_comando
                  01031 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.
000402 0E0C       01032 	MOVLW 12
000404 DEED       01033 	RCALL enviar_comando
                  01034 			;	enviar_comando (0b.0000.0010);  				// Cursor en home, inicio de primera linea.
000406 0E02       01035 	MOVLW 2
000408 D6EB       01036 	BRA   enviar_comando
                  01037 			;	return;
                  01038 			;}
                  01039 			;
                  01040 			;void escribir_posicion (char linea, char columna)
                  01041 			;{
                  01042 escribir_posicion
00040A 0100       01043 	MOVLB 0
00040C 6F7D       01044 	MOVWF columna,1
                  01045 			;	
                  01046 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
00040E 517C       01047 	MOVF  linea,W,1
000410 0A01       01048 	XORLW 1
000412 B4D8       01049 	BTFSC 0xFD8,Zero_,0
000414 D00A       01050 	BRA   m043
000416 0A03       01051 	XORLW 3
000418 B4D8       01052 	BTFSC 0xFD8,Zero_,0
00041A D00C       01053 	BRA   m044
00041C 0A01       01054 	XORLW 1
00041E B4D8       01055 	BTFSC 0xFD8,Zero_,0
000420 D00E       01056 	BRA   m045
000422 0A07       01057 	XORLW 7
000424 B4D8       01058 	BTFSC 0xFD8,Zero_,0
000426 D010       01059 	BRA   m046
000428 D016       01060 	BRA   m047
                  01061 			;		{
                  01062 			;			case 1:
                  01063 			;				enviar_comando (127 + columna); 	// Inicio primera linea.
00042A 0E7F       01064 m043	MOVLW 127
00042C 0100       01065 	MOVLB 0
00042E 257D       01066 	ADDWF columna,W,1
000430 DED7       01067 	RCALL enviar_comando
                  01068 			;			break;
000432 D011       01069 	BRA   m047
                  01070 			;						
                  01071 			;			case 2:
                  01072 			;				enviar_comando (191 + columna); 	// Inicio segunda lÌnea.
000434 0EBF       01073 m044	MOVLW 191
000436 0100       01074 	MOVLB 0
000438 257D       01075 	ADDWF columna,W,1
00043A DED2       01076 	RCALL enviar_comando
                  01077 			;			break;			
00043C D00C       01078 	BRA   m047
                  01079 			;
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 19

ADDR   CODE       LINE  SOURCE

                  01080 			;			case 3:
                  01081 			;				enviar_comando (147 + columna);		// Inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
00043E 0E93       01082 m045	MOVLW 147
000440 0100       01083 	MOVLB 0
000442 257D       01084 	ADDWF columna,W,1
000444 DECD       01085 	RCALL enviar_comando
                  01086 			;			break;				
000446 D007       01087 	BRA   m047
                  01088 			;			
                  01089 			;			case 4:
                  01090 			;				enviar_comando (211 + columna); 	// Inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
000448 0ED3       01091 m046	MOVLW 211
00044A 0100       01092 	MOVLB 0
00044C 257D       01093 	ADDWF columna,W,1
00044E DEC8       01094 	RCALL enviar_comando
                  01095 			;			break;
000450 D002       01096 	BRA   m047
                  01097 			;			enviar_comando (0b.0000.1100);			// Pantalla encendida, sin cursor.
000452 0E0C       01098 	MOVLW 12
000454 D6C5       01099 	BRA   enviar_comando
                  01100 			;		}
                  01101 			;	
                  01102 			;	
                  01103 			;}
000456 0012       01104 m047	RETURN
                  01105 			;
                  01106 			;void borrar_linea (char linea)
                  01107 			;{
                  01108 borrar_linea
000458 6E7F       01109 	MOVWF linea_2,0
                  01110 			;	char i;
                  01111 			;		
                  01112 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
00045A 507F       01113 	MOVF  linea_2,W,0
00045C 0A01       01114 	XORLW 1
00045E B4D8       01115 	BTFSC 0xFD8,Zero_,0
000460 D00A       01116 	BRA   m048
000462 0A03       01117 	XORLW 3
000464 B4D8       01118 	BTFSC 0xFD8,Zero_,0
000466 D00A       01119 	BRA   m049
000468 0A01       01120 	XORLW 1
00046A B4D8       01121 	BTFSC 0xFD8,Zero_,0
00046C D00A       01122 	BRA   m050
00046E 0A07       01123 	XORLW 7
000470 B4D8       01124 	BTFSC 0xFD8,Zero_,0
000472 D00A       01125 	BRA   m051
000474 D00B       01126 	BRA   m052
                  01127 			;		{
                  01128 			;			case 1:
                  01129 			;				enviar_comando (128); 				// Inicio primera linea.
000476 0E80       01130 m048	MOVLW 128
000478 DEB3       01131 	RCALL enviar_comando
                  01132 			;			break;
00047A D008       01133 	BRA   m052
                  01134 			;						
                  01135 			;			case 2:
                  01136 			;				enviar_comando (192); 				// Inicio segunda lÌnea.
00047C 0EC0       01137 m049	MOVLW 192
00047E DEB0       01138 	RCALL enviar_comando
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 20

ADDR   CODE       LINE  SOURCE

                  01139 			;			break;			
000480 D005       01140 	BRA   m052
                  01141 			;
                  01142 			;			case 3:
                  01143 			;				enviar_comando (148); 				// Inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
000482 0E94       01144 m050	MOVLW 148
000484 DEAD       01145 	RCALL enviar_comando
                  01146 			;			break;				
000486 D002       01147 	BRA   m052
                  01148 			;			
                  01149 			;			case 4:
                  01150 			;				enviar_comando (212); 				// Inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
000488 0ED4       01151 m051	MOVLW 212
00048A DEAA       01152 	RCALL enviar_comando
                  01153 			;			break;
                  01154 			;		}
                  01155 			;	for (i = 1; i < 21; i++) enviar_literal (' '); 	// Envio 20 car·cteres en blanco y posiciono en la siguiente lÌnea.
00048C 0E01       01156 m052	MOVLW 1
00048E 6E7F       01157 	MOVWF i_5,0
000490 0E15       01158 m053	MOVLW 21
000492 607F       01159 	CPFSLT i_5,0
000494 D004       01160 	BRA   m054
000496 0E20       01161 	MOVLW 32
000498 DEDE       01162 	RCALL enviar_literal
00049A 2A7F       01163 	INCF  i_5,1,0
00049C D7F9       01164 	BRA   m053
                  01165 			;	enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.	
00049E 0E0C       01166 m054	MOVLW 12
0004A0 D69F       01167 	BRA   enviar_comando
                  01168 			;}
                  01169 			;
                  01170 			;void borrar_lcd (void)
                  01171 			;{
                  01172 borrar_lcd
                  01173 			;	enviar_comando (0b.0000.0001);  				// Borrado del display y cursor en la posiciÛn inicial.	
0004A2 0E01       01174 	MOVLW 1
0004A4 D69D       01175 	BRA   enviar_comando
                  01176 			;}
                  01177 			;
                  01178 			;void Enviar_lcd (char linea, char columna, uns16 dato, bit bd, bit dp, bit xi,bit ndp)
                  01179 			;            //fila , col , uns16 , bd -> si 0 posa espai si "0" a l'esquerra ,, dp -> si "0"--> posa punt decimal
                  01180 			;{
                  01181 Enviar_lcd
                  01182 			;// Aquesta funcio, posiciona Fila i Columna d'un LCD 4x20 i envia una xifra uns16 descomposant-la i posant 
                  01183 			;//  decimal o no, segons sigui dp, si "0"--> posa punt decimal , si dp "1" -> no posa dp
                  01184 			;//  si bd = "0" -> posa espai, si bd = "1"  --> No  posa espai i posa el 0.
                  01185 			;// si xi = 0 -> 3 xifres,, si xi = 1  -> 4 xifres
                  01186 			;// Atencio, amb dp S'UTILIZA un ESPAI MES
                  01187 			;// amb 4 xifres, tambe es representen 3, pero es gasta un espai de mes.
                  01188 			;// ESPI utilitzat...3 per 3 xifres,, 4 per 3xifres + dp   O 4xifres s/dp ,, 5 per 4 xifres + dp
                  01189 			;// ndp ..si "0"...1decimal... si "1"   2 decimals
                  01190 			;	uns16 num, u_milers, cent;
                  01191 			;	char dec, unid, resto1;
                  01192 			;	char i, xx, yy, dat,xy;
                  01193 			;	
                  01194 			;	//CON_LCD ();
                  01195 			;	//posiciono
                  01196 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
0004A6 507F       01197 	MOVF  linea_3,W,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 21

ADDR   CODE       LINE  SOURCE

0004A8 0A01       01198 	XORLW 1
0004AA B4D8       01199 	BTFSC 0xFD8,Zero_,0
0004AC D00A       01200 	BRA   m055
0004AE 0A03       01201 	XORLW 3
0004B0 B4D8       01202 	BTFSC 0xFD8,Zero_,0
0004B2 D00B       01203 	BRA   m056
0004B4 0A01       01204 	XORLW 1
0004B6 B4D8       01205 	BTFSC 0xFD8,Zero_,0
0004B8 D00C       01206 	BRA   m057
0004BA 0A07       01207 	XORLW 7
0004BC B4D8       01208 	BTFSC 0xFD8,Zero_,0
0004BE D00D       01209 	BRA   m058
0004C0 D012       01210 	BRA   m059
                  01211 			;		{
                  01212 			;			case 1:	enviar_comando (127 + columna); 	// inicio primera linea.
0004C2 0E7F       01213 m055	MOVLW 127
0004C4 247F       01214 	ADDWF columna_2,W,0
0004C6 DE8C       01215 	RCALL enviar_comando
                  01216 			;			break;	
0004C8 D00E       01217 	BRA   m059
                  01218 			;			case 2:	enviar_comando (191 + columna); 	// inicio segunda lÌnea.
0004CA 0EBF       01219 m056	MOVLW 191
0004CC 247F       01220 	ADDWF columna_2,W,0
0004CE DE88       01221 	RCALL enviar_comando
                  01222 			;			break;			
0004D0 D00A       01223 	BRA   m059
                  01224 			;			case 3:	enviar_comando (147 + columna); 	// inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
0004D2 0E93       01225 m057	MOVLW 147
0004D4 247F       01226 	ADDWF columna_2,W,0
0004D6 DE84       01227 	RCALL enviar_comando
                  01228 			;			break;				
0004D8 D006       01229 	BRA   m059
                  01230 			;			case 4:	enviar_comando (211 + columna); 	// inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
0004DA 0ED3       01231 m058	MOVLW 211
0004DC 247F       01232 	ADDWF columna_2,W,0
0004DE DE80       01233 	RCALL enviar_comando
                  01234 			;			break;	
0004E0 D002       01235 	BRA   m059
                  01236 			;			enviar_comando (0b.0000.1100);			// pantalla encendida, sin cursor
0004E2 0E0C       01237 	MOVLW 12
0004E4 DE7D       01238 	RCALL enviar_comando
                  01239 			;		}				
                  01240 			;		if (!xi)
0004E6 B07F       01241 m059	BTFSC 0xF7F,xi,0
0004E8 D011       01242 	BRA   m060
                  01243 			;		{
                  01244 			;			xy = 2;
0004EA 0E02       01245 	MOVLW 2
0004EC 6E7F       01246 	MOVWF xy,0
                  01247 			;			u_milers = 0;
0004EE 6A7F       01248 	CLRF  u_milers,0
0004F0 6A7F       01249 	CLRF  u_milers+1,0
                  01250 			;			if (dato > 999) { enviar_literal ('>');enviar_literal ('E');enviar_literal ('r'); goto so; }
0004F2 0EE8       01251 	MOVLW 232
0004F4 5C7F       01252 	SUBWF dato_3,W,0
0004F6 0E03       01253 	MOVLW 3
0004F8 587F       01254 	SUBWFB dato_3+1,W,0
0004FA A0D8       01255 	BTFSS 0xFD8,Carry,0
0004FC D04D       01256 	BRA   m066
0004FE 0E3E       01257 	MOVLW 62
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 22

ADDR   CODE       LINE  SOURCE

000500 DEAA       01258 	RCALL enviar_literal
000502 0E45       01259 	MOVLW 69
000504 DEA8       01260 	RCALL enviar_literal
000506 0E72       01261 	MOVLW 114
000508 DEA6       01262 	RCALL enviar_literal
00050A D13B       01263 	BRA   m096
                  01264 			;		    else goto sa;
                  01265 			;		}
                  01266 			;		else
                  01267 			;		{
                  01268 			;			xy = 1;
00050C 0E01       01269 m060	MOVLW 1
00050E 6E7F       01270 	MOVWF xy,0
                  01271 			;			if (dato > 9999) { enviar_literal ('>');enviar_literal ('E');enviar_literal ('r'); goto so; }
000510 0E10       01272 	MOVLW 16
000512 5C7F       01273 	SUBWF dato_3,W,0
000514 0E27       01274 	MOVLW 39
000516 587F       01275 	SUBWFB dato_3+1,W,0
000518 A0D8       01276 	BTFSS 0xFD8,Carry,0
00051A D007       01277 	BRA   m061
00051C 0E3E       01278 	MOVLW 62
00051E DE9B       01279 	RCALL enviar_literal
000520 0E45       01280 	MOVLW 69
000522 DE99       01281 	RCALL enviar_literal
000524 0E72       01282 	MOVLW 114
000526 DE97       01283 	RCALL enviar_literal
000528 D12C       01284 	BRA   m096
                  01285 			;		}
                  01286 			;			// Separo per 4 xifres
                  01287 			;			num = dato; // per 4 xifres
00052A CF7F FF7F  01288 m061	MOVFF dato_3,num
00052E CF7F FF7F  01289 	MOVFF dato_3+1,num+1
                  01290 			;			u_milers = num / 1000;
000532 507F       01291 	MOVF  num,W,0
000534 6E7F       01292 	MOVWF C4tmp,0
000536 507F       01293 	MOVF  num+1,W,0
000538 6E7F       01294 	MOVWF C4tmp+1,0
00053A 6A7F       01295 	CLRF  C5rem,0
00053C 6A7F       01296 	CLRF  C5rem+1,0
00053E 0E10       01297 	MOVLW 16
000540 6E7F       01298 	MOVWF C3cnt,0
000542 367F       01299 m062	RLCF  C4tmp,1,0
000544 367F       01300 	RLCF  C4tmp+1,1,0
000546 367F       01301 	RLCF  C5rem,1,0
000548 367F       01302 	RLCF  C5rem+1,1,0
00054A 0EE8       01303 	MOVLW 232
00054C 5C7F       01304 	SUBWF C5rem,W,0
00054E 0E03       01305 	MOVLW 3
000550 587F       01306 	SUBWFB C5rem+1,W,0
000552 A0D8       01307 	BTFSS 0xFD8,Carry,0
000554 D005       01308 	BRA   m063
000556 0EE8       01309 	MOVLW 232
000558 5E7F       01310 	SUBWF C5rem,1,0
00055A 0E03       01311 	MOVLW 3
00055C 5A7F       01312 	SUBWFB C5rem+1,1,0
00055E 80D8       01313 	BSF   0xFD8,Carry,0
000560 367F       01314 m063	RLCF  u_milers,1,0
000562 367F       01315 	RLCF  u_milers+1,1,0
000564 2E7F       01316 	DECFSZ C3cnt,1,0
000566 D7ED       01317 	BRA   m062
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 23

ADDR   CODE       LINE  SOURCE

                  01318 			;			dato = num % 1000;
000568 507F       01319 	MOVF  num,W,0
00056A 6E7F       01320 	MOVWF C7tmp,0
00056C 507F       01321 	MOVF  num+1,W,0
00056E 6E7F       01322 	MOVWF C7tmp+1,0
000570 6A7F       01323 	CLRF  dato_3,0
000572 6A7F       01324 	CLRF  dato_3+1,0
000574 0E10       01325 	MOVLW 16
000576 6E7F       01326 	MOVWF C6cnt,0
000578 367F       01327 m064	RLCF  C7tmp,1,0
00057A 367F       01328 	RLCF  C7tmp+1,1,0
00057C 367F       01329 	RLCF  dato_3,1,0
00057E 367F       01330 	RLCF  dato_3+1,1,0
000580 0EE8       01331 	MOVLW 232
000582 5C7F       01332 	SUBWF dato_3,W,0
000584 0E03       01333 	MOVLW 3
000586 587F       01334 	SUBWFB dato_3+1,W,0
000588 A0D8       01335 	BTFSS 0xFD8,Carry,0
00058A D004       01336 	BRA   m065
00058C 0EE8       01337 	MOVLW 232
00058E 5E7F       01338 	SUBWF dato_3,1,0
000590 0E03       01339 	MOVLW 3
000592 5A7F       01340 	SUBWFB dato_3+1,1,0
000594 2E7F       01341 m065	DECFSZ C6cnt,1,0
000596 D7F0       01342 	BRA   m064
                  01343 			;			// Separo per 3 xifres
                  01344 			;sa:			cent   = dato   / 100;   	
000598 507F       01345 m066	MOVF  dato_3,W,0
00059A 6E7F       01346 	MOVWF C9tmp,0
00059C 507F       01347 	MOVF  dato_3+1,W,0
00059E 6E7F       01348 	MOVWF C9tmp+1,0
0005A0 6A7F       01349 	CLRF  C10rem,0
0005A2 0E10       01350 	MOVLW 16
0005A4 6E7F       01351 	MOVWF C8cnt,0
0005A6 367F       01352 m067	RLCF  C9tmp,1,0
0005A8 367F       01353 	RLCF  C9tmp+1,1,0
0005AA 367F       01354 	RLCF  C10rem,1,0
0005AC B0D8       01355 	BTFSC 0xFD8,Carry,0
0005AE D004       01356 	BRA   m068
0005B0 0E64       01357 	MOVLW 100
0005B2 5C7F       01358 	SUBWF C10rem,W,0
0005B4 A0D8       01359 	BTFSS 0xFD8,Carry,0
0005B6 D003       01360 	BRA   m069
0005B8 0E64       01361 m068	MOVLW 100
0005BA 5E7F       01362 	SUBWF C10rem,1,0
0005BC 80D8       01363 	BSF   0xFD8,Carry,0
0005BE 367F       01364 m069	RLCF  cent,1,0
0005C0 367F       01365 	RLCF  cent+1,1,0
0005C2 2E7F       01366 	DECFSZ C8cnt,1,0
0005C4 D7F0       01367 	BRA   m067
                  01368 			;			resto1 = dato   % 100;
0005C6 507F       01369 	MOVF  dato_3,W,0
0005C8 6E7F       01370 	MOVWF C12tmp,0
0005CA 507F       01371 	MOVF  dato_3+1,W,0
0005CC 6E7F       01372 	MOVWF C12tmp+1,0
0005CE 6A7F       01373 	CLRF  resto1,0
0005D0 0E10       01374 	MOVLW 16
0005D2 6E7F       01375 	MOVWF C11cnt,0
0005D4 367F       01376 m070	RLCF  C12tmp,1,0
0005D6 367F       01377 	RLCF  C12tmp+1,1,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 24

ADDR   CODE       LINE  SOURCE

0005D8 367F       01378 	RLCF  resto1,1,0
0005DA B0D8       01379 	BTFSC 0xFD8,Carry,0
0005DC D004       01380 	BRA   m071
0005DE 0E64       01381 	MOVLW 100
0005E0 5C7F       01382 	SUBWF resto1,W,0
0005E2 A0D8       01383 	BTFSS 0xFD8,Carry,0
0005E4 D002       01384 	BRA   m072
0005E6 0E64       01385 m071	MOVLW 100
0005E8 5E7F       01386 	SUBWF resto1,1,0
0005EA 2E7F       01387 m072	DECFSZ C11cnt,1,0
0005EC D7F3       01388 	BRA   m070
                  01389 			;			dec    = resto1 /  10;  
0005EE 507F       01390 	MOVF  resto1,W,0
0005F0 6E7F       01391 	MOVWF C14tmp,0
0005F2 6A7F       01392 	CLRF  C15rem,0
0005F4 0E08       01393 	MOVLW 8
0005F6 6E7F       01394 	MOVWF C13cnt,0
0005F8 367F       01395 m073	RLCF  C14tmp,1,0
0005FA 367F       01396 	RLCF  C15rem,1,0
0005FC 0E0A       01397 	MOVLW 10
0005FE 5C7F       01398 	SUBWF C15rem,W,0
000600 A0D8       01399 	BTFSS 0xFD8,Carry,0
000602 D003       01400 	BRA   m074
000604 0E0A       01401 	MOVLW 10
000606 5E7F       01402 	SUBWF C15rem,1,0
000608 80D8       01403 	BSF   0xFD8,Carry,0
00060A 367F       01404 m074	RLCF  dec,1,0
00060C 2E7F       01405 	DECFSZ C13cnt,1,0
00060E D7F4       01406 	BRA   m073
                  01407 			;			unid   = resto1 %  10; 		
000610 507F       01408 	MOVF  resto1,W,0
000612 6E7F       01409 	MOVWF C17tmp,0
000614 6A7F       01410 	CLRF  unid,0
000616 0E08       01411 	MOVLW 8
000618 6E7F       01412 	MOVWF C16cnt,0
00061A 367F       01413 m075	RLCF  C17tmp,1,0
00061C 367F       01414 	RLCF  unid,1,0
00061E 0E0A       01415 	MOVLW 10
000620 5C7F       01416 	SUBWF unid,W,0
000622 A0D8       01417 	BTFSS 0xFD8,Carry,0
000624 D002       01418 	BRA   m076
000626 0E0A       01419 	MOVLW 10
000628 5E7F       01420 	SUBWF unid,1,0
00062A 2E7F       01421 m076	DECFSZ C16cnt,1,0
00062C D7F6       01422 	BRA   m075
                  01423 			;		// Envio
                  01424 			;		for (xx = xy; xx < 7; xx++)
00062E CF7F FF7F  01425 	MOVFF xy,xx
000632 0E07       01426 m077	MOVLW 7
000634 607F       01427 	CPFSLT xx,0
000636 D0A5       01428 	BRA   m096
                  01429 			;		{
                  01430 			;			clrwdt () ;
000638 0004       01431 	CLRWDT
                  01432 			;			if (xx == 1) 
00063A 2C7F       01433 	DECFSZ xx,W,0
00063C D00B       01434 	BRA   m079
                  01435 			;			{
                  01436 			;				if ((u_milers==0)&&(!bd)) dat = ' '; // bd =0 --> espai
00063E 507F       01437 	MOVF  u_milers,W,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 25

ADDR   CODE       LINE  SOURCE

000640 107F       01438 	IORWF u_milers+1,W,0
000642 A4D8       01439 	BTFSS 0xFD8,Zero_,0
000644 D005       01440 	BRA   m078
000646 B07F       01441 	BTFSC 0xF7F,bd,0
000648 D003       01442 	BRA   m078
00064A 0E20       01443 	MOVLW 32
00064C 6E7F       01444 	MOVWF dat,0
                  01445 			;				else dat = u_milers;
00064E D002       01446 	BRA   m079
000650 CF7F FF7F  01447 m078	MOVFF u_milers,dat
                  01448 			;			}
                  01449 			;			if (xx == 2) 
000654 0E02       01450 m079	MOVLW 2
000656 627F       01451 	CPFSEQ xx,0
000658 D00F       01452 	BRA   m081
                  01453 			;			{
                  01454 			;				if ((u_milers==0)&&(cent==0)&&(!bd)) dat = ' '; // bd =0 --> espai
00065A 507F       01455 	MOVF  u_milers,W,0
00065C 107F       01456 	IORWF u_milers+1,W,0
00065E A4D8       01457 	BTFSS 0xFD8,Zero_,0
000660 D009       01458 	BRA   m080
000662 507F       01459 	MOVF  cent,W,0
000664 107F       01460 	IORWF cent+1,W,0
000666 A4D8       01461 	BTFSS 0xFD8,Zero_,0
000668 D005       01462 	BRA   m080
00066A B07F       01463 	BTFSC 0xF7F,bd,0
00066C D003       01464 	BRA   m080
00066E 0E20       01465 	MOVLW 32
000670 6E7F       01466 	MOVWF dat,0
                  01467 			;				else dat = cent;
000672 D002       01468 	BRA   m081
000674 CF7F FF7F  01469 m080	MOVFF cent,dat
                  01470 			;			}
                  01471 			;			if (xx == 3) 
000678 0E03       01472 m081	MOVLW 3
00067A 627F       01473 	CPFSEQ xx,0
00067C D00A       01474 	BRA   m084
                  01475 			;			{
                  01476 			;				if(ndp) { if (dp==0) dat = '.';
00067E A07F       01477 	BTFSS 0xF7F,ndp,0
000680 D007       01478 	BRA   m083
000682 B07F       01479 	BTFSC 0xF7F,dp,0
000684 D003       01480 	BRA   m082
000686 0E2E       01481 	MOVLW 46
000688 6E7F       01482 	MOVWF dat,0
                  01483 			;				          else xx++;  
00068A D003       01484 	BRA   m084
00068C 2A7F       01485 m082	INCF  xx,1,0
                  01486 			;				        }
                  01487 			;				else xx++;		
00068E D001       01488 	BRA   m084
000690 2A7F       01489 m083	INCF  xx,1,0
                  01490 			;			}
                  01491 			;			if (xx == 4)
000692 0E04       01492 m084	MOVLW 4
000694 627F       01493 	CPFSEQ xx,0
000696 D012       01494 	BRA   m086
                  01495 			;			{
                  01496 			;				if ((u_milers==0)&&(cent==0)&&(dec==0)&&(!bd)) dat = ' ';
000698 507F       01497 	MOVF  u_milers,W,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 26

ADDR   CODE       LINE  SOURCE

00069A 107F       01498 	IORWF u_milers+1,W,0
00069C A4D8       01499 	BTFSS 0xFD8,Zero_,0
00069E D00C       01500 	BRA   m085
0006A0 507F       01501 	MOVF  cent,W,0
0006A2 107F       01502 	IORWF cent+1,W,0
0006A4 A4D8       01503 	BTFSS 0xFD8,Zero_,0
0006A6 D008       01504 	BRA   m085
0006A8 507F       01505 	MOVF  dec,W,0
0006AA A4D8       01506 	BTFSS 0xFD8,Zero_,0
0006AC D005       01507 	BRA   m085
0006AE B07F       01508 	BTFSC 0xF7F,bd,0
0006B0 D003       01509 	BRA   m085
0006B2 0E20       01510 	MOVLW 32
0006B4 6E7F       01511 	MOVWF dat,0
                  01512 			;				else dat = dec ;
0006B6 D002       01513 	BRA   m086
0006B8 CF7F FF7F  01514 m085	MOVFF dec,dat
                  01515 			;			}
                  01516 			;			if (xx == 5)
0006BC 0E05       01517 m086	MOVLW 5
0006BE 627F       01518 	CPFSEQ xx,0
0006C0 D00A       01519 	BRA   m089
                  01520 			;			{
                  01521 			;				if(!ndp) { if (dp==0) dat = '.';	
0006C2 B07F       01522 	BTFSC 0xF7F,ndp,0
0006C4 D007       01523 	BRA   m088
0006C6 B07F       01524 	BTFSC 0xF7F,dp,0
0006C8 D003       01525 	BRA   m087
0006CA 0E2E       01526 	MOVLW 46
0006CC 6E7F       01527 	MOVWF dat,0
                  01528 			;				           else xx++;
0006CE D003       01529 	BRA   m089
0006D0 2A7F       01530 m087	INCF  xx,1,0
                  01531 			;						 }
                  01532 			;				else xx++;		 
0006D2 D001       01533 	BRA   m089
0006D4 2A7F       01534 m088	INCF  xx,1,0
                  01535 			;			}
                  01536 			;			if (xx == 6) dat = unid;
0006D6 0E06       01537 m089	MOVLW 6
0006D8 627F       01538 	CPFSEQ xx,0
0006DA D002       01539 	BRA   m090
0006DC CF7F FF7F  01540 	MOVFF unid,dat
                  01541 			;						
                  01542 			;			if ((dat!='.')&&(dat!=' ')) dat = dat + 0x30;
0006E0 507F       01543 m090	MOVF  dat,W,0
0006E2 0A2E       01544 	XORLW 46
0006E4 B4D8       01545 	BTFSC 0xFD8,Zero_,0
0006E6 D006       01546 	BRA   m091
0006E8 507F       01547 	MOVF  dat,W,0
0006EA 0A20       01548 	XORLW 32
0006EC B4D8       01549 	BTFSC 0xFD8,Zero_,0
0006EE D002       01550 	BRA   m091
0006F0 0E30       01551 	MOVLW 48
0006F2 267F       01552 	ADDWF dat,1,0
                  01553 			;
                  01554 			;			PORTB.0 = dat.4;nop();
0006F4 A87F       01555 m091	BTFSS dat,4,0
0006F6 9081       01556 	BCF   PORTB,0,0
0006F8 B87F       01557 	BTFSC dat,4,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 27

ADDR   CODE       LINE  SOURCE

0006FA 8081       01558 	BSF   PORTB,0,0
0006FC 0000       01559 	NOP  
                  01560 			;			PORTB.1 = dat.5;nop();
0006FE AA7F       01561 	BTFSS dat,5,0
000700 9281       01562 	BCF   PORTB,1,0
000702 BA7F       01563 	BTFSC dat,5,0
000704 8281       01564 	BSF   PORTB,1,0
000706 0000       01565 	NOP  
                  01566 			;			PORTB.2 = dat.6;nop();
000708 AC7F       01567 	BTFSS dat,6,0
00070A 9481       01568 	BCF   PORTB,2,0
00070C BC7F       01569 	BTFSC dat,6,0
00070E 8481       01570 	BSF   PORTB,2,0
000710 0000       01571 	NOP  
                  01572 			;			PORTB.3 = dat.7;nop();
000712 AE7F       01573 	BTFSS dat,7,0
000714 9681       01574 	BCF   PORTB,3,0
000716 BE7F       01575 	BTFSC dat,7,0
000718 8681       01576 	BSF   PORTB,3,0
00071A 0000       01577 	NOP  
                  01578 			;			PORTB.4 = 1;  									// Modo dato.
00071C 8881       01579 	BSF   PORTB,4,0
                  01580 			;			retardo_20u ();
00071E DCED       01581 	RCALL retardo_20u
                  01582 			;			PORTB.5 = 1;  									// Breve pulso.
000720 8A81       01583 	BSF   PORTB,5,0
                  01584 			;			retardo_20u ();
000722 DCEB       01585 	RCALL retardo_20u
                  01586 			;			PORTB.5 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
000724 9A81       01587 	BCF   PORTB,5,0
                  01588 			;			for (i = 1; i <= 6; i++) retardo_20u ();
000726 0E01       01589 	MOVLW 1
000728 6E7F       01590 	MOVWF i_6,0
00072A 0E07       01591 m092	MOVLW 7
00072C 607F       01592 	CPFSLT i_6,0
00072E D003       01593 	BRA   m093
000730 DCE4       01594 	RCALL retardo_20u
000732 2A7F       01595 	INCF  i_6,1,0
000734 D7FA       01596 	BRA   m092
                  01597 			;			dat = swap (dat);
000736 3A7F       01598 m093	SWAPF dat,1,0
                  01599 			;			PORTB.0 = dat.4;nop();
000738 A87F       01600 	BTFSS dat,4,0
00073A 9081       01601 	BCF   PORTB,0,0
00073C B87F       01602 	BTFSC dat,4,0
00073E 8081       01603 	BSF   PORTB,0,0
000740 0000       01604 	NOP  
                  01605 			;			PORTB.1 = dat.5;nop();
000742 AA7F       01606 	BTFSS dat,5,0
000744 9281       01607 	BCF   PORTB,1,0
000746 BA7F       01608 	BTFSC dat,5,0
000748 8281       01609 	BSF   PORTB,1,0
00074A 0000       01610 	NOP  
                  01611 			;			PORTB.2 = dat.6;nop();
00074C AC7F       01612 	BTFSS dat,6,0
00074E 9481       01613 	BCF   PORTB,2,0
000750 BC7F       01614 	BTFSC dat,6,0
000752 8481       01615 	BSF   PORTB,2,0
000754 0000       01616 	NOP  
                  01617 			;			PORTB.3 = dat.7;
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 28

ADDR   CODE       LINE  SOURCE

000756 AE7F       01618 	BTFSS dat,7,0
000758 9681       01619 	BCF   PORTB,3,0
00075A BE7F       01620 	BTFSC dat,7,0
00075C 8681       01621 	BSF   PORTB,3,0
                  01622 			;			retardo_1m ();
00075E DCD7       01623 	RCALL retardo_1m
                  01624 			;			PORTB.4 = 1;  									// Modo dato.
000760 8881       01625 	BSF   PORTB,4,0
                  01626 			;			retardo_1m ();
000762 DCD5       01627 	RCALL retardo_1m
                  01628 			;			PORTB.5 = 1;  									// Breve pulso.
000764 8A81       01629 	BSF   PORTB,5,0
                  01630 			;			retardo_20u ();
000766 DCC9       01631 	RCALL retardo_20u
                  01632 			;			PORTB.5 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000768 9A81       01633 	BCF   PORTB,5,0
                  01634 			;			for (i = 1; i<= 6; i++) retardo_20u ();
00076A 0E01       01635 	MOVLW 1
00076C 6E7F       01636 	MOVWF i_6,0
00076E 0E07       01637 m094	MOVLW 7
000770 607F       01638 	CPFSLT i_6,0
000772 D003       01639 	BRA   m095
000774 DCC2       01640 	RCALL retardo_20u
000776 2A7F       01641 	INCF  i_6,1,0
000778 D7FA       01642 	BRA   m094
                  01643 			;			enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.			
00077A 0E0C       01644 m095	MOVLW 12
00077C DD31       01645 	RCALL enviar_comando
                  01646 			;		}
00077E 2A7F       01647 	INCF  xx,1,0
000780 D758       01648 	BRA   m077
                  01649 			;so:	//DESCON_LCD ();
                  01650 			;	return;
000782 0012       01651 m096	RETURN
                  01652 			;}
                  01653 			;
                  01654 			;void Enviar_uns16(char linea,char columna,uns16 dato){
                  01655 Enviar_uns16
                  01656 			;	//utilizaremos esta funcion en caso de necesitar un numero entero hasta 65536(16bits)
                  01657 			;	uns16 num, u_milers, cent, d_milers;
                  01658 			;	char dec, unid, resto1;
                  01659 			;	char i, xx, yy, dat,xy;
                  01660 			;
                  01661 			;	switch (linea) 									// (se resta una unidad a la coordenada lÌnea para que la posiciÛn colum
                           na inicial sea 1 y no 0).
000784 0100       01662 	MOVLB 0
000786 517C       01663 	MOVF  linea_4,W,1
000788 0A01       01664 	XORLW 1
00078A B4D8       01665 	BTFSC 0xFD8,Zero_,0
00078C D00A       01666 	BRA   m097
00078E 0A03       01667 	XORLW 3
000790 B4D8       01668 	BTFSC 0xFD8,Zero_,0
000792 D00C       01669 	BRA   m098
000794 0A01       01670 	XORLW 1
000796 B4D8       01671 	BTFSC 0xFD8,Zero_,0
000798 D00E       01672 	BRA   m099
00079A 0A07       01673 	XORLW 7
00079C B4D8       01674 	BTFSC 0xFD8,Zero_,0
00079E D010       01675 	BRA   m100
0007A0 D016       01676 	BRA   m101
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 29

ADDR   CODE       LINE  SOURCE

                  01677 			;		{
                  01678 			;			case 1:	enviar_comando (127 + columna); 	// inicio primera linea.
0007A2 0E7F       01679 m097	MOVLW 127
0007A4 0100       01680 	MOVLB 0
0007A6 257D       01681 	ADDWF columna_3,W,1
0007A8 DD1B       01682 	RCALL enviar_comando
                  01683 			;			break;	
0007AA D011       01684 	BRA   m101
                  01685 			;			case 2:	enviar_comando (191 + columna); 	// inicio segunda lÌnea.
0007AC 0EBF       01686 m098	MOVLW 191
0007AE 0100       01687 	MOVLB 0
0007B0 257D       01688 	ADDWF columna_3,W,1
0007B2 DD16       01689 	RCALL enviar_comando
                  01690 			;			break;			
0007B4 D00C       01691 	BRA   m101
                  01692 			;			case 3:	enviar_comando (147 + columna); 	// inicio tercera lÌnea (cursor en posiciÛn 20 de la primera lÌnea).
0007B6 0E93       01693 m099	MOVLW 147
0007B8 0100       01694 	MOVLB 0
0007BA 257D       01695 	ADDWF columna_3,W,1
0007BC DD11       01696 	RCALL enviar_comando
                  01697 			;			break;				
0007BE D007       01698 	BRA   m101
                  01699 			;			case 4:	enviar_comando (211 + columna); 	// inicio cuarta lÌnea (cursor en posiciÛn 20 de la segunda lÌnea).
0007C0 0ED3       01700 m100	MOVLW 211
0007C2 0100       01701 	MOVLB 0
0007C4 257D       01702 	ADDWF columna_3,W,1
0007C6 DD0C       01703 	RCALL enviar_comando
                  01704 			;			break;	
0007C8 D002       01705 	BRA   m101
                  01706 			;			enviar_comando (0b.0000.1100);			// pantalla encendida, sin cursor
0007CA 0E0C       01707 	MOVLW 12
0007CC DD09       01708 	RCALL enviar_comando
                  01709 			;		}				
                  01710 			;	
                  01711 			;			
                  01712 			;			num = dato; 
0007CE C07E F080  01713 m101	MOVFF dato_4,num_2
0007D2 C07F F081  01714 	MOVFF dato_4+1,num_2+1
                  01715 			;			d_milers =num/10000;
0007D6 0100       01716 	MOVLB 0
0007D8 5180       01717 	MOVF  num_2,W,1
0007DA 6F91       01718 	MOVWF C19tmp,1
0007DC 5181       01719 	MOVF  num_2+1,W,1
0007DE 6F92       01720 	MOVWF C19tmp+1,1
0007E0 6B93       01721 	CLRF  C20rem,1
0007E2 6B94       01722 	CLRF  C20rem+1,1
0007E4 0E10       01723 	MOVLW 16
0007E6 6F90       01724 	MOVWF C18cnt,1
0007E8 0100       01725 m102	MOVLB 0
0007EA 3791       01726 	RLCF  C19tmp,1,1
0007EC 3792       01727 	RLCF  C19tmp+1,1,1
0007EE 3793       01728 	RLCF  C20rem,1,1
0007F0 3794       01729 	RLCF  C20rem+1,1,1
0007F2 0E10       01730 	MOVLW 16
0007F4 5D93       01731 	SUBWF C20rem,W,1
0007F6 0E27       01732 	MOVLW 39
0007F8 5994       01733 	SUBWFB C20rem+1,W,1
0007FA A0D8       01734 	BTFSS 0xFD8,Carry,0
0007FC D006       01735 	BRA   m103
0007FE 0E10       01736 	MOVLW 16
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 30

ADDR   CODE       LINE  SOURCE

000800 0100       01737 	MOVLB 0
000802 5F93       01738 	SUBWF C20rem,1,1
000804 0E27       01739 	MOVLW 39
000806 5B94       01740 	SUBWFB C20rem+1,1,1
000808 80D8       01741 	BSF   0xFD8,Carry,0
00080A 0100       01742 m103	MOVLB 0
00080C 3786       01743 	RLCF  d_milers,1,1
00080E 3787       01744 	RLCF  d_milers+1,1,1
000810 2F90       01745 	DECFSZ C18cnt,1,1
000812 D7EA       01746 	BRA   m102
                  01747 			;			num= num%10000;
000814 5180       01748 	MOVF  num_2,W,1
000816 6F91       01749 	MOVWF C22tmp,1
000818 5181       01750 	MOVF  num_2+1,W,1
00081A 6F92       01751 	MOVWF C22tmp+1,1
00081C 6B80       01752 	CLRF  num_2,1
00081E 6B81       01753 	CLRF  num_2+1,1
000820 0E10       01754 	MOVLW 16
000822 6F90       01755 	MOVWF C21cnt,1
000824 0100       01756 m104	MOVLB 0
000826 3791       01757 	RLCF  C22tmp,1,1
000828 3792       01758 	RLCF  C22tmp+1,1,1
00082A 3780       01759 	RLCF  num_2,1,1
00082C 3781       01760 	RLCF  num_2+1,1,1
00082E 0E10       01761 	MOVLW 16
000830 5D80       01762 	SUBWF num_2,W,1
000832 0E27       01763 	MOVLW 39
000834 5981       01764 	SUBWFB num_2+1,W,1
000836 A0D8       01765 	BTFSS 0xFD8,Carry,0
000838 D005       01766 	BRA   m105
00083A 0E10       01767 	MOVLW 16
00083C 0100       01768 	MOVLB 0
00083E 5F80       01769 	SUBWF num_2,1,1
000840 0E27       01770 	MOVLW 39
000842 5B81       01771 	SUBWFB num_2+1,1,1
000844 0100       01772 m105	MOVLB 0
000846 2F90       01773 	DECFSZ C21cnt,1,1
000848 D7ED       01774 	BRA   m104
                  01775 			;			u_milers = num / 1000;
00084A 5180       01776 	MOVF  num_2,W,1
00084C 6F91       01777 	MOVWF C24tmp,1
00084E 5181       01778 	MOVF  num_2+1,W,1
000850 6F92       01779 	MOVWF C24tmp+1,1
000852 6B93       01780 	CLRF  C25rem,1
000854 6B94       01781 	CLRF  C25rem+1,1
000856 0E10       01782 	MOVLW 16
000858 6F90       01783 	MOVWF C23cnt,1
00085A 0100       01784 m106	MOVLB 0
00085C 3791       01785 	RLCF  C24tmp,1,1
00085E 3792       01786 	RLCF  C24tmp+1,1,1
000860 3793       01787 	RLCF  C25rem,1,1
000862 3794       01788 	RLCF  C25rem+1,1,1
000864 0EE8       01789 	MOVLW 232
000866 5D93       01790 	SUBWF C25rem,W,1
000868 0E03       01791 	MOVLW 3
00086A 5994       01792 	SUBWFB C25rem+1,W,1
00086C A0D8       01793 	BTFSS 0xFD8,Carry,0
00086E D006       01794 	BRA   m107
000870 0EE8       01795 	MOVLW 232
000872 0100       01796 	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 31

ADDR   CODE       LINE  SOURCE

000874 5F93       01797 	SUBWF C25rem,1,1
000876 0E03       01798 	MOVLW 3
000878 5B94       01799 	SUBWFB C25rem+1,1,1
00087A 80D8       01800 	BSF   0xFD8,Carry,0
00087C 0100       01801 m107	MOVLB 0
00087E 3782       01802 	RLCF  u_milers_2,1,1
000880 3783       01803 	RLCF  u_milers_2+1,1,1
000882 2F90       01804 	DECFSZ C23cnt,1,1
000884 D7EA       01805 	BRA   m106
                  01806 			;			dato = num % 1000;
000886 5180       01807 	MOVF  num_2,W,1
000888 6F91       01808 	MOVWF C27tmp,1
00088A 5181       01809 	MOVF  num_2+1,W,1
00088C 6F92       01810 	MOVWF C27tmp+1,1
00088E 6B7E       01811 	CLRF  dato_4,1
000890 6B7F       01812 	CLRF  dato_4+1,1
000892 0E10       01813 	MOVLW 16
000894 6F90       01814 	MOVWF C26cnt,1
000896 0100       01815 m108	MOVLB 0
000898 3791       01816 	RLCF  C27tmp,1,1
00089A 3792       01817 	RLCF  C27tmp+1,1,1
00089C 377E       01818 	RLCF  dato_4,1,1
00089E 377F       01819 	RLCF  dato_4+1,1,1
0008A0 0EE8       01820 	MOVLW 232
0008A2 5D7E       01821 	SUBWF dato_4,W,1
0008A4 0E03       01822 	MOVLW 3
0008A6 597F       01823 	SUBWFB dato_4+1,W,1
0008A8 A0D8       01824 	BTFSS 0xFD8,Carry,0
0008AA D005       01825 	BRA   m109
0008AC 0EE8       01826 	MOVLW 232
0008AE 0100       01827 	MOVLB 0
0008B0 5F7E       01828 	SUBWF dato_4,1,1
0008B2 0E03       01829 	MOVLW 3
0008B4 5B7F       01830 	SUBWFB dato_4+1,1,1
0008B6 0100       01831 m109	MOVLB 0
0008B8 2F90       01832 	DECFSZ C26cnt,1,1
0008BA D7ED       01833 	BRA   m108
                  01834 			;
                  01835 			;			cent   = dato   / 100;   	
0008BC 517E       01836 	MOVF  dato_4,W,1
0008BE 6F91       01837 	MOVWF C29tmp,1
0008C0 517F       01838 	MOVF  dato_4+1,W,1
0008C2 6F92       01839 	MOVWF C29tmp+1,1
0008C4 6B93       01840 	CLRF  C30rem,1
0008C6 0E10       01841 	MOVLW 16
0008C8 6F90       01842 	MOVWF C28cnt,1
0008CA 0100       01843 m110	MOVLB 0
0008CC 3791       01844 	RLCF  C29tmp,1,1
0008CE 3792       01845 	RLCF  C29tmp+1,1,1
0008D0 3793       01846 	RLCF  C30rem,1,1
0008D2 B0D8       01847 	BTFSC 0xFD8,Carry,0
0008D4 D004       01848 	BRA   m111
0008D6 0E64       01849 	MOVLW 100
0008D8 5D93       01850 	SUBWF C30rem,W,1
0008DA A0D8       01851 	BTFSS 0xFD8,Carry,0
0008DC D004       01852 	BRA   m112
0008DE 0E64       01853 m111	MOVLW 100
0008E0 0100       01854 	MOVLB 0
0008E2 5F93       01855 	SUBWF C30rem,1,1
0008E4 80D8       01856 	BSF   0xFD8,Carry,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 32

ADDR   CODE       LINE  SOURCE

0008E6 0100       01857 m112	MOVLB 0
0008E8 3784       01858 	RLCF  cent_2,1,1
0008EA 3785       01859 	RLCF  cent_2+1,1,1
0008EC 2F90       01860 	DECFSZ C28cnt,1,1
0008EE D7ED       01861 	BRA   m110
                  01862 			;			resto1 = dato   % 100;
0008F0 517E       01863 	MOVF  dato_4,W,1
0008F2 6F91       01864 	MOVWF C32tmp,1
0008F4 517F       01865 	MOVF  dato_4+1,W,1
0008F6 6F92       01866 	MOVWF C32tmp+1,1
0008F8 6B8A       01867 	CLRF  resto1_2,1
0008FA 0E10       01868 	MOVLW 16
0008FC 6F90       01869 	MOVWF C31cnt,1
0008FE 0100       01870 m113	MOVLB 0
000900 3791       01871 	RLCF  C32tmp,1,1
000902 3792       01872 	RLCF  C32tmp+1,1,1
000904 378A       01873 	RLCF  resto1_2,1,1
000906 B0D8       01874 	BTFSC 0xFD8,Carry,0
000908 D004       01875 	BRA   m114
00090A 0E64       01876 	MOVLW 100
00090C 5D8A       01877 	SUBWF resto1_2,W,1
00090E A0D8       01878 	BTFSS 0xFD8,Carry,0
000910 D003       01879 	BRA   m115
000912 0E64       01880 m114	MOVLW 100
000914 0100       01881 	MOVLB 0
000916 5F8A       01882 	SUBWF resto1_2,1,1
000918 0100       01883 m115	MOVLB 0
00091A 2F90       01884 	DECFSZ C31cnt,1,1
00091C D7F0       01885 	BRA   m113
                  01886 			;			dec    = resto1 /  10;  
00091E 518A       01887 	MOVF  resto1_2,W,1
000920 6F91       01888 	MOVWF C34tmp,1
000922 6B92       01889 	CLRF  C35rem,1
000924 0E08       01890 	MOVLW 8
000926 6F90       01891 	MOVWF C33cnt,1
000928 0100       01892 m116	MOVLB 0
00092A 3791       01893 	RLCF  C34tmp,1,1
00092C 3792       01894 	RLCF  C35rem,1,1
00092E 0E0A       01895 	MOVLW 10
000930 5D92       01896 	SUBWF C35rem,W,1
000932 A0D8       01897 	BTFSS 0xFD8,Carry,0
000934 D004       01898 	BRA   m117
000936 0E0A       01899 	MOVLW 10
000938 0100       01900 	MOVLB 0
00093A 5F92       01901 	SUBWF C35rem,1,1
00093C 80D8       01902 	BSF   0xFD8,Carry,0
00093E 0100       01903 m117	MOVLB 0
000940 3788       01904 	RLCF  dec_2,1,1
000942 2F90       01905 	DECFSZ C33cnt,1,1
000944 D7F1       01906 	BRA   m116
                  01907 			;			unid   = resto1 %  10; 		
000946 518A       01908 	MOVF  resto1_2,W,1
000948 6F91       01909 	MOVWF C37tmp,1
00094A 6B89       01910 	CLRF  unid_2,1
00094C 0E08       01911 	MOVLW 8
00094E 6F90       01912 	MOVWF C36cnt,1
000950 0100       01913 m118	MOVLB 0
000952 3791       01914 	RLCF  C37tmp,1,1
000954 3789       01915 	RLCF  unid_2,1,1
000956 0E0A       01916 	MOVLW 10
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 33

ADDR   CODE       LINE  SOURCE

000958 5D89       01917 	SUBWF unid_2,W,1
00095A A0D8       01918 	BTFSS 0xFD8,Carry,0
00095C D003       01919 	BRA   m119
00095E 0E0A       01920 	MOVLW 10
000960 0100       01921 	MOVLB 0
000962 5F89       01922 	SUBWF unid_2,1,1
000964 0100       01923 m119	MOVLB 0
000966 2F90       01924 	DECFSZ C36cnt,1,1
000968 D7F3       01925 	BRA   m118
                  01926 			;		// Envio
                  01927 			;		for (xx=0 ; xx < 5; xx++)
00096A 6B8C       01928 	CLRF  xx_2,1
00096C 0E05       01929 m120	MOVLW 5
00096E 0100       01930 	MOVLB 0
000970 618C       01931 	CPFSLT xx_2,1
000972 D0B4       01932 	BRA   m136
                  01933 			;		{
                  01934 			;			switch(xx){
000974 518C       01935 	MOVF  xx_2,W,1
000976 B4D8       01936 	BTFSC 0xFD8,Zero_,0
000978 D00D       01937 	BRA   m121
00097A 0A01       01938 	XORLW 1
00097C B4D8       01939 	BTFSC 0xFD8,Zero_,0
00097E D015       01940 	BRA   m123
000980 0A03       01941 	XORLW 3
000982 B4D8       01942 	BTFSC 0xFD8,Zero_,0
000984 D021       01943 	BRA   m125
000986 0A01       01944 	XORLW 1
000988 B4D8       01945 	BTFSC 0xFD8,Zero_,0
00098A D031       01946 	BRA   m127
00098C 0A07       01947 	XORLW 7
00098E B4D8       01948 	BTFSC 0xFD8,Zero_,0
000990 D044       01949 	BRA   m129
000992 D045       01950 	BRA   m130
                  01951 			;				case 0:
                  01952 			;					if (d_milers==0) dat = ' '; 
000994 0100       01953 m121	MOVLB 0
000996 5186       01954 	MOVF  d_milers,W,1
000998 1187       01955 	IORWF d_milers+1,W,1
00099A A4D8       01956 	BTFSS 0xFD8,Zero_,0
00099C D003       01957 	BRA   m122
00099E 0E20       01958 	MOVLW 32
0009A0 6F8E       01959 	MOVWF dat_2,1
                  01960 			;					else dat = d_milers;
0009A2 D03D       01961 	BRA   m130
0009A4 C086 F08E  01962 m122	MOVFF d_milers,dat_2
                  01963 			;					break;
0009A8 D03A       01964 	BRA   m130
                  01965 			;				case 1:
                  01966 			;					if ((u_milers==0)&&(d_milers==0)) dat = ' ';
0009AA 0100       01967 m123	MOVLB 0
0009AC 5182       01968 	MOVF  u_milers_2,W,1
0009AE 1183       01969 	IORWF u_milers_2+1,W,1
0009B0 A4D8       01970 	BTFSS 0xFD8,Zero_,0
0009B2 D007       01971 	BRA   m124
0009B4 5186       01972 	MOVF  d_milers,W,1
0009B6 1187       01973 	IORWF d_milers+1,W,1
0009B8 A4D8       01974 	BTFSS 0xFD8,Zero_,0
0009BA D003       01975 	BRA   m124
0009BC 0E20       01976 	MOVLW 32
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 34

ADDR   CODE       LINE  SOURCE

0009BE 6F8E       01977 	MOVWF dat_2,1
                  01978 			;					else dat = u_milers;
0009C0 D02E       01979 	BRA   m130
0009C2 C082 F08E  01980 m124	MOVFF u_milers_2,dat_2
                  01981 			;					break;
0009C6 D02B       01982 	BRA   m130
                  01983 			;				case 2:
                  01984 			;					if ((d_milers==0)&&(u_milers==0)&&(cent==0)) dat = ' '; 
0009C8 0100       01985 m125	MOVLB 0
0009CA 5186       01986 	MOVF  d_milers,W,1
0009CC 1187       01987 	IORWF d_milers+1,W,1
0009CE A4D8       01988 	BTFSS 0xFD8,Zero_,0
0009D0 D00B       01989 	BRA   m126
0009D2 5182       01990 	MOVF  u_milers_2,W,1
0009D4 1183       01991 	IORWF u_milers_2+1,W,1
0009D6 A4D8       01992 	BTFSS 0xFD8,Zero_,0
0009D8 D007       01993 	BRA   m126
0009DA 5184       01994 	MOVF  cent_2,W,1
0009DC 1185       01995 	IORWF cent_2+1,W,1
0009DE A4D8       01996 	BTFSS 0xFD8,Zero_,0
0009E0 D003       01997 	BRA   m126
0009E2 0E20       01998 	MOVLW 32
0009E4 6F8E       01999 	MOVWF dat_2,1
                  02000 			;					else dat = cent;
0009E6 D01B       02001 	BRA   m130
0009E8 C084 F08E  02002 m126	MOVFF cent_2,dat_2
                  02003 			;					break;
0009EC D018       02004 	BRA   m130
                  02005 			;				case 3:
                  02006 			;					if ((u_milers==0)&&(cent==0)&&(dec==0)&&(d_milers==0)) dat = ' ';
0009EE 0100       02007 m127	MOVLB 0
0009F0 5182       02008 	MOVF  u_milers_2,W,1
0009F2 1183       02009 	IORWF u_milers_2+1,W,1
0009F4 A4D8       02010 	BTFSS 0xFD8,Zero_,0
0009F6 D00E       02011 	BRA   m128
0009F8 5184       02012 	MOVF  cent_2,W,1
0009FA 1185       02013 	IORWF cent_2+1,W,1
0009FC A4D8       02014 	BTFSS 0xFD8,Zero_,0
0009FE D00A       02015 	BRA   m128
000A00 5388       02016 	MOVF  dec_2,1,1
000A02 A4D8       02017 	BTFSS 0xFD8,Zero_,0
000A04 D007       02018 	BRA   m128
000A06 5186       02019 	MOVF  d_milers,W,1
000A08 1187       02020 	IORWF d_milers+1,W,1
000A0A A4D8       02021 	BTFSS 0xFD8,Zero_,0
000A0C D003       02022 	BRA   m128
000A0E 0E20       02023 	MOVLW 32
000A10 6F8E       02024 	MOVWF dat_2,1
                  02025 			;					else dat = dec ;
000A12 D005       02026 	BRA   m130
000A14 C088 F08E  02027 m128	MOVFF dec_2,dat_2
                  02028 			;					break;
000A18 D002       02029 	BRA   m130
                  02030 			;				case 4:
                  02031 			;					dat = unid;
000A1A C089 F08E  02032 m129	MOVFF unid_2,dat_2
                  02033 			;					break;
                  02034 			;			}		
                  02035 			;			if (dat!=' ') dat = dat + 0x30;
000A1E 0100       02036 m130	MOVLB 0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 35

ADDR   CODE       LINE  SOURCE

000A20 518E       02037 	MOVF  dat_2,W,1
000A22 0A20       02038 	XORLW 32
000A24 B4D8       02039 	BTFSC 0xFD8,Zero_,0
000A26 D002       02040 	BRA   m131
000A28 0E30       02041 	MOVLW 48
000A2A 278E       02042 	ADDWF dat_2,1,1
                  02043 			;			PORTB.0 = dat.4;nop();
000A2C 0100       02044 m131	MOVLB 0
000A2E A98E       02045 	BTFSS dat_2,4,1
000A30 9081       02046 	BCF   PORTB,0,0
000A32 B98E       02047 	BTFSC dat_2,4,1
000A34 8081       02048 	BSF   PORTB,0,0
000A36 0000       02049 	NOP  
                  02050 			;			PORTB.1 = dat.5;nop();
000A38 AB8E       02051 	BTFSS dat_2,5,1
000A3A 9281       02052 	BCF   PORTB,1,0
000A3C BB8E       02053 	BTFSC dat_2,5,1
000A3E 8281       02054 	BSF   PORTB,1,0
000A40 0000       02055 	NOP  
                  02056 			;			PORTB.2 = dat.6;nop();
000A42 AD8E       02057 	BTFSS dat_2,6,1
000A44 9481       02058 	BCF   PORTB,2,0
000A46 BD8E       02059 	BTFSC dat_2,6,1
000A48 8481       02060 	BSF   PORTB,2,0
000A4A 0000       02061 	NOP  
                  02062 			;			PORTB.3 = dat.7;nop();
000A4C AF8E       02063 	BTFSS dat_2,7,1
000A4E 9681       02064 	BCF   PORTB,3,0
000A50 BF8E       02065 	BTFSC dat_2,7,1
000A52 8681       02066 	BSF   PORTB,3,0
000A54 0000       02067 	NOP  
                  02068 			;			PORTB.4 = 1;  									// Modo dato.
000A56 8881       02069 	BSF   PORTB,4,0
                  02070 			;			retardo_20u ();
000A58 EC7D F000  02071 	CALL  retardo_20u
                  02072 			;			PORTB.5 = 1;  									// Breve pulso.
000A5C 8A81       02073 	BSF   PORTB,5,0
                  02074 			;			retardo_20u ();
000A5E EC7D F000  02075 	CALL  retardo_20u
                  02076 			;			PORTB.5 = 0;									// Lo envia y saca por LCD; deshabilita LCD.
000A62 9A81       02077 	BCF   PORTB,5,0
                  02078 			;			for (i = 1; i <= 6; i++) retardo_20u ();
000A64 0E01       02079 	MOVLW 1
000A66 0100       02080 	MOVLB 0
000A68 6F8B       02081 	MOVWF i_7,1
000A6A 0E07       02082 m132	MOVLW 7
000A6C 0100       02083 	MOVLB 0
000A6E 618B       02084 	CPFSLT i_7,1
000A70 D005       02085 	BRA   m133
000A72 EC7D F000  02086 	CALL  retardo_20u
000A76 0100       02087 	MOVLB 0
000A78 2B8B       02088 	INCF  i_7,1,1
000A7A D7F7       02089 	BRA   m132
                  02090 			;			dat = swap (dat);
000A7C 0100       02091 m133	MOVLB 0
000A7E 3B8E       02092 	SWAPF dat_2,1,1
                  02093 			;			PORTB.0 = dat.4;nop();
000A80 A98E       02094 	BTFSS dat_2,4,1
000A82 9081       02095 	BCF   PORTB,0,0
000A84 B98E       02096 	BTFSC dat_2,4,1
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 36

ADDR   CODE       LINE  SOURCE

000A86 8081       02097 	BSF   PORTB,0,0
000A88 0000       02098 	NOP  
                  02099 			;			PORTB.1 = dat.5;nop();
000A8A AB8E       02100 	BTFSS dat_2,5,1
000A8C 9281       02101 	BCF   PORTB,1,0
000A8E BB8E       02102 	BTFSC dat_2,5,1
000A90 8281       02103 	BSF   PORTB,1,0
000A92 0000       02104 	NOP  
                  02105 			;			PORTB.2 = dat.6;nop();
000A94 AD8E       02106 	BTFSS dat_2,6,1
000A96 9481       02107 	BCF   PORTB,2,0
000A98 BD8E       02108 	BTFSC dat_2,6,1
000A9A 8481       02109 	BSF   PORTB,2,0
000A9C 0000       02110 	NOP  
                  02111 			;			PORTB.3 = dat.7;
000A9E AF8E       02112 	BTFSS dat_2,7,1
000AA0 9681       02113 	BCF   PORTB,3,0
000AA2 BF8E       02114 	BTFSC dat_2,7,1
000AA4 8681       02115 	BSF   PORTB,3,0
                  02116 			;			retardo_1m ();
000AA6 EC87 F000  02117 	CALL  retardo_1m
                  02118 			;			PORTB.4 = 1;  									// Modo dato.
000AAA 8881       02119 	BSF   PORTB,4,0
                  02120 			;			retardo_1m ();
000AAC EC87 F000  02121 	CALL  retardo_1m
                  02122 			;			PORTB.5 = 1;  									// Breve pulso.
000AB0 8A81       02123 	BSF   PORTB,5,0
                  02124 			;			retardo_20u ();
000AB2 EC7D F000  02125 	CALL  retardo_20u
                  02126 			;			PORTB.5 = 0; 									// Lo envia y saca por LCD; deshabilita LCD.
000AB6 9A81       02127 	BCF   PORTB,5,0
                  02128 			;			for (i = 1; i<= 6; i++) retardo_20u ();
000AB8 0E01       02129 	MOVLW 1
000ABA 0100       02130 	MOVLB 0
000ABC 6F8B       02131 	MOVWF i_7,1
000ABE 0E07       02132 m134	MOVLW 7
000AC0 0100       02133 	MOVLB 0
000AC2 618B       02134 	CPFSLT i_7,1
000AC4 D005       02135 	BRA   m135
000AC6 EC7D F000  02136 	CALL  retardo_20u
000ACA 0100       02137 	MOVLB 0
000ACC 2B8B       02138 	INCF  i_7,1,1
000ACE D7F7       02139 	BRA   m134
                  02140 			;			enviar_comando (0b.0000.1100);					// Pantalla encendida, sin cursor.			
000AD0 0E0C       02141 m135	MOVLW 12
000AD2 ECF0 F000  02142 	CALL  enviar_comando
                  02143 			;		}
000AD6 0100       02144 	MOVLB 0
000AD8 2B8C       02145 	INCF  xx_2,1,1
000ADA D748       02146 	BRA   m120
                  02147 			;
                  02148 			;	return;
000ADC 0012       02149 m136	RETURN
                  02150 			;
                  02151 			;}
                  02152 			;
                  02153 			;//***********************************************************************************************
                  02154 			;//***********************************************************************************************
                  02155 			;// Definicio caracter especial : PROCES  -> posar x, on volguem el pixel ,pes 16 8 4 2 1  Rtat Hexa
                  02156 			;//                         -  contar pesos ( veure exple, per Ah)             ° °x°x° ° ° 0x0C
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 37

ADDR   CODE       LINE  SOURCE

                  02157 			;//                             -  de dalt a baix, es el codi a posar          °x° ° °x° ° 0x12
                  02158 			;//                                                en el vector.               °x°x°x°x° ° 0x1E
                  02159 			;//                   - Al inici cridar funcio per ecriure CGRAM               °x° ° °x° ° 0x12
                  02160 			;//                    - Hi caben 8 carac especials de 64 a 120                ° ° °x° ° ° 0x00
                  02161 			;//                       de 8 e 8,  64 , 72, 80, 88, 96,104.112,120           ° ° °x°x°x° 0x04
                  02162 			;//                   - Despres d'escriure la CGRAM, cal fer un                ° ° °x° °x° 0x07
                  02163 			;//                     comando, per no apuntar a la CGRAM                     ° ° °x° °x° 0x05
                  02164 			;// Per escriure simbol .... fer :   enviar_literal(3);enviar_literal(4);
                  02165 			;//************IMPORTANTE****************************************
                  02166 			;//******Poner despues de inicializar_lcd();*********************
                  02167 			;void RAM_LCD (void)
                  02168 			;{
                  02169 RAM_LCD
                  02170 			;	static const char Carac_1[] = {0x0C,0x10,0x08,0x04,0x1B,0x04,0x04,0x03};//caracter micro 	//escribir_literal(0);
                  02171 			;	static const char Carac_2[] = {0xEE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};	//escribir_literal(1); BAT_FULL
                  02172 			;	static const char Carac_3[] = {0xEE,0xFF,0xF1,0xFF,0xFF,0xFF,0xFF,0xFF};	// ""...               BAT_75
                  02173 			;	static const char Carac_4[] = {0xEE,0xFF,0xF1,0xF1,0xFF,0xFF,0xFF,0xFF};					    // BAT_50
                  02174 			;	static const char Carac_5[] = {0xEE,0xFF,0xF1,0xF1,0xF1,0xFF,0xFF,0xFF};					    // BAT_25
                  02175 			;	static const char Carac_6[] = {0xEE,0xFF,0xF1,0xF1,0xF1,0xF1,0xFF,0xFF};					    // BAT_10
                  02176 			;	static const char Carac_7[] = {0xEE,0xFF,0xF1,0xF1,0xF1,0xF1,0xF1,0xFF};					    // BAT_LW
                  02177 			;	static const char Carac_8[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
                  02178 			;	// 1era posicio CGRAM es la 64 , 72, 80, 88, 96,104.112,120
                  02179 			;	char i;
                  02180 			;	
                  02181 			;	enviar_comando (64);// primera posicio del Carac_1, els altres seran consecutius
000ADE 0E40       02182 	MOVLW 64
000AE0 ECF0 F000  02183 	CALL  enviar_comando
                  02184 			;	retardo_20u ();
000AE4 EC7D F000  02185 	CALL  retardo_20u
                  02186 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_1[i]); retardo_20u (); retardo_20u ();}
000AE8 0100       02187 	MOVLB 0
000AEA 6B7B       02188 	CLRF  i_8,1
000AEC 0E08       02189 m137	MOVLW 8
000AEE 0100       02190 	MOVLB 0
000AF0 617B       02191 	CPFSLT i_8,1
000AF2 D00C       02192 	BRA   m138
000AF4 0E1A       02193 	MOVLW 26
000AF6 257B       02194 	ADDWF i_8,W,1
000AF8 DAF0       02195 	RCALL _const1
000AFA EC2B F001  02196 	CALL  enviar_literal
000AFE EC7D F000  02197 	CALL  retardo_20u
000B02 EC7D F000  02198 	CALL  retardo_20u
000B06 0100       02199 	MOVLB 0
000B08 2B7B       02200 	INCF  i_8,1,1
000B0A D7F0       02201 	BRA   m137
                  02202 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_2[i]); retardo_20u (); retardo_20u ();}
000B0C 0100       02203 m138	MOVLB 0
000B0E 6B7B       02204 	CLRF  i_8,1
000B10 0E08       02205 m139	MOVLW 8
000B12 0100       02206 	MOVLB 0
000B14 617B       02207 	CPFSLT i_8,1
000B16 D00C       02208 	BRA   m140
000B18 0E22       02209 	MOVLW 34
000B1A 257B       02210 	ADDWF i_8,W,1
000B1C DADE       02211 	RCALL _const1
000B1E EC2B F001  02212 	CALL  enviar_literal
000B22 EC7D F000  02213 	CALL  retardo_20u
000B26 EC7D F000  02214 	CALL  retardo_20u
000B2A 0100       02215 	MOVLB 0
000B2C 2B7B       02216 	INCF  i_8,1,1
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 38

ADDR   CODE       LINE  SOURCE

000B2E D7F0       02217 	BRA   m139
                  02218 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_3[i]); retardo_20u (); retardo_20u ();}
000B30 0100       02219 m140	MOVLB 0
000B32 6B7B       02220 	CLRF  i_8,1
000B34 0E08       02221 m141	MOVLW 8
000B36 0100       02222 	MOVLB 0
000B38 617B       02223 	CPFSLT i_8,1
000B3A D00C       02224 	BRA   m142
000B3C 0E2A       02225 	MOVLW 42
000B3E 257B       02226 	ADDWF i_8,W,1
000B40 DACC       02227 	RCALL _const1
000B42 EC2B F001  02228 	CALL  enviar_literal
000B46 EC7D F000  02229 	CALL  retardo_20u
000B4A EC7D F000  02230 	CALL  retardo_20u
000B4E 0100       02231 	MOVLB 0
000B50 2B7B       02232 	INCF  i_8,1,1
000B52 D7F0       02233 	BRA   m141
                  02234 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_4[i]); retardo_20u (); retardo_20u ();}
000B54 0100       02235 m142	MOVLB 0
000B56 6B7B       02236 	CLRF  i_8,1
000B58 0E08       02237 m143	MOVLW 8
000B5A 0100       02238 	MOVLB 0
000B5C 617B       02239 	CPFSLT i_8,1
000B5E D00C       02240 	BRA   m144
000B60 0E32       02241 	MOVLW 50
000B62 257B       02242 	ADDWF i_8,W,1
000B64 DABA       02243 	RCALL _const1
000B66 EC2B F001  02244 	CALL  enviar_literal
000B6A EC7D F000  02245 	CALL  retardo_20u
000B6E EC7D F000  02246 	CALL  retardo_20u
000B72 0100       02247 	MOVLB 0
000B74 2B7B       02248 	INCF  i_8,1,1
000B76 D7F0       02249 	BRA   m143
                  02250 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_5[i]); retardo_20u (); retardo_20u ();}
000B78 0100       02251 m144	MOVLB 0
000B7A 6B7B       02252 	CLRF  i_8,1
000B7C 0E08       02253 m145	MOVLW 8
000B7E 0100       02254 	MOVLB 0
000B80 617B       02255 	CPFSLT i_8,1
000B82 D00C       02256 	BRA   m146
000B84 0E3A       02257 	MOVLW 58
000B86 257B       02258 	ADDWF i_8,W,1
000B88 DAA8       02259 	RCALL _const1
000B8A EC2B F001  02260 	CALL  enviar_literal
000B8E EC7D F000  02261 	CALL  retardo_20u
000B92 EC7D F000  02262 	CALL  retardo_20u
000B96 0100       02263 	MOVLB 0
000B98 2B7B       02264 	INCF  i_8,1,1
000B9A D7F0       02265 	BRA   m145
                  02266 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_6[i]); retardo_20u (); retardo_20u ();}
000B9C 0100       02267 m146	MOVLB 0
000B9E 6B7B       02268 	CLRF  i_8,1
000BA0 0E08       02269 m147	MOVLW 8
000BA2 0100       02270 	MOVLB 0
000BA4 617B       02271 	CPFSLT i_8,1
000BA6 D00C       02272 	BRA   m148
000BA8 0E42       02273 	MOVLW 66
000BAA 257B       02274 	ADDWF i_8,W,1
000BAC DA96       02275 	RCALL _const1
000BAE EC2B F001  02276 	CALL  enviar_literal
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 39

ADDR   CODE       LINE  SOURCE

000BB2 EC7D F000  02277 	CALL  retardo_20u
000BB6 EC7D F000  02278 	CALL  retardo_20u
000BBA 0100       02279 	MOVLB 0
000BBC 2B7B       02280 	INCF  i_8,1,1
000BBE D7F0       02281 	BRA   m147
                  02282 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_7[i]); retardo_20u (); retardo_20u ();}
000BC0 0100       02283 m148	MOVLB 0
000BC2 6B7B       02284 	CLRF  i_8,1
000BC4 0E08       02285 m149	MOVLW 8
000BC6 0100       02286 	MOVLB 0
000BC8 617B       02287 	CPFSLT i_8,1
000BCA D00C       02288 	BRA   m150
000BCC 0E4A       02289 	MOVLW 74
000BCE 257B       02290 	ADDWF i_8,W,1
000BD0 DA84       02291 	RCALL _const1
000BD2 EC2B F001  02292 	CALL  enviar_literal
000BD6 EC7D F000  02293 	CALL  retardo_20u
000BDA EC7D F000  02294 	CALL  retardo_20u
000BDE 0100       02295 	MOVLB 0
000BE0 2B7B       02296 	INCF  i_8,1,1
000BE2 D7F0       02297 	BRA   m149
                  02298 			;	for(i=0;i<=7;i++) { enviar_literal (Carac_8[i]); retardo_20u (); retardo_20u ();}	
000BE4 0100       02299 m150	MOVLB 0
000BE6 6B7B       02300 	CLRF  i_8,1
000BE8 0E08       02301 m151	MOVLW 8
000BEA 0100       02302 	MOVLB 0
000BEC 617B       02303 	CPFSLT i_8,1
000BEE D00C       02304 	BRA   m152
000BF0 0E52       02305 	MOVLW 82
000BF2 257B       02306 	ADDWF i_8,W,1
000BF4 DA72       02307 	RCALL _const1
000BF6 EC2B F001  02308 	CALL  enviar_literal
000BFA EC7D F000  02309 	CALL  retardo_20u
000BFE EC7D F000  02310 	CALL  retardo_20u
000C02 0100       02311 	MOVLB 0
000C04 2B7B       02312 	INCF  i_8,1,1
000C06 D7F0       02313 	BRA   m151
                  02314 			;	enviar_comando (0b.0000.0010);
000C08 0E02       02315 m152	MOVLW 2
000C0A EFF0 F000  02316 	GOTO  enviar_comando
                  02317 			;	
                  02318 			;	return;
                  02319 
                  02320   ; FILE medir_18F4XK20.h
                  02321 			;/*funci√≥n void medir (char, char)
                  02322 			;recibe como par√°metros:
                  02323 			;Primer par√°metro: el canal A/D a convertir  (0...4,8...13) . Si est√° fuera del rango, toma 0 por defecto
                  02324 			;Segundo par√°metro: solo admite 8 o 10 (bits del resultado). si el par√°metro no es 8 o 10,
                  02325 			;interpreta autom√°ticamente a 10.
                  02326 			;Siempre. se configura autom√°ticamente la entrada anal√≥gica solicitada. Fosc/32
                  02327 			;Requiere la funci√≥n retardo_20u()  (en retardos.h)
                  02328 			;resultado: en ADRESH:ADRESL
                  02329 			;*/
                  02330 			;uns16 medir (char canal, char bits)
                  02331 			;{
                  02332 medir
000C0E 0100       02333 	MOVLB 0
000C10 6F7D       02334 	MOVWF bits,1
                  02335 			;	uns16 resultado;
                  02336 			;	switch (canal)
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 40

ADDR   CODE       LINE  SOURCE

000C12 517C       02337 	MOVF  canal,W,1
000C14 B4D8       02338 	BTFSC 0xFD8,Zero_,0
000C16 D028       02339 	BRA   m153
000C18 0A01       02340 	XORLW 1
000C1A B4D8       02341 	BTFSC 0xFD8,Zero_,0
000C1C D028       02342 	BRA   m154
000C1E 0A03       02343 	XORLW 3
000C20 B4D8       02344 	BTFSC 0xFD8,Zero_,0
000C22 D028       02345 	BRA   m155
000C24 0A01       02346 	XORLW 1
000C26 B4D8       02347 	BTFSC 0xFD8,Zero_,0
000C28 D028       02348 	BRA   m156
000C2A 0A07       02349 	XORLW 7
000C2C B4D8       02350 	BTFSC 0xFD8,Zero_,0
000C2E D028       02351 	BRA   m157
000C30 0A01       02352 	XORLW 1
000C32 B4D8       02353 	BTFSC 0xFD8,Zero_,0
000C34 D028       02354 	BRA   m158
000C36 0A03       02355 	XORLW 3
000C38 B4D8       02356 	BTFSC 0xFD8,Zero_,0
000C3A D028       02357 	BRA   m159
000C3C 0A01       02358 	XORLW 1
000C3E B4D8       02359 	BTFSC 0xFD8,Zero_,0
000C40 D028       02360 	BRA   m160
000C42 0A0F       02361 	XORLW 15
000C44 B4D8       02362 	BTFSC 0xFD8,Zero_,0
000C46 D028       02363 	BRA   m161
000C48 0A01       02364 	XORLW 1
000C4A B4D8       02365 	BTFSC 0xFD8,Zero_,0
000C4C D028       02366 	BRA   m162
000C4E 0A03       02367 	XORLW 3
000C50 B4D8       02368 	BTFSC 0xFD8,Zero_,0
000C52 D028       02369 	BRA   m163
000C54 0A01       02370 	XORLW 1
000C56 B4D8       02371 	BTFSC 0xFD8,Zero_,0
000C58 D028       02372 	BRA   m164
000C5A 0A07       02373 	XORLW 7
000C5C B4D8       02374 	BTFSC 0xFD8,Zero_,0
000C5E D028       02375 	BRA   m165
000C60 0A01       02376 	XORLW 1
000C62 B4D8       02377 	BTFSC 0xFD8,Zero_,0
000C64 D028       02378 	BRA   m166
000C66 D02A       02379 	BRA   m167
                  02380 			;	{
                  02381 			;		//del 0 al 4, est√°n en el PORTA
                  02382 			;		case 0: 	ADCON0 = 0b.00.0000.01;		break;
000C68 0E01       02383 m153	MOVLW 1
000C6A 6EC2       02384 	MOVWF ADCON0,0
000C6C D029       02385 	BRA   m168
                  02386 			;		case 1:		ADCON0 = 0b.00.0001.01;		break;
000C6E 0E05       02387 m154	MOVLW 5
000C70 6EC2       02388 	MOVWF ADCON0,0
000C72 D026       02389 	BRA   m168
                  02390 			;		case 2:		ADCON0 = 0b.00.0010.01;		break;
000C74 0E09       02391 m155	MOVLW 9
000C76 6EC2       02392 	MOVWF ADCON0,0
000C78 D023       02393 	BRA   m168
                  02394 			;		case 3:		ADCON0 = 0b.00.0011.01;		break;
000C7A 0E0D       02395 m156	MOVLW 13
000C7C 6EC2       02396 	MOVWF ADCON0,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 41

ADDR   CODE       LINE  SOURCE

000C7E D020       02397 	BRA   m168
                  02398 			;		case 4:		ADCON0 = 0b.00.0100.01;		break;
000C80 0E11       02399 m157	MOVLW 17
000C82 6EC2       02400 	MOVWF ADCON0,0
000C84 D01D       02401 	BRA   m168
                  02402 			;		case 5:		ADCON0 = 0b.00.0101.01;		break;
000C86 0E15       02403 m158	MOVLW 21
000C88 6EC2       02404 	MOVWF ADCON0,0
000C8A D01A       02405 	BRA   m168
                  02406 			;		case 6:		ADCON0 = 0b.00.0110.01;		break;
000C8C 0E19       02407 m159	MOVLW 25
000C8E 6EC2       02408 	MOVWF ADCON0,0
000C90 D017       02409 	BRA   m168
                  02410 			;		case 7:		ADCON0 = 0b.00.0111.01;		break;
000C92 0E1D       02411 m160	MOVLW 29
000C94 6EC2       02412 	MOVWF ADCON0,0
000C96 D014       02413 	BRA   m168
                  02414 			;		case 8:		ADCON0 = 0b.00.1000.01;		break;
000C98 0E21       02415 m161	MOVLW 33
000C9A 6EC2       02416 	MOVWF ADCON0,0
000C9C D011       02417 	BRA   m168
                  02418 			;		case 9:		ADCON0 = 0b.00.1001.01;		break;
000C9E 0E25       02419 m162	MOVLW 37
000CA0 6EC2       02420 	MOVWF ADCON0,0
000CA2 D00E       02421 	BRA   m168
                  02422 			;		case 10:	ADCON0 = 0b.00.1010.01;		break;
000CA4 0E29       02423 m163	MOVLW 41
000CA6 6EC2       02424 	MOVWF ADCON0,0
000CA8 D00B       02425 	BRA   m168
                  02426 			;		case 11:	ADCON0 = 0b.00.1011.01;		break;
000CAA 0E2D       02427 m164	MOVLW 45
000CAC 6EC2       02428 	MOVWF ADCON0,0
000CAE D008       02429 	BRA   m168
                  02430 			;		case 12:	ADCON0 = 0b.00.1100.01;		break;
000CB0 0E31       02431 m165	MOVLW 49
000CB2 6EC2       02432 	MOVWF ADCON0,0
000CB4 D005       02433 	BRA   m168
                  02434 			;		case 13:	ADCON0 = 0b.00.1101.01;		break;
000CB6 0E35       02435 m166	MOVLW 53
000CB8 6EC2       02436 	MOVWF ADCON0,0
000CBA D002       02437 	BRA   m168
                  02438 			;		default:	ADCON0 = 0b.00.0000.01;
000CBC 0E01       02439 m167	MOVLW 1
000CBE 6EC2       02440 	MOVWF ADCON0,0
                  02441 			;	}
                  02442 			;	if (bits == 8){ADFM=0;GO = 1;  while(GO);resultado = ADRESH;}
000CC0 0E08       02443 m168	MOVLW 8
000CC2 0100       02444 	MOVLB 0
000CC4 637D       02445 	CPFSEQ bits,1
000CC6 D009       02446 	BRA   m170
000CC8 9EC0       02447 	BCF   0xFC0,ADFM,0
000CCA 82C2       02448 	BSF   0xFC2,GO,0
000CCC B2C2       02449 m169	BTFSC 0xFC2,GO,0
000CCE D7FE       02450 	BRA   m169
000CD0 CFC4 F07E  02451 	MOVFF ADRESH,resultado
000CD4 0100       02452 	MOVLB 0
000CD6 6B7F       02453 	CLRF  resultado+1,1
                  02454 			;	else 		  {ADFM=1;GO = 1;  while(GO);resultado.low8 = ADRESL;resultado.high8 = ADRESH;}
000CD8 D008       02455 	BRA   m172
000CDA 8EC0       02456 m170	BSF   0xFC0,ADFM,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 42

ADDR   CODE       LINE  SOURCE

000CDC 82C2       02457 	BSF   0xFC2,GO,0
000CDE B2C2       02458 m171	BTFSC 0xFC2,GO,0
000CE0 D7FE       02459 	BRA   m171
000CE2 CFC3 F07E  02460 	MOVFF ADRESL,resultado
000CE6 CFC4 F07F  02461 	MOVFF ADRESH,resultado+1
                  02462 			;   	
                  02463 			;   	return resultado;
000CEA 0100       02464 m172	MOVLB 0
000CEC 517E       02465 	MOVF  resultado,W,1
000CEE 0012       02466 	RETURN
                  02467 
                  02468   ; FILE ondulador_migrado.c
                  02469 			;
                  02470 			;//==============================================================================================
                  02471 			;#include "Temporiz_64Mhz.h"
                  02472 			;void configuraPic (void);
                  02473 			;void configura1_PWM (void); 				// Configura todos los pr√°metros excepto M.
                  02474 			;uns8 lectura_VAC (void);
                  02475 			;	
                  02476 			;#include "LCD_4bit.h"
                  02477 			;#include "medir_18F4XK20.h"
                  02478 			;
                  02479 			;static const char mensaje1[19] ="ONDULADOR 50HZ  by ";
                  02480 			;static const char mensaje2[7] ="ESTADO:";
                  02481 			;static const char mensaje3[5] ="VMAX:";
                  02482 			;static const char mensaje4[13] ="LECTURAS_VAC:";
                  02483 			;static const char ref [6] = {100,100,100,100,100,100};
                  02484 			;//==============================================================================================
                  02485 			;//==============================================================================================
                  02486 			;
                  02487 			;void main (void)
                  02488 			;{
                  02489 main
                  02490 			;
                  02491 			;	GIE = 0;								// Desactivamos inicialmente todas las interrupciones.
000CF0 9EF2       02492 	BCF   0xFF2,GIE,0
                  02493 			;	configuraPic (); 						// Configuramos todos los puertos y PWM
000CF2 D9DD       02494 	RCALL configuraPic
                  02495 			;	
                  02496 			;	T0CON   = 0b.01000.001; //(PIC 18F4550)	// Equivale junto con INTCON2 al OPTION_REG del 16F88x).							
                           	
000CF4 0E41       02497 	MOVLW 65
000CF6 6ED5       02498 	MOVWF T0CON,0
                  02499 			;	INTCON2 = 0b.0000.0100; //(PIC 18F4550)	// Equivale junto con T0CON al OPTION_REG del 16F88x).	
000CF8 0E04       02500 	MOVLW 4
000CFA 6EF1       02501 	MOVWF INTCON2,0
                  02502 			;	TMR0IF = 0;   //T0IF = 0; (PIC 16F88x)	// Ponemos el flanco de interrupciones a cero (aun no se ha efectuado ninguna).
000CFC 94F2       02503 	BCF   0xFF2,TMR0IF,0
                  02504 			;   // w1   =   0;								// Reseteamos la variable √≠ndice de la tabla.
                  02505 			;	LATD.0 =0;            Vmax = 2; //2 el pwm maximo en 
000CFE 908C       02506 	BCF   LATD,0,0
000D00 0E02       02507 	MOVLW 2
000D02 0100       02508 	MOVLB 0
000D04 6F98       02509 	MOVWF Vmax,1
000D06 6B99       02510 	CLRF  Vmax+1,1
                  02511 			;
                  02512 			;	
                  02513 			;	INTCON = 0b.0100.0000;				// Interrupciones globales (bit 7) e interrupci√≥n por Timer0 (bit 5) activadas.
000D08 0E40       02514 	MOVLW 64
000D0A 6EF2       02515 	MOVWF INTCON,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 43

ADDR   CODE       LINE  SOURCE

                  02516 			;
                  02517 			;	// COMEN√áO AL PAS PER 0, AMB 2 CICLES DE PWM A Ton=0 --> SON 100uS
                  02518 			;	T=0; ancho_pwm =0; bUdw=1;	// Comen√ßo carregant 0
000D0C 6B9B       02519 	CLRF  T,1
000D0E 6B96       02520 	CLRF  ancho_pwm,1
000D10 6B97       02521 	CLRF  ancho_pwm+1,1
000D12 8195       02522 	BSF   0x95,bUdw,1
                  02523 			;	for (i = 1; i <= 6; i ++)  ancho_pwm = rl (ancho_pwm);
000D14 0E01       02524 	MOVLW 1
000D16 6F9C       02525 	MOVWF i,1
000D18 0E07       02526 m173	MOVLW 7
000D1A 0100       02527 	MOVLB 0
000D1C 619C       02528 	CPFSLT i,1
000D1E D004       02529 	BRA   m174
000D20 3796       02530 	RLCF  ancho_pwm,1,1
000D22 3797       02531 	RLCF  ancho_pwm+1,1,1
000D24 2B9C       02532 	INCF  i,1,1
000D26 D7F8       02533 	BRA   m173
                  02534 			;	CCPR1L    = ancho_pwm.high8;	CCP1CON.5 = ancho_pwm.7;	CCP1CON.4 = ancho_pwm.6; // PWM carregat a 0
000D28 C097 FFBE  02535 m174	MOVFF ancho_pwm+1,CCPR1L
000D2C 0100       02536 	MOVLB 0
000D2E AF96       02537 	BTFSS ancho_pwm,7,1
000D30 9ABD       02538 	BCF   CCP1CON,5,0
000D32 BF96       02539 	BTFSC ancho_pwm,7,1
000D34 8ABD       02540 	BSF   CCP1CON,5,0
000D36 AD96       02541 	BTFSS ancho_pwm,6,1
000D38 98BD       02542 	BCF   CCP1CON,4,0
000D3A BD96       02543 	BTFSC ancho_pwm,6,1
000D3C 88BD       02544 	BSF   CCP1CON,4,0
                  02545 			;	TMR2IF=0;	TMR2IE=1;	GIE=1; TMR2ON  = 1;
000D3E 929E       02546 	BCF   0xF9E,TMR2IF,0
000D40 829D       02547 	BSF   0xF9D,TMR2IE,0
000D42 8EF2       02548 	BSF   0xFF2,GIE,0
000D44 84CA       02549 	BSF   0xFCA,TMR2ON,0
                  02550 			;	T++; SENO = sen[T];		ancho_pwm = (uns16)SENO*Vmax; // PREPARO SEGUENT VALOR
000D46 2B9B       02551 	INCF  T,1,1
000D48 519B       02552 	MOVF  T,W,1
000D4A D9C7       02553 	RCALL _const1
000D4C 0100       02554 	MOVLB 0
000D4E 6F9A       02555 	MOVWF SENO,1
000D50 519A       02556 	MOVF  SENO,W,1
000D52 0398       02557 	MULWF Vmax,1
000D54 CFF3 F096  02558 	MOVFF PRODL,ancho_pwm
000D58 CFF4 F097  02559 	MOVFF PRODH,ancho_pwm+1
000D5C 519A       02560 	MOVF  SENO,W,1
000D5E 0399       02561 	MULWF Vmax+1,1
000D60 50F3       02562 	MOVF  PRODL,W,0
000D62 2797       02563 	ADDWF ancho_pwm+1,1,1
                  02564 			; //**************************************************************************************//
                  02565 			; //*******************  V A R I A B L E S   L O C A L E L E S ***************************//
                  02566 			; //**************************************************************************************//
                  02567 			;	estado=0; //empieza por estado 0
000D64 6B9D       02568 	CLRF  estado,1
                  02569 			;	uns8 x;
                  02570 			;	char vac[6];
                  02571 			;	char ac,rf,dif,vbat,o=0; //variables para guardar temporalmente las arrays
000D66 6B77       02572 	CLRF  o,1
                  02573 			;	bit a,b,c,vuelta=0;
000D68 977A       02574 	BCF   0x7A,vuelta,1
                  02575 			;
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 44

ADDR   CODE       LINE  SOURCE

                  02576 			;
                  02577 			;	OSCTUNE=0b.01.000000; //PLL enable 
000D6A 0E40       02578 	MOVLW 64
000D6C 6E9B       02579 	MOVWF OSCTUNE,0
                  02580 			;	
                  02581 			;	RCON = 0b.01111111; //C18 pag 80 i 167  Causes del RESET i IPEN (priority Enabled o no)
000D6E 0E7F       02582 	MOVLW 127
000D70 6ED0       02583 	MOVWF RCON,0
                  02584 			;	OSCCON    = 0b.0.111.0.0.00;
000D72 0E70       02585 	MOVLW 112
000D74 6ED3       02586 	MOVWF OSCCON,0
                  02587 			;
                  02588 			;	inicializar_lcd(); 
000D76 ECCA F001  02589 	CALL  inicializar_lcd
                  02590 			;	borrar_lcd();
000D7A EC51 F002  02591 	CALL  borrar_lcd
                  02592 			;	retardo_100m();
000D7E ECAE F000  02593 	CALL  retardo_100m
                  02594 			;	RAM_LCD();
000D82 DEAD       02595 	RCALL RAM_LCD
                  02596 			;	retardo_100m();
000D84 ECAE F000  02597 	CALL  retardo_100m
                  02598 			;	borrar_lcd();
000D88 EC51 F002  02599 	CALL  borrar_lcd
                  02600 			;	escribir_posicion (1, 1);
000D8C 0E01       02601 	MOVLW 1
000D8E 0100       02602 	MOVLB 0
000D90 6F7C       02603 	MOVWF linea,1
000D92 0E01       02604 	MOVLW 1
000D94 EC05 F002  02605 	CALL  escribir_posicion
                  02606 			;	char p,h;
                  02607 			;	for(p=0;p<19;p++ )enviar_literal(mensaje1[p]);
000D98 0100       02608 	MOVLB 0
000D9A 6B78       02609 	CLRF  p,1
000D9C 0E13       02610 m175	MOVLW 19
000D9E 0100       02611 	MOVLB 0
000DA0 6178       02612 	CPFSLT p,1
000DA2 D008       02613 	BRA   m176
000DA4 0E5A       02614 	MOVLW 90
000DA6 2578       02615 	ADDWF p,W,1
000DA8 D998       02616 	RCALL _const1
000DAA EC2B F001  02617 	CALL  enviar_literal
000DAE 0100       02618 	MOVLB 0
000DB0 2B78       02619 	INCF  p,1,1
000DB2 D7F4       02620 	BRA   m175
                  02621 			;	enviar_literal(LOGO_SC);
000DB4 0E00       02622 m176	MOVLW 0
000DB6 EC2B F001  02623 	CALL  enviar_literal
                  02624 			;	escribir_posicion (2, 1);
000DBA 0E02       02625 	MOVLW 2
000DBC 0100       02626 	MOVLB 0
000DBE 6F7C       02627 	MOVWF linea,1
000DC0 0E01       02628 	MOVLW 1
000DC2 EC05 F002  02629 	CALL  escribir_posicion
                  02630 			; 	for(p=0;p<7;p++ )enviar_literal(mensaje2[p]);
000DC6 0100       02631 	MOVLB 0
000DC8 6B78       02632 	CLRF  p,1
000DCA 0E07       02633 m177	MOVLW 7
000DCC 0100       02634 	MOVLB 0
000DCE 6178       02635 	CPFSLT p,1
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 45

ADDR   CODE       LINE  SOURCE

000DD0 D008       02636 	BRA   m178
000DD2 0E6D       02637 	MOVLW 109
000DD4 2578       02638 	ADDWF p,W,1
000DD6 D981       02639 	RCALL _const1
000DD8 EC2B F001  02640 	CALL  enviar_literal
000DDC 0100       02641 	MOVLB 0
000DDE 2B78       02642 	INCF  p,1,1
000DE0 D7F4       02643 	BRA   m177
                  02644 			; 	escribir_posicion (3, 1);
000DE2 0E03       02645 m178	MOVLW 3
000DE4 0100       02646 	MOVLB 0
000DE6 6F7C       02647 	MOVWF linea,1
000DE8 0E01       02648 	MOVLW 1
000DEA EC05 F002  02649 	CALL  escribir_posicion
                  02650 			; 	for(p=0;p<5;p++ )enviar_literal(mensaje3[p]);
000DEE 0100       02651 	MOVLB 0
000DF0 6B78       02652 	CLRF  p,1
000DF2 0E05       02653 m179	MOVLW 5
000DF4 0100       02654 	MOVLB 0
000DF6 6178       02655 	CPFSLT p,1
000DF8 D008       02656 	BRA   m180
000DFA 0E74       02657 	MOVLW 116
000DFC 2578       02658 	ADDWF p,W,1
000DFE D96D       02659 	RCALL _const1
000E00 EC2B F001  02660 	CALL  enviar_literal
000E04 0100       02661 	MOVLB 0
000E06 2B78       02662 	INCF  p,1,1
000E08 D7F4       02663 	BRA   m179
                  02664 			; 	escribir_posicion (4, 1);
000E0A 0E04       02665 m180	MOVLW 4
000E0C 0100       02666 	MOVLB 0
000E0E 6F7C       02667 	MOVWF linea,1
000E10 0E01       02668 	MOVLW 1
000E12 EC05 F002  02669 	CALL  escribir_posicion
                  02670 			; 	for(p=0;p<13;p++ )enviar_literal(mensaje4[p]);
000E16 0100       02671 	MOVLB 0
000E18 6B78       02672 	CLRF  p,1
000E1A 0E0D       02673 m181	MOVLW 13
000E1C 0100       02674 	MOVLB 0
000E1E 6178       02675 	CPFSLT p,1
000E20 D008       02676 	BRA   m182
000E22 0E79       02677 	MOVLW 121
000E24 2578       02678 	ADDWF p,W,1
000E26 D959       02679 	RCALL _const1
000E28 EC2B F001  02680 	CALL  enviar_literal
000E2C 0100       02681 	MOVLB 0
000E2E 2B78       02682 	INCF  p,1,1
000E30 D7F4       02683 	BRA   m181
                  02684 			;	
                  02685 			;	ADCON2=0b.10.001.110;
000E32 0E8E       02686 m182	MOVLW 142
000E34 6EC0       02687 	MOVWF ADCON2,0
                  02688 			;
                  02689 			; //**************************************************************************************//
                  02690 			; //**************************  B U C L E   I N F I N I T O  *****************************//
                  02691 			; //**************************************************************************************//
                  02692 			;	while (1)       					
                  02693 			;	{
                  02694 			;		PORTC.1^=1;
000E36 7282       02695 m183	BTG   PORTC,1,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 46

ADDR   CODE       LINE  SOURCE

                  02696 			;	
                  02697 			;		switch(estado){
000E38 0100       02698 	MOVLB 0
000E3A 519D       02699 	MOVF  estado,W,1
000E3C B4D8       02700 	BTFSC 0xFD8,Zero_,0
000E3E D010       02701 	BRA   m184
000E40 0A01       02702 	XORLW 1
000E42 B4D8       02703 	BTFSC 0xFD8,Zero_,0
000E44 D066       02704 	BRA   m191
000E46 0A03       02705 	XORLW 3
000E48 B4D8       02706 	BTFSC 0xFD8,Zero_,0
000E4A D08C       02707 	BRA   m197
000E4C 0A01       02708 	XORLW 1
000E4E B4D8       02709 	BTFSC 0xFD8,Zero_,0
000E50 D09A       02710 	BRA   m199
000E52 0A07       02711 	XORLW 7
000E54 B4D8       02712 	BTFSC 0xFD8,Zero_,0
000E56 D099       02713 	BRA   m200
000E58 0A01       02714 	XORLW 1
000E5A B4D8       02715 	BTFSC 0xFD8,Zero_,0
000E5C D0E5       02716 	BRA   m209
000E5E D7EB       02717 	BRA   m183
                  02718 			;			case LECTURA_VAC:
                  02719 			;				x=0;
000E60 0100       02720 m184	MOVLB 0
000E62 6B6C       02721 	CLRF  x,1
                  02722 			;				while(LATD.0==1){
000E64 A08C       02723 m185	BTFSS LATD,0,0
000E66 D04D       02724 	BRA   m190
                  02725 			;					PORTC.4=1;
000E68 8882       02726 	BSF   PORTC,4,0
                  02727 			;					if (((T == 6)&&((x==0)||(x==5))) || ((T == 12 )&&((x==1)||(x==4))) || ((T == 20)&&((x==2)||(x==3)))) {
000E6A 0E06       02728 	MOVLW 6
000E6C 0100       02729 	MOVLB 0
000E6E 639B       02730 	CPFSEQ T,1
000E70 D007       02731 	BRA   m186
000E72 536C       02732 	MOVF  x,1,1
000E74 B4D8       02733 	BTFSC 0xFD8,Zero_,0
000E76 D019       02734 	BRA   m188
000E78 516C       02735 	MOVF  x,W,1
000E7A 0A05       02736 	XORLW 5
000E7C B4D8       02737 	BTFSC 0xFD8,Zero_,0
000E7E D015       02738 	BRA   m188
000E80 0E0C       02739 m186	MOVLW 12
000E82 0100       02740 	MOVLB 0
000E84 639B       02741 	CPFSEQ T,1
000E86 D006       02742 	BRA   m187
000E88 4D6C       02743 	DCFSNZ x,W,1
000E8A D00F       02744 	BRA   m188
000E8C 516C       02745 	MOVF  x,W,1
000E8E 0A04       02746 	XORLW 4
000E90 B4D8       02747 	BTFSC 0xFD8,Zero_,0
000E92 D00B       02748 	BRA   m188
000E94 0E14       02749 m187	MOVLW 20
000E96 0100       02750 	MOVLB 0
000E98 639B       02751 	CPFSEQ T,1
000E9A D031       02752 	BRA   m189
000E9C 516C       02753 	MOVF  x,W,1
000E9E 0A02       02754 	XORLW 2
000EA0 B4D8       02755 	BTFSC 0xFD8,Zero_,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 47

ADDR   CODE       LINE  SOURCE

000EA2 D003       02756 	BRA   m188
000EA4 0E03       02757 	MOVLW 3
000EA6 636C       02758 	CPFSEQ x,1
000EA8 D02A       02759 	BRA   m189
                  02760 			;						PORTC.3=1;
000EAA 8682       02761 m188	BSF   PORTC,3,0
                  02762 			;						ac=medir(0,8);
000EAC 0100       02763 	MOVLB 0
000EAE 6B7C       02764 	CLRF  canal,1
000EB0 0E08       02765 	MOVLW 8
000EB2 DEAD       02766 	RCALL medir
000EB4 C07E F073  02767 	MOVFF resultado,ac
                  02768 			;						PORTC.3=0;	
000EB8 9682       02769 	BCF   PORTC,3,0
                  02770 			;						vac[x]=ac;
000EBA 6AEA       02771 	CLRF  FSR0+1,0
000EBC 0E6D       02772 	MOVLW 109
000EBE 0100       02773 	MOVLB 0
000EC0 256C       02774 	ADDWF x,W,1
000EC2 6EE9       02775 	MOVWF FSR0,0
000EC4 C073 FFEF  02776 	MOVFF ac,INDF0
                  02777 			;						x++;
000EC8 2B6C       02778 	INCF  x,1,1
                  02779 			;						h=x;
000ECA C06C F079  02780 	MOVFF x,h
                  02781 			;						if ((T==20&&x==3)) {retardo_20u();retardo_20u();retardo_20u();retardo_20u();
000ECE 0E14       02782 	MOVLW 20
000ED0 639B       02783 	CPFSEQ T,1
000ED2 D015       02784 	BRA   m189
000ED4 0E03       02785 	MOVLW 3
000ED6 636C       02786 	CPFSEQ x,1
000ED8 D012       02787 	BRA   m189
000EDA EC7D F000  02788 	CALL  retardo_20u
000EDE EC7D F000  02789 	CALL  retardo_20u
000EE2 EC7D F000  02790 	CALL  retardo_20u
000EE6 EC7D F000  02791 	CALL  retardo_20u
                  02792 			;							retardo_20u();retardo_20u();retardo_20u();retardo_20u();retardo_20u();}
000EEA EC7D F000  02793 	CALL  retardo_20u
000EEE EC7D F000  02794 	CALL  retardo_20u
000EF2 EC7D F000  02795 	CALL  retardo_20u
000EF6 EC7D F000  02796 	CALL  retardo_20u
000EFA EC7D F000  02797 	CALL  retardo_20u
                  02798 			;					}		
                  02799 			;					PORTC.4=0;		
000EFE 9882       02800 m189	BCF   PORTC,4,0
                  02801 			;				}
000F00 D7B1       02802 	BRA   m185
                  02803 			;				estado = CALCULOS_VAC;
000F02 0E01       02804 m190	MOVLW 1
000F04 0100       02805 	MOVLB 0
000F06 6F9D       02806 	MOVWF estado,1
                  02807 			;				if(x<=4) estado = LECTURA_VAC;
000F08 0E05       02808 	MOVLW 5
000F0A 616C       02809 	CPFSLT x,1
000F0C D794       02810 	BRA   m183
000F0E 6B9D       02811 	CLRF  estado,1
                  02812 			;			break;
000F10 D792       02813 	BRA   m183
                  02814 			;			case CALCULOS_VAC:
                  02815 			;				for(p=0;p<=5;p++){
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 48

ADDR   CODE       LINE  SOURCE

000F12 0100       02816 m191	MOVLB 0
000F14 6B78       02817 	CLRF  p,1
000F16 0E06       02818 m192	MOVLW 6
000F18 0100       02819 	MOVLB 0
000F1A 6178       02820 	CPFSLT p,1
000F1C D01F       02821 	BRA   m196
                  02822 			;					ac= vac[p];
000F1E 6AEA       02823 	CLRF  FSR0+1,0
000F20 0E6D       02824 	MOVLW 109
000F22 2578       02825 	ADDWF p,W,1
000F24 6EE9       02826 	MOVWF FSR0,0
000F26 CFEF F073  02827 	MOVFF INDF0,ac
                  02828 			;					rf =ref[p];
000F2A 0E86       02829 	MOVLW 134
000F2C 2578       02830 	ADDWF p,W,1
000F2E D8D5       02831 	RCALL _const1
000F30 0100       02832 	MOVLB 0
000F32 6F74       02833 	MOVWF rf,1
                  02834 			;					if((p==0||p==5)){
000F34 5378       02835 	MOVF  p,1,1
000F36 B4D8       02836 	BTFSC 0xFD8,Zero_,0
000F38 D003       02837 	BRA   m193
000F3A 0E05       02838 	MOVLW 5
000F3C 6378       02839 	CPFSEQ p,1
000F3E D005       02840 	BRA   m194
                  02841 			;						dif=ac-rf;
000F40 0100       02842 m193	MOVLB 0
000F42 5174       02843 	MOVF  rf,W,1
000F44 5D73       02844 	SUBWF ac,W,1
000F46 6F75       02845 	MOVWF dif,1
                  02846 			;
                  02847 			;						
                  02848 			;					}
                  02849 			;					else if((p==1|| p==4)){
000F48 D006       02850 	BRA   m195
000F4A 0100       02851 m194	MOVLB 0
000F4C 4D78       02852 	DCFSNZ p,W,1
000F4E D003       02853 	BRA   m195
000F50 0E04       02854 	MOVLW 4
000F52 6378       02855 	CPFSEQ p,1
000F54 D000       02856 	BRA   m195
                  02857 			;
                  02858 			;					}
                  02859 			;					else {
                  02860 			;
                  02861 			;					}
                  02862 			;				}
000F56 0100       02863 m195	MOVLB 0
000F58 2B78       02864 	INCF  p,1,1
000F5A D7DD       02865 	BRA   m192
                  02866 			;				
                  02867 			;				estado = LECTURAS_VARIAS;
000F5C 0E04       02868 m196	MOVLW 4
000F5E 0100       02869 	MOVLB 0
000F60 6F9D       02870 	MOVWF estado,1
                  02871 			;			break;
000F62 D769       02872 	BRA   m183
                  02873 			;			case LECTURA_IAC:
                  02874 			;				
                  02875 			;				while (estado== LECTURA_IAC){
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 49

ADDR   CODE       LINE  SOURCE

000F64 0E02       02876 m197	MOVLW 2
000F66 0100       02877 	MOVLB 0
000F68 639D       02878 	CPFSEQ estado,1
000F6A D765       02879 	BRA   m183
                  02880 			;					if ((T == 6) || (T == 15 ) || (T == 20)) {	
000F6C 519B       02881 	MOVF  T,W,1
000F6E 0A06       02882 	XORLW 6
000F70 B4D8       02883 	BTFSC 0xFD8,Zero_,0
000F72 D007       02884 	BRA   m198
000F74 519B       02885 	MOVF  T,W,1
000F76 0A0F       02886 	XORLW 15
000F78 B4D8       02887 	BTFSC 0xFD8,Zero_,0
000F7A D003       02888 	BRA   m198
000F7C 0E14       02889 	MOVLW 20
000F7E 639B       02890 	CPFSEQ T,1
000F80 D7F1       02891 	BRA   m197
                  02892 			;					nop();
000F82 0000       02893 m198	NOP  
                  02894 			;					}
                  02895 			;				}
000F84 D7EF       02896 	BRA   m197
                  02897 			;			break;
                  02898 			;			case CALCULOS_IAC:
                  02899 			;				nop();
000F86 0000       02900 m199	NOP  
                  02901 			;			break;
000F88 D756       02902 	BRA   m183
                  02903 			;			case LECTURAS_VARIAS:
                  02904 			;				char bat = medir(1,8);
000F8A 0E01       02905 m200	MOVLW 1
000F8C 0100       02906 	MOVLB 0
000F8E 6F7C       02907 	MOVWF canal,1
000F90 0E08       02908 	MOVLW 8
000F92 DE3D       02909 	RCALL medir
000F94 C07E F07B  02910 	MOVFF resultado,bat
                  02911 			;				if (bat>216)				vbat=BATT_FULL;
000F98 0ED8       02912 	MOVLW 216
000F9A 0100       02913 	MOVLB 0
000F9C 657B       02914 	CPFSGT bat,1
000F9E D003       02915 	BRA   m201
000FA0 0E01       02916 	MOVLW 1
000FA2 6F76       02917 	MOVWF vbat,1
                  02918 			;				else if((bat>173&&bat<215))	vbat=BATT_75;
000FA4 D03D       02919 	BRA   m208
000FA6 0EAD       02920 m201	MOVLW 173
000FA8 0100       02921 	MOVLB 0
000FAA 657B       02922 	CPFSGT bat,1
000FAC D006       02923 	BRA   m202
000FAE 0ED7       02924 	MOVLW 215
000FB0 617B       02925 	CPFSLT bat,1
000FB2 D003       02926 	BRA   m202
000FB4 0E02       02927 	MOVLW 2
000FB6 6F76       02928 	MOVWF vbat,1
                  02929 			;				else if((bat>133&&bat<172)) vbat=BATT_50;
000FB8 D033       02930 	BRA   m208
000FBA 0E85       02931 m202	MOVLW 133
000FBC 0100       02932 	MOVLB 0
000FBE 657B       02933 	CPFSGT bat,1
000FC0 D006       02934 	BRA   m203
000FC2 0EAC       02935 	MOVLW 172
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 50

ADDR   CODE       LINE  SOURCE

000FC4 617B       02936 	CPFSLT bat,1
000FC6 D003       02937 	BRA   m203
000FC8 0E03       02938 	MOVLW 3
000FCA 6F76       02939 	MOVWF vbat,1
                  02940 			;				else if((bat>87 &&bat<130)) vbat=BATT_25;
000FCC D029       02941 	BRA   m208
000FCE 0E57       02942 m203	MOVLW 87
000FD0 0100       02943 	MOVLB 0
000FD2 657B       02944 	CPFSGT bat,1
000FD4 D006       02945 	BRA   m204
000FD6 0E82       02946 	MOVLW 130
000FD8 617B       02947 	CPFSLT bat,1
000FDA D003       02948 	BRA   m204
000FDC 0E04       02949 	MOVLW 4
000FDE 6F76       02950 	MOVWF vbat,1
                  02951 			;				else if((bat>43 && bat<85)) vbat=BATT_10;
000FE0 D01F       02952 	BRA   m208
000FE2 0E2B       02953 m204	MOVLW 43
000FE4 0100       02954 	MOVLB 0
000FE6 657B       02955 	CPFSGT bat,1
000FE8 D006       02956 	BRA   m205
000FEA 0E55       02957 	MOVLW 85
000FEC 617B       02958 	CPFSLT bat,1
000FEE D003       02959 	BRA   m205
000FF0 0E05       02960 	MOVLW 5
000FF2 6F76       02961 	MOVWF vbat,1
                  02962 			;				else if(bat<=42){
000FF4 D015       02963 	BRA   m208
000FF6 0E2B       02964 m205	MOVLW 43
000FF8 0100       02965 	MOVLB 0
000FFA 617B       02966 	CPFSLT bat,1
000FFC D011       02967 	BRA   m208
                  02968 			;					o++;
000FFE 2B77       02969 	INCF  o,1,1
                  02970 			;					if(o<=5)vbat=BATT_LW;
001000 0E06       02971 	MOVLW 6
001002 6177       02972 	CPFSLT o,1
001004 D002       02973 	BRA   m206
001006 0E06       02974 	MOVLW 6
001008 6F76       02975 	MOVWF vbat,1
                  02976 			;					if(o>6)vbat=BATT_CLEAR;
00100A 0E06       02977 m206	MOVLW 6
00100C 0100       02978 	MOVLB 0
00100E 6577       02979 	CPFSGT o,1
001010 D002       02980 	BRA   m207
001012 0E07       02981 	MOVLW 7
001014 6F76       02982 	MOVWF vbat,1
                  02983 			;					if(o==10)o=0;
001016 0E0A       02984 m207	MOVLW 10
001018 0100       02985 	MOVLB 0
00101A 6377       02986 	CPFSEQ o,1
00101C D001       02987 	BRA   m208
00101E 6B77       02988 	CLRF  o,1
                  02989 			;				} 			
                  02990 			;				estado= ENVIO_LCD;
001020 0E05       02991 m208	MOVLW 5
001022 0100       02992 	MOVLB 0
001024 6F9D       02993 	MOVWF estado,1
                  02994 			;			break;
001026 D707       02995 	BRA   m183
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 51

ADDR   CODE       LINE  SOURCE

                  02996 			;			case ENVIO_LCD:
                  02997 			;
                  02998 			;				if(vuelta){
001028 0100       02999 m209	MOVLB 0
00102A A77A       03000 	BTFSS 0x7A,vuelta,1
00102C D01E       03001 	BRA   m210
                  03002 			;					escribir_posicion(2,9);
00102E 0E02       03003 	MOVLW 2
001030 6F7C       03004 	MOVWF linea,1
001032 0E09       03005 	MOVLW 9
001034 EC05 F002  03006 	CALL  escribir_posicion
                  03007 			;					enviar_cifra(estado);
001038 0100       03008 	MOVLB 0
00103A 519D       03009 	MOVF  estado,W,1
00103C EC7A F001  03010 	CALL  enviar_cifra
                  03011 			;					escribir_posicion(3,9);
001040 0E03       03012 	MOVLW 3
001042 0100       03013 	MOVLB 0
001044 6F7C       03014 	MOVWF linea,1
001046 0E09       03015 	MOVLW 9
001048 EC05 F002  03016 	CALL  escribir_posicion
                  03017 			;					enviar_cifra(Vmax);
00104C 0100       03018 	MOVLB 0
00104E 5198       03019 	MOVF  Vmax,W,1
001050 EC7A F001  03020 	CALL  enviar_cifra
                  03021 			;					Enviar_uns16(3,16,bat);	
001054 0E03       03022 	MOVLW 3
001056 0100       03023 	MOVLB 0
001058 6F7C       03024 	MOVWF linea_4,1
00105A 0E10       03025 	MOVLW 16
00105C 6F7D       03026 	MOVWF columna_3,1
00105E C07B F07E  03027 	MOVFF bat,dato_4
001062 6B7F       03028 	CLRF  dato_4+1,1
001064 ECC2 F003  03029 	CALL  Enviar_uns16
                  03030 			;					
                  03031 			;				}
                  03032 			;				else{
001068 D01E       03033 	BRA   m211
                  03034 			;					escribir_posicion(4,14);
00106A 0E04       03035 m210	MOVLW 4
00106C 0100       03036 	MOVLB 0
00106E 6F7C       03037 	MOVWF linea,1
001070 0E0E       03038 	MOVLW 14
001072 EC05 F002  03039 	CALL  escribir_posicion
                  03040 			;					enviar_cifra(x);
001076 0100       03041 	MOVLB 0
001078 516C       03042 	MOVF  x,W,1
00107A EC7A F001  03043 	CALL  enviar_cifra
                  03044 			;					escribir_posicion(4,20);
00107E 0E04       03045 	MOVLW 4
001080 0100       03046 	MOVLB 0
001082 6F7C       03047 	MOVWF linea,1
001084 0E14       03048 	MOVLW 20
001086 EC05 F002  03049 	CALL  escribir_posicion
                  03050 			;					enviar_literal(vbat);
00108A 0100       03051 	MOVLB 0
00108C 5176       03052 	MOVF  vbat,W,1
00108E EC2B F001  03053 	CALL  enviar_literal
                  03054 			;					Enviar_uns16(2,16,vac[0]);
001092 0E02       03055 	MOVLW 2
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 52

ADDR   CODE       LINE  SOURCE

001094 0100       03056 	MOVLB 0
001096 6F7C       03057 	MOVWF linea_4,1
001098 0E10       03058 	MOVLW 16
00109A 6F7D       03059 	MOVWF columna_3,1
00109C C06D F07E  03060 	MOVFF vac,dato_4
0010A0 6B7F       03061 	CLRF  dato_4+1,1
0010A2 ECC2 F003  03062 	CALL  Enviar_uns16
                  03063 			;				//Enviar_uns16(2,10,vac[1]);
                  03064 			;				//Enviar_uns16(3,1,vac[2]);
                  03065 			;				//Enviar_uns16(3,10,vac[3]);
                  03066 			;				//Enviar_uns16(4,1,vac[4]);
                  03067 			;				//Enviar_uns16(4,10,vac[5]);
                  03068 			;				}
                  03069 			;				vuelta^=1;
0010A6 0100       03070 m211	MOVLB 0
0010A8 777A       03071 	BTG   0x7A,vuelta,1
                  03072 			;				estado = LECTURA_VAC;
0010AA 6B9D       03073 	CLRF  estado,1
                  03074 			;				
                  03075 			;			break;
0010AC D6C4       03076 	BRA   m183
                  03077 			;		}
                  03078 			;	}	
                  03079 			;}
                  03080 			;
                  03081 			;//=============================================================================================================
                  03082 			;			
                  03083 			;void configuraPic (void)					
                  03084 			;{
                  03085 configuraPic
                  03086 			;
                  03087 			;	OSCTUNE=0b.01.000000; //PLL enable 
0010AE 0E40       03088 	MOVLW 64
0010B0 6E9B       03089 	MOVWF OSCTUNE,0
                  03090 			;	
                  03091 			;	RCON = 0b.01111111; //C18 pag 80 i 167  Causes del RESET i IPEN (priority Enabled o no)
0010B2 0E7F       03092 	MOVLW 127
0010B4 6ED0       03093 	MOVWF RCON,0
                  03094 			;	OSCCON    = 0b.0.111.0.0.00;//C18 pag 53  //=============== ULL b3 abans 0 
0010B6 0E70       03095 	MOVLW 112
0010B8 6ED3       03096 	MOVWF OSCCON,0
                  03097 			;	
                  03098 			;	//ANSEL  = 0b.0000.0001;					// Solo el canal AN0 ser√° entrada anal√≥gica, el resto ser√°n entradas/salidas digitale
                           s.(PIC 816F87)
                  03099 			;	//ANSELH = 0b.0000.0000;					// Solo el canal AN0 ser√° entrada anal√≥gica, el resto ser√°n entradas/salidas digitale
                           s.(PIC 816F87)
                  03100 			;	
                  03101 			;	TRISA  = 0b.0000.1111;					// PORTA.0 es entrada, el resto son salidas.
0010BA 0E0F       03102 	MOVLW 15
0010BC 6E92       03103 	MOVWF TRISA,0
                  03104 			;	TRISB  = 0b.0000.0000;					// PORTB todo salidas.
0010BE 6A93       03105 	CLRF  TRISB,0
                  03106 			;	TRISC  = 0b.0000.0000;					// PORTC todo salidas adem√°s de la salida del PWM.
0010C0 6A94       03107 	CLRF  TRISC,0
                  03108 			;	TRISD  = 0b.0000.0000;					// PORTD todo salidas.				
0010C2 6A95       03109 	CLRF  TRISD,0
                  03110 			;	LATB  = 0x00;							// Inicializa las salidas de PORTB a 0.
0010C4 6A8A       03111 	CLRF  LATB,0
                  03112 			;	PORTC  = 0x00;							// Inicializa las salidas de PORTC a 0.
0010C6 6A82       03113 	CLRF  PORTC,0
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 53

ADDR   CODE       LINE  SOURCE

                  03114 			;	PORTD  = 0x00;							// Inicializa las salidas de PORTD a 0.
0010C8 6A83       03115 	CLRF  PORTD,0
                  03116 			;
                  03117 			;	//configuro ccp y pwm
                  03118 			;
                  03119 			;
                  03120 			;	T2CON   = 0b.0.0001.0.01;				// Prescaler P1 = 4, TMR2ON = 1 cuenta;	
0010CA 0E09       03121 	MOVLW 9
0010CC 6ECA       03122 	MOVWF T2CON,0
                  03123 			;	PR2     = 199;
0010CE 0EC7       03124 	MOVLW 199
0010D0 6ECB       03125 	MOVWF PR2,0
                  03126 			;	CCP1CON = 0b.1000.1100;					// CCP1: modo PWM half bridge con bits de CCPR1L a 00 inicialmente.
0010D2 0E8C       03127 	MOVLW 140
0010D4 6EBD       03128 	MOVWF CCP1CON,0
                  03129 			;
                  03130 			;	PWM1CON =0b.0000.0000; //tiempo muerto entre P1A y P1B
0010D6 6AB7       03131 	CLRF  PWM1CON,0
0010D8 0012       03132 	RETURN
                  03133 _const1
0010DA 0100       03134 	MOVLB 0
0010DC 6F69       03135 	MOVWF ci,1
0010DE 5169       03136 	MOVF  ci,W,1
0010E0 0FF2       03137 	ADDLW 242
0010E2 6EF6       03138 	MOVWF TBLPTR,0
0010E4 0E10       03139 	MOVLW 16
0010E6 6AF7       03140 	CLRF  TBLPTR+1,0
0010E8 22F7       03141 	ADDWFC TBLPTR+1,1,0
0010EA 6AF8       03142 	CLRF  TBLPTR+2,0
0010EC 0008       03143 	TBLRD *
0010EE 50F5       03144 	MOVF  TABLAT,W,0
0010F0 0012       03145 	RETURN
0010F2 0800       03146 	DW    0x800
0010F4 1710       03147 	DW    0x1710
0010F6 271F       03148 	DW    0x271F
0010F8 362F       03149 	DW    0x362F
0010FA 443D       03150 	DW    0x443D
0010FC 514B       03151 	DW    0x514B
0010FE 5D57       03152 	DW    0x5D57
001100 6762       03153 	DW    0x6762
001102 706C       03154 	DW    0x706C
001104 7773       03155 	DW    0x7773
001106 7B79       03156 	DW    0x7B79
001108 7E7D       03157 	DW    0x7E7D
00110A 807F       03158 	DW    0x807F
00110C 100C       03159 	DW    0x100C
00110E 0408       03160 	DW    0x408
001110 041B       03161 	DW    0x41B
001112 0304       03162 	DW    0x304
001114 FFEE       03163 	DW    0xFFEE
001116 FFFF       03164 	DW    0xFFFF
001118 FFFF       03165 	DW    0xFFFF
00111A FFFF       03166 	DW    0xFFFF
00111C FFEE       03167 	DW    0xFFEE
00111E FFF1       03168 	DW    0xFFF1
001120 FFFF       03169 	DW    0xFFFF
001122 FFFF       03170 	DW    0xFFFF
001124 FFEE       03171 	DW    0xFFEE
001126 F1F1       03172 	DW    0xF1F1
001128 FFFF       03173 	DW    0xFFFF
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 54

ADDR   CODE       LINE  SOURCE

00112A FFFF       03174 	DW    0xFFFF
00112C FFEE       03175 	DW    0xFFEE
00112E F1F1       03176 	DW    0xF1F1
001130 FFF1       03177 	DW    0xFFF1
001132 FFFF       03178 	DW    0xFFFF
001134 FFEE       03179 	DW    0xFFEE
001136 F1F1       03180 	DW    0xF1F1
001138 F1F1       03181 	DW    0xF1F1
00113A FFFF       03182 	DW    0xFFFF
00113C FFEE       03183 	DW    0xFFEE
00113E F1F1       03184 	DW    0xF1F1
001140 F1F1       03185 	DW    0xF1F1
001142 FFF1       03186 	DW    0xFFF1
001144 0000       03187 	DW    0x0
001146 0000       03188 	DW    0x0
001148 0000       03189 	DW    0x0
00114A 0000       03190 	DW    0x0
00114C 4E4F       03191 	DW    0x4E4F
00114E 5544       03192 	DW    0x5544
001150 414C       03193 	DW    0x414C
001152 4F44       03194 	DW    0x4F44
001154 2052       03195 	DW    0x2052
001156 3035       03196 	DW    0x3035
001158 5A48       03197 	DW    0x5A48
00115A 2020       03198 	DW    0x2020
00115C 7962       03199 	DW    0x7962
00115E 4520       03200 	DW    0x4520
001160 5453       03201 	DW    0x5453
001162 4441       03202 	DW    0x4441
001164 3A4F       03203 	DW    0x3A4F
001166 4D56       03204 	DW    0x4D56
001168 5841       03205 	DW    0x5841
00116A 4C3A       03206 	DW    0x4C3A
00116C 4345       03207 	DW    0x4345
00116E 5554       03208 	DW    0x5554
001170 4152       03209 	DW    0x4152
001172 5F53       03210 	DW    0x5F53
001174 4156       03211 	DW    0x4156
001176 3A43       03212 	DW    0x3A43
001178 6464       03213 	DW    0x6464
00117A 6464       03214 	DW    0x6464
00117C 6464       03215 	DW    0x6464
                  03216 
                  03217 	END
                  03218 
                  03219 
                  03220 ; *** KEY INFO ***
                  03221 
                  03222 ; 0x000008  121 word(s)  1 % : highPriorityTimer_0
                  03223 ; 0x0010DA   82 word(s)  1 % : _const1
                  03224 ; 0x0000FA   10 word(s)  0 % : retardo_20u
                  03225 ; 0x00010E   19 word(s)  0 % : retardo_1m
                  03226 ; 0x000134   20 word(s)  0 % : retardo_50m
                  03227 ; 0x00015C   18 word(s)  0 % : retardo_100m
                  03228 ; 0x000180   20 word(s)  0 % : retardo_500m
                  03229 ; 0x0010AE   22 word(s)  0 % : configuraPic
                  03230 ; 0x0001A8   28 word(s)  0 % : envia_codigo_inicial
                  03231 ; 0x0001E0   59 word(s)  0 % : enviar_comando
                  03232 ; 0x000256   79 word(s)  0 % : enviar_literal
                  03233 ; 0x0002F4   80 word(s)  0 % : enviar_cifra
CC8E Version 1.4,   File: ondulador_migrado.c  1. May 2015  14:06   Page 55

ADDR   CODE       LINE  SOURCE

                  03234 ; 0x000394   59 word(s)  0 % : inicializar_lcd
                  03235 ; 0x00040A   39 word(s)  0 % : escribir_posicion
                  03236 ; 0x000458   37 word(s)  0 % : borrar_linea
                  03237 ; 0x0004A2    2 word(s)  0 % : borrar_lcd
                  03238 ; 0x0004A6  367 word(s)  4 % : Enviar_lcd
                  03239 ; 0x000784  429 word(s)  5 % : Enviar_uns16
                  03240 ; 0x000ADE  152 word(s)  1 % : RAM_LCD
                  03241 ; 0x000C0E  113 word(s)  1 % : medir
                  03242 ; 0x000CF0  479 word(s)  5 % : main
                  03243 
                  03244 ; RAM usage: 62 bytes (53 local), 706 bytes free
                  03245 ; Maximum call level: 3 (+2 for interrupt)
                  03246 ; Total of 2237 code words (27 %)
